import{a as we,b as Ie,c as Te}from"./chunk-XOI3GRRB.js";import{a as be}from"./chunk-QS6UWCU4.js";import"./chunk-FK6H3RFT.js";import{a as _e,b as ue,c as fe,d as Se,e as ge,f as Ce,g as ve,h as ye,i as he}from"./chunk-NX5RNOD4.js";import"./chunk-JTXMDS4E.js";import"./chunk-2TFTJWQW.js";import"./chunk-GLG5OO3S.js";import{b as pe,c as se,d as me,e as ce,i as de}from"./chunk-NHAPQC3W.js";import"./chunk-KFFE56HM.js";import{a as xe}from"./chunk-G255QGHI.js";import"./chunk-NUGAOAR2.js";import{b as W,c as X,d as Y,e as Z}from"./chunk-6HYSLB2P.js";import{i as le,j as re}from"./chunk-LC6JGRRQ.js";import"./chunk-2WKEWB2B.js";import{E as ae,F as oe,j as te,l as ie,s as ne}from"./chunk-3T4WVZA5.js";import"./chunk-F2X3VGZZ.js";import{d as q,j as G}from"./chunk-THLIJB7Y.js";import{ea as ee}from"./chunk-AAQOC4TC.js";import{r as U,s as K}from"./chunk-F7YKD2CL.js";import{$ as v,Aa as a,Cb as w,Fa as g,Ia as V,Jb as $,Kb as z,Lb as N,Ma as O,Mb as m,N as k,Nb as d,Qb as H,Sa as h,T as j,_ as C,cb as p,cc as s,dc as c,ec as Q,fc as y,ib as E,kb as M,lb as F,ma as T,mb as R,n as A,nb as o,ob as l,pb as f,sc as B,tb as b,tc as J,yb as x,zb as r}from"./chunk-J6TCZN46.js";import{a as L}from"./chunk-C6Q5SG76.js";var P=class t{#e=`${xe.URL_API}detalle-ventas/`;http=j(q);getDetVentas=i=>this.http.get(`${this.#e}items/${i}`);static \u0275fac=function(e){return new(e||t)};static \u0275prov=k({token:t,factory:t.\u0275fac,providedIn:"root"})};var Me=["dt1"],Fe=["menu"],Re=["filter"];function $e(t,i){if(t&1){let e=b();o(0,"div",11)(1,"p-button",12),s(2,"translate"),x("click",function(){C(e);let _=r(),S=N(7);return v(_.clear(S))}),l(),o(3,"p-button",13),x("click",function(){C(e);let _=r();return v(_.add())}),l()()}t&2&&(a(),p("label",c(2,3,"labels.clear"))("outlined",!0),a(2),p("outlined",!0))}function Be(t,i){t&1&&(o(0,"th",16)(1,"div",18),m(2),s(3,"translate"),s(4,"uppercase"),f(5,"p-sortIcon",19),l()()),t&2&&(p("pSortableColumn","id"),a(2),d(c(4,5,c(3,3,"labels.id"))),a(3),p("field","id"))}function Pe(t,i){if(t&1&&(o(0,"th",17)(1,"div",18),m(2),s(3,"translate"),s(4,"uppercase"),f(5,"p-sortIcon",19),l()()),t&2){let e=r().$implicit;w("pSortableColumn",e.field),a(2),d(c(4,5,c(3,3,"labels.no"))),a(3),p("field",e.field)}}function De(t,i){if(t&1&&(o(0,"th",17)(1,"div",18),m(2),s(3,"translate"),s(4,"uppercase"),f(5,"p-sortIcon",19),l()()),t&2){let e=r().$implicit;w("pSortableColumn",e.field),a(2),d(c(4,5,c(3,3,"labels.fechaVenta"))),a(3),p("field",e.field)}}function Le(t,i){if(t&1&&(o(0,"th",17)(1,"div",18),m(2),s(3,"translate"),s(4,"uppercase"),f(5,"p-sortIcon",19),l()()),t&2){let e=r().$implicit;p("pSortableColumn",e.field),a(2),d(c(4,5,c(3,3,"labels.total"))),a(3),p("field",e.field)}}function Ae(t,i){if(t&1&&(o(0,"th",17)(1,"div",18),m(2),s(3,"translate"),s(4,"uppercase"),f(5,"p-sortIcon",19),l()()),t&2){let e=r().$implicit;w("pSortableColumn",e.field),a(2),d(c(4,5,c(3,3,"labels.proveedor"))),a(3),p("field",e.field)}}function ke(t,i){if(t&1&&(o(0,"th",17)(1,"div",18),m(2),s(3,"translate"),s(4,"uppercase"),f(5,"p-sortIcon",19),l()()),t&2){let e=r().$implicit;w("pSortableColumn",e.field),a(2),d(c(4,5,c(3,3,"labels."+e.field))),a(3),p("field",e.field)}}function je(t,i){if(t&1&&h(0,Be,6,7,"th",16)(1,Pe,6,7,"th",17)(2,De,6,7,"th",17)(3,Le,6,7,"th",17)(4,Ae,6,7,"th",17)(5,ke,6,7,"th",17),t&2){let e,n=i.$implicit;E((e=n.field)==="id"?0:e==="no"?1:e==="fechaventa"?2:e==="total"?3:e==="proveedor"?4:5)}}function Oe(t,i){if(t&1&&f(0,"appcommon-filter-input",20),t&2){let e=r().$implicit;p("field",e.field)}}function ze(t,i){if(t&1&&f(0,"appcommon-filter-input",21),t&2){let e=r().$implicit;p("field",e.field)}}function Ne(t,i){if(t&1&&f(0,"appcommon-filter-input",22),t&2){let e=r().$implicit;p("field",e.field)}}function He(t,i){if(t&1&&(o(0,"th"),h(1,Oe,1,1,"appcommon-filter-input",20)(2,ze,1,1,"appcommon-filter-input",21)(3,Ne,1,1,"appcommon-filter-input",22),l()),t&2){let e,n=i.$implicit;a(),E((e=n.field)==="fechaVenta"?1:e==="total"?2:3)}}function Qe(t,i){t&1&&(o(0,"th",15),m(1,"cargando"),l())}function Je(t,i){if(t&1&&(o(0,"tr"),f(1,"th",14),F(2,je,6,1,null,null,M),l(),o(4,"tr"),F(5,He,4,1,"th",null,M,!1,Qe,2,0,"th",15),l()),t&2){let e=i.$implicit;a(2),R(e),a(3),R(e)}}function Ue(t,i){if(t&1&&(o(0,"td"),m(1),l()),t&2){let e=r().$implicit,n=r().$implicit;a(),d(n[e.field])}}function Ke(t,i){if(t&1&&(o(0,"td"),m(1),l()),t&2){let e=r().$implicit,n=r().$implicit;a(),d(n[e.field])}}function qe(t,i){if(t&1&&(o(0,"td"),m(1),s(2,"date"),l()),t&2){let e=r(2).$implicit;a(),d(Q(2,1,e.fechaVenta,"dd/MM/yyyy"))}}function Ge(t,i){if(t&1&&(o(0,"td",25),m(1),s(2,"bolivianos"),l()),t&2){let e=r().$implicit,n=r().$implicit;a(),d(c(2,1,n[e.field]))}}function We(t,i){if(t&1&&(o(0,"td"),m(1),l()),t&2){let e=r(2).$implicit;a(),H("",e.cliente.persona.nombre," ",e.cliente.persona.app," ",e.cliente.persona.apm,"")}}function Xe(t,i){if(t&1&&(o(0,"td"),m(1),l()),t&2){let e=r(2).$implicit;a(),d(e.cliente.ci)}}function Ye(t,i){if(t&1&&(o(0,"td"),m(1),l()),t&2){let e=r(2).$implicit;a(),d(e.cliente.nit)}}function Ze(t,i){if(t&1&&(o(0,"td"),m(1),l()),t&2){let e=r(2).$implicit;a(),d(e.cliente.nit)}}function et(t,i){if(t&1&&h(0,Ue,2,1,"td")(1,Ke,2,1,"td")(2,qe,3,4,"td")(3,Ge,3,3,"td",25)(4,We,2,3,"td")(5,Xe,2,1,"td")(6,Ye,2,1,"td")(7,Ze,2,1,"td"),t&2){let e,n=i.$implicit;E((e=n.field)==="id"?0:e==="no"?1:e==="fechaVenta"?2:e==="total"?3:e==="cliente"?4:e==="ci"?5:e==="nit"?6:7)}}function tt(t,i){if(t&1){let e=b();o(0,"tr")(1,"td",23)(2,"p-button",24),x("click",function(_){let S=C(e).$implicit,I=r();return v(I.openMenu(_,S))}),l()(),F(3,et,8,1,null,null,M),l()}if(t&2){let e=i.columns;a(2),p("icon","pi pi-ellipsis-v")("text",!0),a(),R(e)}}function it(t,i){if(t&1){let e=b();o(0,"div",26)(1,"p-multiSelect",27),x("onChange",function(_){C(e);let S=r();return v(S.cargaColumnas(_))})("onSelectAllChange",function(_){C(e);let S=r();return v(S.selectAll(_))}),l()()}if(t&2){let e=r();a(),p("options",e.colsOptionsSelect)("ngModel",e.columnsSelectSignal())}}function nt(t,i){t&1&&(o(0,"tr")(1,"td",28),m(2,"No order found."),l()())}function at(t,i){t&1&&(o(0,"tr")(1,"td",28),m(2,"Loading orders data. Please wait."),l()())}var D=class t{constructor(i,e,n,_,S,I,ot,lt){this.translateLanService=i;this.translate=e;this.filterservice=n;this.ventasServ=_;this.router=S;this.pdfreport=I;this.arrayurilservice=ot;this.detalleVentasServ=lt;this.translateLanService.changeLanguage$.subscribe(u=>this.translate.use(u)),J(()=>{this.ventasServ.postAllVentasSearch(this.ventasdto()).pipe(A(u=>({data:Array.isArray(u.data)?[...u.data]:[],metadata:{page:u.metadata.page,rows:u.metadata.rows,total_records:u.metadata.total_records},loading:!1,error:null}))).subscribe({next:u=>this.stateValues.set(u),error:u=>{console.log(u),this.stateValues.set({data:[],metadata:{page:0,rows:0,total_records:0},loading:!0,error:u})}})})}table=V("dt1");menu=V("menu");filter=V("filter");stateValues=T({data:[],metadata:{page:0,rows:0,total_records:0},loading:!0,error:null});searchTxt=T([]);ventasdto=T({config:{populate_data:!0,page:1,rows:15,sort_field:[]},filter:{}});tablecon=_e.cantidadRegistros;stateIni=!1;title="pages.sales";subtitle="labels.admin_sales";allowedColumns=["id","no","fechaVenta","total","cliente","ci","nit"];columns=this.allowedColumns;columnsSelectSignal=B(()=>this.columns.map(i=>({field:i,header:i.charAt(0).toUpperCase()+i.slice(1)})));colsOptionsSelect=this.allowedColumns.map(i=>({field:i,header:i.charAt(0).toUpperCase()+i.slice(1)}));selectedItemId=null;items=[{label:"View",icon:"pi pi-eye",routerLink:"/transactions/ventas/detail/214"},{label:"Download",icon:"pi pi-download",items:[{label:"Pdf",icon:"pi pi-file-pdf",style:{color:"crimson"},command:i=>{console.log(i),this.selectedItemId?this.getDetVentas(this.selectedItemId):console.warn("No hay un \xEDtem seleccionado para descargar el PDF.")}}]}];expandedRows={};keylocalColumn="sales_cols";onColumnReorder=i=>localStorage.setItem(this.keylocalColumn,JSON.stringify(i.columns));getDataPaged(i){i.filters&&this.stateIni!==!1&&this.ventasdto.update(()=>({config:{populate_data:!1,page:(i.first||0)/Number(i.rows)+1,sort_field:i.multiSortMeta?i.multiSortMeta.filter(e=>e.field):[],rows:Number(i.rows)},filter:L({},this.filterservice.applyFilterNew(i.filters,this.ventasdto().filter))})),this.stateIni=!0}clear=i=>{this.ventasdto.set({config:{populate_data:!1,page:1,rows:15,sort_field:[]},filter:{}}),i.clear()};add=()=>this.router.navigate(["/transactions/ventas/create"]);openMenu(i,e){console.log(e),this.selectedItemId=e,this.menu()?.toggle(i)}getDetVentas(i){return this.detalleVentasServ.getDetVentas(+i.id).subscribe(e=>(console.log(e),this.generatePdf(i,e),e))}generatePdf=(i,e)=>{let n=new we;console.log(e),this.pdfreport.generatePdf(i,e)};cargaColumnas(i){let e=this.arrayurilservice.selectOrderedArray(this.colsOptionsSelect,i.value);this.columnsSelectSignal=B(()=>e),localStorage.setItem(this.keylocalColumn,JSON.stringify(this.columnsSelectSignal()))}selectAll(i){let e=[];i.checked&&(e=this.allowedColumns),this.columnsSelectSignal=B(()=>e),localStorage.setItem(this.keylocalColumn,JSON.stringify(e))}static \u0275fac=function(e){return new(e||t)(g(Z),g(W),g(ye),g(Ie),g(G),g(Te),g(he),g(P))};static \u0275cmp=O({type:t,selectors:[["app-sales"]],viewQuery:function(e,n){e&1&&($(n.table,Me,5),$(n.menu,Fe,5),$(n.filter,Re,5)),e&2&&z(3)},decls:19,vars:25,consts:[["menu",""],["dt1",""],["header",""],["body",""],["paginatorleft",""],["emptymessage",""],["loadingbody",""],[3,"model","popup"],[3,"header","subheader"],["datakey","id","currentPageReportTemplate","Showing {first} to {last} of {totalRecords} items","styleClass","p-datatable-sm","responsiveLayout","scroll","scrollHeight","53vh",3,"onLazyLoad","value","paginator","loading","expandedRowKeys","rows","rowHover","rowsPerPageOptions","lazy","columns","reorderableColumns","totalRecords","sortMode","customSort","scrollable","paginatorPosition"],["pTemplate","caption"],[1,"flex","flex-wrap","justify-content-end"],["icon","pi pi-filter-slash",3,"click","label","outlined"],["icon","pi pi-plus","severity","primary",3,"click","outlined"],["rowspan","2"],[2,"min-width","12rem"],["pReorderableColumn","",2,"min-width","1rem",3,"pSortableColumn"],["pReorderableColumn","",3,"pSortableColumn"],[1,"flex","justify-content-between","align-items-left"],[3,"field"],["type","date",3,"field"],["type","number",3,"field"],["type","text",3,"field"],[1,"flex","py-4"],["type","button",1,"p-button-text","p-button-rounded",3,"click","icon","text"],[2,"width","12%","text-align","right"],[1,"flex","align-items-center","justify-content-center"],["inputId","float-label","optionLabel","header","selectedItemsLabel","{0} columns selected","size","small","placeholder","Choose Columns",1,"p-input-icon-left",3,"onChange","onSelectAllChange","options","ngModel"],["colspan","8"]],template:function(e,n){if(e&1){let _=b();f(0,"p-tieredmenu",7,0),o(2,"p-card",8),s(3,"translate"),s(4,"uppercase"),s(5,"translate"),o(6,"p-table",9,1),x("onLazyLoad",function(I){return C(_),v(n.getDataPaged(I))}),h(8,$e,4,5,"ng-template",10)(9,Je,8,1,"ng-template",null,2,y)(11,tt,5,2,"ng-template",null,3,y)(13,it,2,2,"ng-template",null,4,y)(15,nt,3,0,"ng-template",null,5,y)(17,at,3,0,"ng-template",null,6,y),l()()}e&2&&(p("model",n.items)("popup",!0),a(2),p("header",c(4,21,c(3,19,n.title)))("subheader",c(5,23,n.subtitle)),a(4),p("value",n.stateValues().data)("paginator",!0)("loading",n.stateValues().loading)("expandedRowKeys",n.expandedRows)("rows",n.stateValues().metadata.rows)("rowHover",!0)("rowsPerPageOptions",n.tablecon)("lazy",!0)("columns",n.columnsSelectSignal())("reorderableColumns",!0)("totalRecords",n.stateValues().metadata.total_records)("sortMode","multiple")("customSort",!0)("scrollable",!0)("paginatorPosition",n.stateValues().data&&n.stateValues().data.length>50?"both":"bottom"))},dependencies:[Y,X,re,le,ee,de,pe,se,ce,me,oe,ae,ve,Ce,U,fe,ue,K,ne,te,ie,be,ge,Se],encapsulation:2})};export{D as default};
