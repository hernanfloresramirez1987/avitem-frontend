import{a as ke,b as Be,c as je,d as Ue,e as Ae}from"./chunk-QICJ2XHG.js";import{a as Ve}from"./chunk-T5MRVGB7.js";import{a as Me}from"./chunk-ZKSZQ6LI.js";import{a as De,b as Ne}from"./chunk-OV7H44K2.js";import{b as ge,j as xe}from"./chunk-HBCZXPSQ.js";import{a as Ee}from"./chunk-R6ZE4VRU.js";import{a as we,b as Fe}from"./chunk-OVNQVQR5.js";import{a as Pe,b as Te}from"./chunk-NL3GR4WL.js";import{b as de}from"./chunk-ABYTDU5A.js";import{a as Ie}from"./chunk-A34LD5UV.js";import{a as ye,b as Se}from"./chunk-7F3ROMIE.js";import{a as fe,b as _e,c as be}from"./chunk-XRCNOI5B.js";import{G as ce,J as se,K as me,X as ue,Y as he,b as z,c as K,d as Q,e as W,ea as ve,fa as Ce,g as X,h as Z,j as ee,k as te,m as ie,n as re,o as ae,p as oe,q as ne,s as le,x as pe}from"./chunk-GGYH7DSO.js";import"./chunk-4YRY4IP2.js";import{a as J,i as q,j as H}from"./chunk-NM3HJ4DI.js";import{s as Y,t as D}from"./chunk-JAFPLUWG.js";import{$ as U,Cb as _,Db as x,Gb as R,Mb as l,Nb as s,Sa as r,Ta as h,Tb as $,Ub as O,V as j,Wb as V,a as k,b as B,bb as L,dc as m,ea as A,ec as d,hb as f,jb as p,kb as G,mb as N,oa as T,ob as g,pa as I,tb as i,ub as e,vb as v,zb as M}from"./chunk-PQPLRZS3.js";var Le=(()=>{class n{constructor(){this.#e=be.URL_API,this.http=U(J),this.getAllAlmacenes=()=>this.http.get(`${this.#e}almacenes`)}#e;static{this.\u0275fac=function(o){return new(o||n)}}static{this.\u0275prov=j({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var Ge=()=>({width:"100%"}),Oe=()=>({width:"100%"}),Ye=()=>["/inventory/products"];function Je(n,u){n&1&&(i(0,"small",8),l(1,"Error en el Fecha de Compra."),e())}function qe(n,u){n&1&&(i(0,"small",8),l(1,"Error en el Proveedor Seleccionado."),e())}function He(n,u){n&1&&(i(0,"small",8),l(1,"Error en el Producto seleccionado."),e())}function ze(n,u){n&1&&(i(0,"small",8),l(1,"Error en el Almacen Seleccionado."),e())}function Ke(n,u){n&1&&(i(0,"small",8),l(1,"Error en el Fecha de Compra."),e())}function Qe(n,u){n&1&&(i(0,"small",8),l(1,"Error en el Precio de Compra."),e())}function We(n,u){n&1&&(i(0,"small",8),l(1,"Error en el Precio de Venta."),e())}function Xe(n,u){n&1&&(i(0,"small",8),l(1,"Error en el Precio de Venta."),e())}function Ze(n,u){n&1&&(i(0,"tr")(1,"th",29),l(2,"No"),e(),i(3,"th",30),l(4,"Producto"),e(),i(5,"th",31),l(6,"Cantidad"),e(),i(7,"th",31),l(8,"Precio Unitario"),e(),i(9,"th",31),l(10,"Precio Venta"),e(),i(11,"th",31),l(12,"Precio Total"),e(),i(13,"th",32),l(14,"Option"),e()())}function et(n,u){if(n&1){let a=M();i(0,"tr")(1,"td",33),l(2),e(),i(3,"td"),l(4),e(),i(5,"td",33),l(6),e(),i(7,"td",33),l(8),e(),i(9,"td",33),l(10),e(),i(11,"td",33),l(12),e(),i(13,"td",34)(14,"p-buttonGroup")(15,"p-button",35),m(16,"translate"),_("click",function(){let t=T(a).$implicit,c=x();return I(c.updateDetail(t))}),e(),i(17,"p-button",24),m(18,"translate"),_("click",function(){let t=T(a).$implicit,c=x();return I(c.deleteDetail(t))}),e()()()()}if(n&2){let a=u.$implicit,o=u.rowIndex,t=x();r(2),s(o+1),r(),G("background-color",t.getColorBackground(a.color))("color",t.getColor(a.color)),r(),s(a.name_product),r(2),s(a.cantidad),r(2),s(a.precioUnitario),r(2),s(a.precioVenta),r(2),s(a.cantidad*a.precioUnitario),r(3),p("title",d(16,12,"label.edit_detall")),r(2),p("title",d(18,14,"label.delet_detall"))}}function tt(n,u){if(n&1){let a=M();i(0,"div",36),v(1,"p-button",37),i(2,"p-button",38),_("click",function(){T(a);let t=x();return I(t.cleanAll())}),e(),i(3,"p-button",39),_("click",function(){T(a);let t=x();return I(t.submitPurchase())}),e()()}if(n&2){let a=x();r(),p("routerLink",V(2,Ye)),r(2),p("disabled",!a.purchaseForm.valid)}}var Ht=(()=>{class n{constructor(a,o,t,c,y,S,b,w,F,E,P){this.confirmationServ=a,this.comprasServ=o,this.productosServ=t,this.translate=c,this.proveedoresServ=y,this.almacenesServ=S,this.translateLanService=b,this.fb=w,this.router=F,this.datePipe=E,this.toastServ=P,this.detailView=[],this.stateInputs=L(!0),this.currentDate=this.datePipe.transform(new Date,"dd/MM/yyyy"),this.total=0,this.totalCompra=0,this.translateLanService.changeLanguage$.subscribe(C=>this.translate.use(C)),this.purchaseForm=this.fb.group({fechaCompra:[this.currentDate],id_proveedor:["",[Z.required]],cantidad:[""],precioUnitario:[""],precioVenta:[""],id_producto:[""],id_almacen:[""]}),this.proveedoresServ.postProveedoresSearch(null).subscribe({next:C=>this.proveedores=C,error:C=>console.error("Error al obtener proveedores:",C)}),this.almacenesServ.getAllAlmacenes().subscribe({next:C=>this.almacenes=C,error:C=>console.log(C.message)})}addDetail(){if(!this.purchaseForm.value.id_producto){alert("Debe de seleccionar producto para agregarlo. Por favor seleccione uno.");return}let a=Number(this.purchaseForm.value.id_producto.id);if(this.detailView.some(t=>t.id_producto===a||this.purchaseForm.value.id_producto=="")){alert("Este producto ya ha sido agregado. Por favor selecciona otro.");return}this.detailView.push({cantidad:Number(this.purchaseForm.value.cantidad),precioUnitario:Number(this.purchaseForm.value.precioUnitario),precioVenta:Number(this.purchaseForm.value.precioVenta),id_producto:Number(this.purchaseForm.value.id_producto.id),name_product:this.purchaseForm.value.id_producto.nombre,color:this.purchaseForm.value.id_producto.color}),this.funcTotal(),this.cleanForms()}funcTotal(){this.total=this.detailView.reduce((a,o)=>{let t=Number(o.cantidad)||0,c=Number(o.precioUnitario)||0;return a+t*c},0)}cleanForms(){this.purchaseForm.patchValue({total:this.total,id_producto:"",cantidad:"",precioUnitario:"",precioVenta:""},{emitEvent:!1}),this.totalCompra=0}updateDetail(a){this.purchaseForm.patchValue({id_producto:"",cantidad:"",precioUnitario:""},{emitEvent:!0})}changeProvider(){this.productosServ.postProductscProveedor(this.purchaseForm.value.id_proveedor.id).subscribe(a=>{this.productos=a.map(o=>B(k({},o),{display:`${o.nombre} (${o.color})  , ${o.color} - ${o.unidadMedida}`})),this.stateInputs.set(!1)})}changeTotalCompra(){console.log("this.totalCompra: "),this.totalCompra=this.purchaseForm.value.cantidad*this.purchaseForm.value.precioUnitario}submitPurchase(){if(this.purchaseForm.valid){let a=this.asignarValores();console.log(a),a.detalle=JSON.stringify(a.detalle),this.confirm(a)}else console.error("Formulario inv\xE1lido")}asignarValores(){let a=this.purchaseForm.value;return console.log(String(this.datePipe.transform(this.getLastDateOfYear(new Date().getFullYear()),"yyyy-MM-dd"))),this.comprasRegister={fechaCompra:String(this.datePipe.transform(new Date,"yyyy-MM-dd")),total:this.total,id_proveedor:a.id_proveedor.id,detalle:this.detailView.map(o=>(console.log(o),{cantidad:o.cantidad,precioUnitario:o.precioUnitario,precioVenta:o.precioVenta,id_producto:o.id_producto})),fechaVencimiento:String(this.datePipe.transform(this.getLastDateOfYear(new Date().getFullYear()),"yyyy-MM-dd"))},console.log(`console.log(this.comprasRegister);
 `,this.comprasRegister),this.comprasRegister}getLastDateOfYear(a){return new Date(a,11,31)}notifySuccess(){this.toastServ.showSuccess("Operation Successful","The action was completed successfully.")}notifyError(){this.toastServ.showError("Operation Failed","An error occurred while processing the action.")}confirm(a){this.confirmationServ.confirm({message:"Are you sure you want to perform this action?",header:"Confirmation",icon:"pi pi-exclamation-triangle",accept:()=>{this.comprasServ.postSaveCompras(a).subscribe({next:o=>{console.log("Action confirmed!"),o.CodigoEstado==="201"?(this.notifySuccess(),setTimeout(()=>{console.log("Compra registrada correctamente"),this.router.navigate(["/transactions/compras"])},3e3)):console.log(o)},error:o=>{console.error("Error al registrar la compra:",o)}})},reject:()=>{console.log("Action rejected!")}})}getColorBackground(a){switch(a){case"Natural":return"#cccccc";case"Champan":return"#FBE7C6";case"Negro":return"#000000";case"Madera":return"#8B4513";default:return"#FFFFFF"}}getColor(a){switch(a){case"Natural":return"#000000";case"Champan":return"#000000";case"Negro":return"#FFFFFF";case"Madera":return"#FFFFFF";default:return"#FFFFFF"}}deleteDetail(a){this.detailView=this.detailView.filter(o=>o!==a),this.funcTotal(),this.cleanForms()}updateData(){console.log("updateData() { } ")}cleanAll(){}static{this.\u0275fac=function(o){return new(o||n)(h(pe),h(Me),h(Ve),h(z),h(Ie),h(Le),h(W),h(ne),h(q),h(D),h(Ae))}}static{this.\u0275cmp=A({type:n,selectors:[["app-purchase-create"]],standalone:!0,features:[$([D]),O],decls:83,vars:75,consts:[[3,"formGroup"],[3,"header"],[1,"flex","flex-column","md:flex-row","sm:flex-row","w-full"],[1,"align-items-left","justify-content-top","w-full"],[1,"flex","flex-column","md:flex-row","gap-2","w-full"],[1,"flex","flex-wrap","justify-content-left","align-items-center","gap-2","pb-4","lg:w-full"],[1,"w-25rem"],["dateFormat","dd/mm/yy","type","text","styleClass","w-full",1,"w-full",3,"formControlName"],[2,"color","red"],[1,"flex","flex-wrap","justify-content-left","align-items-center","gap-2","pb-4","lg:w-full","px-2"],["pInputText","","type","text","disabled","",1,"w-full",3,"value"],["optionLabel","empresa","styleClass","w-full","placeholder","Select un proveedor",1,"w-full","lg:w-full",3,"onChange","formControlName","options"],["optionLabel","display","placeholder","Seleccionar Producto","styleClass","w-full",1,"w-full","lg:w-full",3,"formControlName","options"],["optionLabel","nombre","styleClass","w-full","placeholder","Seleccionar un almacen",1,"w-full","lg:w-full",3,"onChange","formControlName","options"],[3,"binary"],[1,"flex","flex-column","md:flex-row","flex-row"],[1,"flex","flex-wrap","justify-content-left","align-items-center","gap-2","px-2","lg:w-full"],["pInputText","","type","number",1,"w-full",3,"change","formControlName"],["pInputText","","type","number",1,"w-full",3,"formControlName"],["pInputText","","type","number","disabled","",1,"w-full",3,"value"],[1,"justify-content-center","align-items-center"],[1,""],[1,"flex","justify-content-between"],["icon","pi pi-plus","severity","primary",3,"click","title"],["icon","pi pi-trash","severity","danger",3,"click","title"],[3,"value","tableStyle","styleClass"],["pTemplate","header"],["pTemplate","body"],["pTemplate","footer"],[2,"width","6%","text-align","right"],[2,"width","40%"],[2,"width","12%","text-align","right"],[2,"width","6%"],[2,"text-align","right"],[1,"flex","flex-wrap","justify-content-left"],["icon","pi pi-pencil","severity","warning",3,"click","title"],[1,"flex","gap-3","mt-1"],["label","Cancel","severity","danger","styleClass","w-full",1,"w-full",3,"routerLink"],["label","Limpiar","severity","secondary","styleClass","w-full",1,"w-full",3,"click"],["label","Save","styleClass","w-full",1,"w-full",3,"click","disabled"]],template:function(o,t){if(o&1&&(v(0,"p-toast")(1,"p-confirmDialog"),i(2,"form",0)(3,"p-card",1),m(4,"translate"),m(5,"uppercase"),i(6,"div",2)(7,"div",3)(8,"div",4)(9,"div",5)(10,"label",6),l(11),m(12,"translate"),e(),v(13,"p-calendar",7),f(14,Je,2,0,"small",8),e(),i(15,"div",9)(16,"label",6),l(17),m(18,"translate"),e(),v(19,"input",10),e(),i(20,"div",9)(21,"label",6),l(22),m(23,"translate"),e(),i(24,"p-dropdown",11),_("onChange",function(){return t.changeProvider()}),e(),f(25,qe,2,0,"small",8),e(),i(26,"div",5)(27,"label",6),l(28),m(29,"translate"),e(),v(30,"p-dropdown",12),f(31,He,2,0,"small",8),e(),i(32,"div",9)(33,"label",6),l(34),m(35,"translate"),e(),i(36,"p-dropdown",13),_("onChange",function(){return t.changeProvider()}),e(),f(37,ze,2,0,"small",8),i(38,"p-inputGroup"),v(39,"p-dropdown",12),l(40," \xA0 "),v(41,"p-checkbox",14),e()()(),i(42,"div",15)(43,"div",16)(44,"label",6),l(45),m(46,"translate"),e(),i(47,"input",17),_("change",function(){return t.changeTotalCompra()}),e(),f(48,Ke,2,0,"small",8),e(),i(49,"div",16)(50,"label",6),l(51),m(52,"translate"),e(),i(53,"input",17),_("change",function(){return t.changeTotalCompra()}),e(),f(54,Qe,2,0,"small",8),e(),i(55,"div",16)(56,"label",6),l(57),m(58,"translate"),e(),v(59,"input",18),f(60,We,2,0,"small",8),e(),i(61,"div",16)(62,"label",6),l(63),m(64,"translate"),e(),v(65,"input",19),f(66,Xe,2,0,"small",8),e(),i(67,"div",20)(68,"label",21),l(69),m(70,"translate"),e(),i(71,"div",22)(72,"p-buttonGroup")(73,"p-button",23),m(74,"translate"),_("click",function(){return t.addDetail()}),e(),i(75,"p-button",24),m(76,"translate"),_("click",function(){return t.updateData()}),e()()()()(),i(77,"h4"),l(78,"Detalles"),e(),i(79,"p-table",25),f(80,Ze,15,0,"ng-template",26)(81,et,19,16,"ng-template",27),e()()(),f(82,tt,4,3,"ng-template",28),e()()),o&2){let c,y,S,b,w,F,E,P;r(2),p("formGroup",t.purchaseForm),r(),p("header",d(5,46,d(4,44,"labels.register_purchases"))),r(8),s(d(12,48,"purcharses.fechaCompra")),r(2),p("formControlName","fechaCompra"),r(),g(14,(c=t.purchaseForm.get("fechaCompra"))!=null&&c.invalid&&((c=t.purchaseForm.get("fechaCompra"))!=null&&c.touched)?14:-1),r(3),s(d(18,50,"purcharses.precio_total")),r(2),p("value",t.total),r(3),s(d(23,52,"purcharses.proveedor")),r(2),N(V(72,Ge)),p("formControlName","id_proveedor")("options",t.proveedores),r(),g(25,(y=t.purchaseForm.get("id_proveedor"))!=null&&y.invalid&&((y=t.purchaseForm.get("id_proveedor"))!=null&&y.touched)?25:-1),r(3),s(d(29,54,"purcharses.producto")),r(2),p("formControlName","id_producto")("options",t.productos),r(),g(31,(S=t.purchaseForm.get("id_producto"))!=null&&S.invalid&&((S=t.purchaseForm.get("id_producto"))!=null&&S.touched)?31:-1),r(3),s(d(35,56,"purcharses.almacen")),r(2),N(V(73,Ge)),p("formControlName","id_almacen")("options",t.almacenes),r(),g(37,(b=t.purchaseForm.get("id_almacen"))!=null&&b.invalid&&((b=t.purchaseForm.get("id_almacen"))!=null&&b.touched)?37:-1),r(2),p("formControlName","id_producto")("options",t.productos),r(2),p("binary",!0),r(4),s(d(46,58,"purcharses.cantidad")),r(2),p("formControlName","cantidad"),r(),g(48,(w=t.purchaseForm.get("cantidad"))!=null&&w.invalid&&((w=t.purchaseForm.get("cantidad"))!=null&&w.touched)?48:-1),r(3),s(d(52,60,"purcharses.precioCompra")),r(2),p("formControlName","precioUnitario"),r(),g(54,(F=t.purchaseForm.get("precioUnitario"))!=null&&F.invalid&&((F=t.purchaseForm.get("precioUnitario"))!=null&&F.touched)?54:-1),r(3),s(d(58,62,"purcharses.precioVenta")),r(2),p("formControlName","precioVenta"),r(),g(60,(E=t.purchaseForm.get("precioVenta"))!=null&&E.invalid&&((E=t.purchaseForm.get("precioVenta"))!=null&&E.touched)?60:-1),r(3),s(d(64,64,"purcharses.totalCompra")),r(2),R("value",t.totalCompra),r(),g(66,(P=t.purchaseForm.get("totaCompra"))!=null&&P.invalid&&((P=t.purchaseForm.get("totaCompra"))!=null&&P.touched)?66:-1),r(3),s(d(70,66,"purcharses.options")),r(4),p("title",d(74,68,"label.add_detall")),r(2),p("title",d(76,70,"label.delet_detall")),r(4),p("value",t.detailView)("tableStyle",V(74,Oe))("styleClass","p-datatable-sm")}},dependencies:[Fe,we,ce,Ee,Te,Pe,de,le,ie,X,re,ee,te,ae,oe,Se,ye,Q,K,me,se,Ce,ve,he,ue,Y,_e,fe,Be,ke,xe,ge,Ne,De,Ue,je,H]})}}return n})();export{Ht as default};
