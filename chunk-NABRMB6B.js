import{a as Me}from"./chunk-3BEJYVCR.js";import{a as ke,b as je,c as Ae,d as Le,e as Ue,f as Re}from"./chunk-HK5TF6CE.js";import{a as Ve,b as Be}from"./chunk-LPIK6OHX.js";import{a as Ne}from"./chunk-IDUHP2TL.js";import"./chunk-XOZZOHTX.js";import{b as xe,j as Pe}from"./chunk-HIU3DXSA.js";import"./chunk-R4XMLPRT.js";import{a as Ie}from"./chunk-QH7UTFAB.js";import{a as De}from"./chunk-QQK6EUDP.js";import{b as Ee}from"./chunk-UN4FUFRP.js";import{a as Te}from"./chunk-G255QGHI.js";import{j as Ce,k as ge,l as Se,q as be,r as Fe,s as ye,t as we}from"./chunk-5W7I67TA.js";import{a as ee}from"./chunk-TKR6C5GP.js";import{b as _e}from"./chunk-VXALU44M.js";import{Ba as de,Ca as ue,Da as fe,Ma as he,Na as ve,V as te,b as Q,ba as ie,c as X,d as Z,oa as re,pa as ae,ra as oe,sa as ne,ua as le,va as pe,wa as ce,xa as se,za as me}from"./chunk-INNAZPTW.js";import{d as q,i as J,j as K}from"./chunk-JCFNFE6R.js";import{r as H,s as T}from"./chunk-T5GUEJU5.js";import"./chunk-F2X3VGZZ.js";import{Ab as C,Bb as w,Da as i,Eb as W,Ia as u,Ob as l,Pa as U,Pb as c,Q as A,Sa as R,Va as f,Vb as Y,W as L,Wb as E,a as k,b as j,ba as N,ca as V,dc as s,ec as m,fb as d,gb as G,ib as O,lb as v,pa as B,qb as a,rb as e,sb as _,tc as z,wb as $}from"./chunk-RCKDCOFB.js";var I=class n{transform(t){return t&&t.toLowerCase().split(" ").map(r=>r.charAt(0).toUpperCase()+r.slice(1)).join(" ")}static \u0275fac=function(r){return new(r||n)};static \u0275pipe=R({name:"capitalize",type:n,pure:!0})};var D=class n{#e=Te.URL_API;http=L(q);getAllAlmacenes=()=>this.http.get(`${this.#e}almacenes/list`);static \u0275fac=function(r){return new(r||n)};static \u0275prov=A({token:n,factory:n.\u0275fac,providedIn:"root"})};var $e=()=>({width:"100%"}),We=()=>({width:"100%"}),Ye=()=>["/inventory/products"];function ze(n,t){n&1&&(a(0,"small",8),l(1,"Error en el Fecha de Compra."),e())}function He(n,t){n&1&&(a(0,"small",8),l(1,"Error en el Proveedor Seleccionado."),e())}function qe(n,t){n&1&&(a(0,"small",8),l(1,"Error en el Producto seleccionado."),e())}function Je(n,t){n&1&&(a(0,"small",8),l(1,"Error en el Almacen seleccionado."),e())}function Ke(n,t){n&1&&(a(0,"small",8),l(1,"Error en el Fecha de Compra."),e())}function Qe(n,t){n&1&&(a(0,"small",8),l(1,"Error en el Precio de Compra."),e())}function Xe(n,t){n&1&&(a(0,"small",8),l(1,"Error en el Precio de Venta."),e())}function Ze(n,t){n&1&&(a(0,"small",8),l(1,"Error en el Precio de Venta."),e())}function et(n,t){n&1&&(a(0,"div",29),l(1),s(2,"translate"),s(3,"capitalize"),e()),n&2&&(i(),c(m(3,3,m(2,1,"labels.details"))))}function tt(n,t){n&1&&(a(0,"tr")(1,"th",30),l(2,"No"),e(),a(3,"th",31),l(4,"Producto"),e(),a(5,"th",32),l(6,"Cantidad"),e(),a(7,"th",32),l(8,"Precio Unitario"),e(),a(9,"th",32),l(10,"Precio Total"),e(),a(11,"th",33),l(12,"Option"),e()())}function it(n,t){if(n&1&&(a(0,"tr")(1,"td",34),l(2),e(),a(3,"td"),l(4),e(),a(5,"td",34),l(6),e(),a(7,"td",34),l(8),e(),a(9,"td",34),l(10),e(),a(11,"td",34),l(12),e(),a(13,"td",34),l(14),e()()),n&2){let r=t.$implicit,o=t.rowIndex,p=w();i(2),c(o+1),i(),G("background-color",p.getColorBackground(r.color))("color",p.getColor(r.color)),i(),c(r.name_product),i(2),c(r.cantidad),i(2),c(r.precioUnitario),i(2),c(r.precioVenta),i(2),c(r.precioTotal),i(2),c(r.option)}}function rt(n,t){if(n&1){let r=$();a(0,"div",35),_(1,"p-button",36),a(2,"p-button",37),C("click",function(){N(r);let p=w();return V(p.cleanAll())}),e(),a(3,"p-button",38),C("click",function(){N(r);let p=w();return V(p.submitPurchase())}),e()()}if(n&2){let r=w();i(),d("routerLink",E(2,Ye)),i(2),d("disabled",!r.purchaseForm.valid)}}var M=class n{constructor(t,r,o,p,g,S,b,F,x,P,y){this.confirmationServ=t;this.comprasServ=r;this.productosServ=o;this.translate=p;this.proveedoresServ=g;this.almacenesServ=S;this.translateLanService=b;this.fb=F;this.router=x;this.datePipe=P;this.toastServ=y;this.translateLanService.changeLanguage$.subscribe(h=>this.translate.use(h)),this.currentDate=this.datePipe.transform(new Date,"dd/MM/yyyy")||"",this.purchaseForm=this.fb.group({fechaCompra:[this.currentDate],id_proveedor:["",[ae.required]],cantidad:[""],precioUnitario:[""],precioVenta:[""],id_producto:[""],id_almacen:[""]}),this.proveedoresServ.postProveedoresSearch(null).subscribe({next:h=>this.proveedores=h,error:h=>console.error("Error al obtener proveedores:",h)}),z(()=>{this.almacenesServ.getAllAlmacenes().subscribe({next:h=>{this.almacenes=h},error:h=>console.log(h.message)})})}purchaseForm;comprasRegister;proveedores;productos;almacenes;detailView=[];stateInputs=B(!0);currentDate;total=0;totalCompra=0;stateDialog=B(!1);addDetail(){if(!this.purchaseForm.value.id_producto){alert("Debe de seleccionar producto para agregarlo. Por favor seleccione uno.");return}let t=Number(this.purchaseForm.value.id_producto.id);if(this.detailView.some(o=>o.id_producto===t||this.purchaseForm.value.id_producto=="")){alert("Este producto ya ha sido agregado. Por favor selecciona otro.");return}this.detailView.push({cantidad:Number(this.purchaseForm.value.cantidad),precioUnitario:Number(this.purchaseForm.value.precioUnitario),precioVenta:Number(this.purchaseForm.value.precioVenta),id_producto:Number(this.purchaseForm.value.id_producto.id),id_almacen:Number(this.purchaseForm.value.id_almacen.id),name_product:this.purchaseForm.value.id_producto.nombre,color:this.purchaseForm.value.id_producto.color}),this.funcTotal(),this.cleanForms()}funcTotal(){this.total=this.detailView.reduce((t,r)=>{let o=Number(r.cantidad)||0,p=Number(r.precioUnitario)||0;return t+o*p},0)}cleanForms(){this.purchaseForm.patchValue({total:this.total,id_producto:"",cantidad:"",precioUnitario:"",precioVenta:""},{emitEvent:!1}),this.totalCompra=0}updateDetail(t){this.purchaseForm.patchValue({id_producto:"",cantidad:"",precioUnitario:""},{emitEvent:!0})}changeProvider(){this.productosServ.postProductscProveedor(this.purchaseForm.value.id_proveedor.id).subscribe(t=>{this.productos=t.map(r=>j(k({},r),{display:`${r.nombre} (${r.color})  , ${r.color} - ${r.unidadMedida}`})),this.stateInputs.set(!1)})}changeTotalCompra(){console.log("this.totalCompra: "),this.totalCompra=this.purchaseForm.value.cantidad*this.purchaseForm.value.precioUnitario}submitPurchase(){if(this.purchaseForm.valid){let t=this.asignarValores();console.log(t),t.detalle=JSON.stringify(t.detalle),this.confirm(t)}else console.error("Formulario inv\xE1lido")}asignarValores(){let t=this.purchaseForm.value,o=new Date(t.fechaCompra).toISOString().split("T")[0];return console.log(String(this.datePipe.transform(this.getLastDateOfYear(new Date().getFullYear()),"yyyy-MM-dd"))),this.comprasRegister={fechaCompra:o,total:this.total,id_proveedor:t.id_proveedor.id,detalle:this.detailView.map(p=>(console.log(p),{cantidad:p.cantidad,precioUnitario:p.precioUnitario,precioVenta:p.precioVenta,id_producto:p.id_producto,id_almacen:p.id_almacen})),fechaVencimiento:String(this.datePipe.transform(this.getLastDateOfYear(new Date().getFullYear()),"yyyy-MM-dd"))},console.log(`console.log(this.comprasRegister);
 `,this.comprasRegister),this.comprasRegister}getLastDateOfYear(t){return new Date(t,11,31)}notifySuccess(){this.toastServ.showSuccess("Operation Successful","The action was completed successfully.")}notifyError(){this.toastServ.showError("Operation Failed","An error occurred while processing the action.")}confirm(t){this.confirmationServ.confirm({message:"Are you sure you want to perform this action?",header:"Confirmation",icon:"pi pi-exclamation-triangle",accept:()=>{this.comprasServ.postSaveCompras(t).subscribe({next:r=>{console.log("Action confirmed!"),r.CodigoEstado==="201"?(this.notifySuccess(),setTimeout(()=>{console.log("Compra registrada correctamente"),this.router.navigate(["/transactions/compras"])},3e3)):console.log(r)},error:r=>{console.error("Error al registrar la compra:",r)}})},reject:()=>{console.log("Action rejected!")}})}getColorBackground(t){switch(t){case"Natural":return"#cccccc";case"Champan":return"#FBE7C6";case"Negro":return"#000000";case"Madera":return"#8B4513";default:return"#FFFFFF"}}getColor(t){switch(t){case"Natural":return"#000000";case"Champan":return"#000000";case"Negro":return"#FFFFFF";case"Madera":return"#FFFFFF";default:return"#FFFFFF"}}deleteDetail(t){this.detailView=this.detailView.filter(r=>r!==t),this.funcTotal(),this.cleanForms()}updateData(){console.log("updateData() { } ")}cleanAll(){}static \u0275fac=function(r){return new(r||n)(u(te),u(Me),u(Ne),u(Q),u(De),u(D),u(ee),u(me),u(J),u(T),u(Re))};static \u0275cmp=U({type:n,selectors:[["app-purchase-create"]],features:[Y([T])],decls:82,vars:75,consts:[[3,"formGroup"],[3,"header"],[1,"flex","md:flex-row","sm:flex-row"],[1,"col-12","md:col-7","p-2","w-full"],[1,"flex","md:flex-row","flex-row","w-full","p-2"],[1,"flex","flex-wrap","justify-content-left","align-items-center","gap-2","p-2","lg:w-full","md:w-full","w-full"],[1,"w-25rem"],["dateFormat","dd/mm/yy","type","text","styleClass","w-full",1,"w-full",3,"formControlName"],[2,"color","red"],["pInputText","","type","text",1,"w-full",3,"value","disabled"],["optionLabel","empresa","styleClass","w-full","placeholder","Select un proveedor",1,"w-full","lg:w-full",3,"onChange","formControlName","options"],["optionLabel","display","placeholder","Seleccionar Producto","styleClass","w-full",1,"w-full","lg:w-full",3,"formControlName","options"],["optionLabel","nombre","placeholder","Seleccionar Almacen","styleClass","w-full",1,"w-full","lg:w-full",3,"formControlName","options"],[1,"flex","md:flex-row","flex-row","w-full"],[1,"flex","flex-wrap","justify-content-left","align-items-center","pb-4","lg:w-full","md:w-full","w-full","p-2"],["pInputText","","type","number",1,"w-full",3,"change","formControlName"],[1,"flex","flex-wrap","justify-content-left","align-items-center","gap-2","pb-4","w-full","p-2"],["pInputText","","type","number",1,"w-full",3,"formControlName"],["pInputText","","type","number","disabled","",1,"w-full",3,"value"],[1,"justify-content-center","align-items-center","pt-2"],[1,"flex","justify-content-between"],[1,"p-2"],["icon","pi pi-plus","severity","primary",3,"click","title"],["icon","pi pi-trash","severity","danger",3,"click","title"],[3,"value","tableStyle","styleClass"],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["pTemplate","footer"],[1,"from-stone-400"],[2,"width","6%","text-align","right"],[2,"width","40%"],[2,"width","12%","text-align","right"],[2,"width","6%"],[2,"text-align","right"],[1,"flex","gap-3","mt-1"],["label","Cancel","severity","danger","styleClass","w-full",1,"w-full",3,"routerLink"],["label","Limpiar","severity","secondary","styleClass","w-full",1,"w-full",3,"click"],["label","Save","styleClass","w-full",1,"w-full",3,"click","disabled"]],template:function(r,o){if(r&1&&(_(0,"p-toast")(1,"p-confirmDialog"),a(2,"form",0)(3,"p-card",1),s(4,"translate"),s(5,"uppercase"),a(6,"div",2)(7,"div",3)(8,"h6"),l(9),s(10,"translate"),s(11,"capitalize"),e(),a(12,"div",4)(13,"div",5)(14,"label",6),l(15),s(16,"translate"),e(),_(17,"p-datepicker",7),f(18,ze,2,0,"small",8),e(),a(19,"div",5)(20,"label",6),l(21),s(22,"translate"),e(),_(23,"input",9),e(),a(24,"div",5)(25,"label",6),l(26),s(27,"translate"),e(),a(28,"p-select",10),C("onChange",function(){return o.changeProvider()}),e(),f(29,He,2,0,"small",8),e(),a(30,"div",5)(31,"label",6),l(32),s(33,"translate"),e(),_(34,"p-select",11),f(35,qe,2,0,"small",8),e(),a(36,"div",5)(37,"label",6),l(38),s(39,"translate"),e(),_(40,"p-select",12),f(41,Je,2,0,"small",8),e()(),a(42,"div",13)(43,"div",14)(44,"label",6),l(45),s(46,"translate"),e(),a(47,"input",15),C("change",function(){return o.changeTotalCompra()}),e(),f(48,Ke,2,0,"small",8),e(),a(49,"div",16)(50,"label",6),l(51),s(52,"translate"),e(),a(53,"input",15),C("change",function(){return o.changeTotalCompra()}),e(),f(54,Qe,2,0,"small",8),e(),a(55,"div",16)(56,"label",6),l(57),s(58,"translate"),e(),_(59,"input",17),f(60,Xe,2,0,"small",8),e(),a(61,"div",16)(62,"label",6),l(63),s(64,"translate"),e(),_(65,"input",18),f(66,Ze,2,0,"small",8),e(),a(67,"div",19)(68,"label"),l(69),s(70,"translate"),e(),a(71,"div",20)(72,"p-buttonGroup",21)(73,"p-button",22),s(74,"translate"),C("click",function(){return o.addDetail()}),e(),a(75,"p-button",23),s(76,"translate"),C("click",function(){return o.updateData()}),e()()()()()()(),a(77,"p-table",24),f(78,et,4,5,"ng-template",25)(79,tt,13,0,"ng-template",26)(80,it,15,11,"ng-template",27),e(),f(81,rt,4,3,"ng-template",28),e()()),r&2){let p,g,S,b,F,x,P,y;i(2),d("formGroup",o.purchaseForm),i(),d("header",m(5,43,m(4,41,"labels.register_purchases"))),i(6),c(m(11,47,m(10,45,"labels.form_purchases"))),i(6),c(m(16,49,"labels.fechaCompra")),i(2),d("formControlName","fechaCompra"),i(),v((p=o.purchaseForm.get("fechaCompra"))!=null&&p.invalid&&((p=o.purchaseForm.get("fechaCompra"))!=null&&p.touched)?18:-1),i(3),c(m(22,51,"labels.precio_total")),i(2),d("value",o.total)("disabled",!0),i(3),c(m(27,53,"labels.proveedor")),i(2),O(E(73,$e)),d("formControlName","id_proveedor")("options",o.proveedores),i(),v((g=o.purchaseForm.get("id_proveedor"))!=null&&g.invalid&&((g=o.purchaseForm.get("id_proveedor"))!=null&&g.touched)?29:-1),i(3),c(m(33,55,"labels.producto")),i(2),d("formControlName","id_producto")("options",o.productos),i(),v((S=o.purchaseForm.get("id_producto"))!=null&&S.invalid&&((S=o.purchaseForm.get("id_producto"))!=null&&S.touched)?35:-1),i(3),c(m(39,57,"labels.almacen")),i(2),d("formControlName","id_almacen")("options",o.almacenes),i(),v((b=o.purchaseForm.get("id_almacen"))!=null&&b.invalid&&((b=o.purchaseForm.get("id_almacen"))!=null&&b.touched)?41:-1),i(4),c(m(46,59,"labels.cantidad")),i(2),d("formControlName","cantidad"),i(),v((F=o.purchaseForm.get("cantidad"))!=null&&F.invalid&&((F=o.purchaseForm.get("cantidad"))!=null&&F.touched)?48:-1),i(3),c(m(52,61,"labels.precioCompra")),i(2),d("formControlName","precioUnitario"),i(),v((x=o.purchaseForm.get("precioUnitario"))!=null&&x.invalid&&((x=o.purchaseForm.get("precioUnitario"))!=null&&x.touched)?54:-1),i(3),c(m(58,63,"labels.precioVenta")),i(2),d("formControlName","precioVenta"),i(),v((P=o.purchaseForm.get("precioVenta"))!=null&&P.invalid&&((P=o.purchaseForm.get("precioVenta"))!=null&&P.touched)?60:-1),i(3),c(m(64,65,"labels.totalCompra")),i(2),W("value",o.totalCompra),i(),v((y=o.purchaseForm.get("totaCompra"))!=null&&y.invalid&&((y=o.purchaseForm.get("totaCompra"))!=null&&y.touched)?66:-1),i(3),c(m(70,67,"labels.options")),i(4),d("title",m(74,69,"label.add_detall")),i(2),d("title",m(76,71,"label.delet_detall")),i(2),d("value",o.detailView)("tableStyle",E(74,We))("styleClass","p-datatable-sm w-full")}},dependencies:[Ee,ie,Ie,Ce,_e,de,le,re,pe,oe,ne,ce,se,we,ye,Z,X,fe,ue,Fe,be,ve,he,H,Se,ge,je,ke,Pe,xe,Be,Ve,Ue,Le,K,Ae,I],encapsulation:2})};export{M as default};
