import{a as De,b as ke,c as Be,d as Me}from"./chunk-7EGGV4ZR.js";import{a as Ie,b as Ne}from"./chunk-H3YCI24L.js";import{a as Ve}from"./chunk-2LRB4YVM.js";import{a as Pe}from"./chunk-KDAYLFQV.js";import{a as xe,b as ye}from"./chunk-LA7W5Q2G.js";import{a as Ee}from"./chunk-OFSYLXU5.js";import{a as Te}from"./chunk-AZTZBJ7G.js";import"./chunk-B6S7RKMX.js";import{b as ge,i as be}from"./chunk-7I7RVYL5.js";import"./chunk-Y5YU34J4.js";import{a as we}from"./chunk-TI43OP6K.js";import{a as Fe}from"./chunk-Q2L4726D.js";import{b as Se}from"./chunk-24P64EU3.js";import"./chunk-G255QGHI.js";import{b as z,c as J,d as H,e as K}from"./chunk-IJWSAIOW.js";import{j as Y,k as q}from"./chunk-NU7MKXHP.js";import{i as de,j as ue,l as he,m as fe,n as ve,s as _e,t as Ce}from"./chunk-NB3FZJAV.js";import{b as me}from"./chunk-CKCKXBPA.js";import{E as pe,F as se,g as X,h as B,j as Z,k as ee,m as te,n as ie,o as re,p as ae,r as oe,t as ne,u as le,v as ce}from"./chunk-QQUKQJE3.js";import"./chunk-F2X3VGZZ.js";import{Y as Q}from"./chunk-UMAONBSZ.js";import{r as W,s as D}from"./chunk-OF6IZINW.js";import{$ as b,Aa as t,Cb as G,Fa as h,Ma as U,Mb as l,Nb as d,Sa as f,Ub as $,Vb as I,_ as g,cb as m,cc as p,db as A,dc as s,fb as L,fc as N,ib as _,ma as k,nb as i,ob as e,pb as v,sc as O,tb as V,yb as S,zb as w}from"./chunk-H3HIGMDG.js";import{a as R,b as j}from"./chunk-C6Q5SG76.js";var Re=()=>({width:"100%"}),je=()=>({width:"100%"}),Ue=()=>["/transactions/compras"];function Ae(c,r){c&1&&(i(0,"small",11),l(1,"Error en el Fecha de Compra."),e())}function Le(c,r){c&1&&(i(0,"small",11),l(1,"Error en el Proveedor Seleccionado."),e())}function Ge(c,r){c&1&&(i(0,"small",11),l(1,"Error en el Producto seleccionado."),e())}function $e(c,r){c&1&&(i(0,"small",11),l(1,"Error en el Almacen seleccionado."),e())}function Oe(c,r){c&1&&(i(0,"small",11),l(1,"Error en el Fecha de Compra."),e())}function We(c,r){c&1&&(i(0,"small",11),l(1,"Error en el Precio de Compra."),e())}function Ye(c,r){c&1&&(i(0,"small",11),l(1,"Error en el Precio de Venta."),e())}function qe(c,r){c&1&&(i(0,"small",11),l(1,"Error en el Precio de Venta."),e())}function ze(c,r){c&1&&(i(0,"tr")(1,"th",25),l(2,"No"),e(),i(3,"th",26),l(4,"Producto"),e(),i(5,"th",27),l(6,"Cantidad"),e(),i(7,"th",27),l(8,"Precio Unitario"),e(),i(9,"th",27),l(10,"Precio Total"),e(),i(11,"th",28),l(12,"Option"),e(),v(13,"th"),e())}function Je(c,r){if(c&1&&(i(0,"tr"),v(1,"td")(2,"td")(3,"td"),i(4,"th",29)(5,"label"),l(6),p(7,"translate"),e()(),i(8,"th")(9,"div",8),v(10,"input",30),e()(),v(11,"th"),e()),c&2){let a=w(2);t(6),d(s(7,3,"labels.precio_total")),t(4),m("value",a.total)("disabled",!0)}}function He(c,r){if(c&1){let a=V();i(0,"tr")(1,"td",29),l(2),e(),i(3,"td"),l(4),e(),i(5,"td",29),l(6),e(),i(7,"td",29),l(8),e(),i(9,"td",29),l(10),e(),i(11,"td",29),l(12),e(),i(13,"td",29)(14,"p-buttonGroup")(15,"p-button",23),p(16,"translate"),S("click",function(){let n=g(a).$implicit,u=w();return b(u.deleteDetail(n))}),e()()()(),f(17,Je,12,5,"tr")}if(c&2){let a=r.$implicit,o=r.rowIndex,n=w();t(2),d(o+1),t(),A("background-color",n.getColorBackground(a.color))("color",n.getColor(a.color)),t(),d(a.name_product),t(2),d(a.cantidad),t(2),d(a.precioUnitario),t(2),d(a.precioVenta),t(2),d(a.precioTotal),t(3),m("title",s(16,12,"label.delet_detall")),t(2),_(o+1===n.detailView.length?17:-1)}}function Ke(c,r){if(c&1){let a=V();i(0,"div",31),v(1,"p-button",32),i(2,"p-button",33),S("click",function(){g(a);let n=w();return b(n.cleanAll())}),e(),i(3,"p-button",34),S("click",function(){g(a);let n=w();return b(n.submitPurchase())}),e()()}if(c&2){let a=w();t(),m("routerLink",I(2,Ue)),t(2),m("disabled",!a.purchaseForm.valid)}}var M=class c{constructor(r,a,o,n,u,F,x,y,P,E,T){this.confirmationServ=r;this.comprasServ=a;this.productosServ=o;this.translate=n;this.proveedoresServ=u;this.almacenesServ=F;this.translateLanService=x;this.fb=y;this.router=P;this.datePipe=E;this.toastServ=T;this.translateLanService.changeLanguage$.subscribe(C=>this.translate.use(C)),this.purchaseForm=this.fb.group({fechaCompra:[B.required],id_proveedor:["",[B.required]],cantidad:[""],precioUnitario:[""],precioVenta:[""],id_producto:[""],id_almacen:[""]}),this.proveedoresServ.postProveedoresSearch(null).subscribe({next:C=>this.proveedores=C,error:C=>console.error("Error al obtener proveedores:",C)}),O(()=>{this.almacenesServ.getAll().subscribe({next:C=>{this.almacenes=C},error:C=>console.log(C.message)})})}purchaseForm;comprasRegister;proveedores;productos;almacenes;detailView=[];stateInputs=k(!0);currentDate;total=0;totalCompra=0;stateDialog=k(!1);addDetail(){if(!this.purchaseForm.value.id_producto){alert("Debe de seleccionar producto para agregarlo. Por favor seleccione uno.");return}let r=Number(this.purchaseForm.value.id_producto.id);if(this.detailView.some(o=>o.id_producto===r||this.purchaseForm.value.id_producto=="")){alert("Este producto ya ha sido agregado. Por favor selecciona otro.");return}this.detailView.push({cantidad:Number(this.purchaseForm.value.cantidad),cantidadRecibida:Number(this.purchaseForm.value.cantidad),precioUnitario:Number(this.purchaseForm.value.precioUnitario),precioVenta:Number(this.purchaseForm.value.precioVenta),id_producto:Number(this.purchaseForm.value.id_producto.id),id_almacen:Number(this.purchaseForm.value.id_almacen.id),name_product:this.purchaseForm.value.id_producto.nombre,color:this.purchaseForm.value.id_producto.color}),this.funcTotal(),this.cleanForms()}funcTotal(){this.total=this.detailView.reduce((r,a)=>{let o=Number(a.cantidad)||0,n=Number(a.precioUnitario)||0;return r+o*n},0)}cleanForms(){this.purchaseForm.patchValue({total:this.total,id_producto:"",cantidad:"",precioUnitario:"",precioVenta:""},{emitEvent:!1}),this.totalCompra=0}updateDetail(r){this.purchaseForm.patchValue({id_producto:"",cantidad:"",precioUnitario:""},{emitEvent:!0})}changeProvider(){this.productosServ.postProductscProveedor(this.purchaseForm.value.id_proveedor.id).subscribe(r=>{this.productos=r.map(a=>j(R({},a),{display:`${a.nombre} (${a.color})  , ${a.color} - ${a.unidadMedida}`})),this.stateInputs.set(!1)})}changeTotalCompra(){console.log("this.totalCompra: "),this.totalCompra=this.purchaseForm.value.cantidad*this.purchaseForm.value.precioUnitario}submitPurchase(){if(this.purchaseForm.valid){let r=this.asignarValores();console.log(r),r.detalle=JSON.stringify(r.detalle),this.confirm(r)}else console.error("Formulario inv\xE1lido")}asignarValores(){let r=this.purchaseForm.value;console.log(r.fechaCompra);let o=new Date(r.fechaCompra).toISOString().split("T")[0];return console.log(o),this.comprasRegister={fechaCompra:o,total:this.total,id_proveedor:r.id_proveedor.id,detalle:this.detailView.map(n=>(console.log(n),{cantidad:n.cantidad,cantidadRecibida:n.cant,precioUnitario:n.precioUnitario,precioVenta:n.precioVenta,id_producto:n.id_producto,id_almacen:n.id_almacen})),fechaVencimiento:String(this.datePipe.transform(this.getLastDateOfYear(new Date().getFullYear()),"yyyy-MM-dd"))},console.log(`console.log(this.comprasRegister);
 `,this.comprasRegister),this.comprasRegister}getLastDateOfYear(r){return new Date(r,11,31)}notifySuccess(){this.toastServ.showSuccess("Operation Successful","The action was completed successfully.")}notifyError(){this.toastServ.showError("Operation Failed","An error occurred while processing the action.")}confirm(r){this.confirmationServ.confirm({message:"Are you sure you want to perform this action?",header:"Confirmation",icon:"pi pi-exclamation-triangle",accept:()=>{this.comprasServ.postSaveCompras(r).subscribe({next:a=>{console.log("Action confirmed!"),a.CodigoEstado==="201"?(this.notifySuccess(),setTimeout(()=>{console.log("Compra registrada correctamente"),console.log(`/transactions/compras/detail/${a.id}`),this.router.navigate([`/transactions/compras/detail/${a.id}`])},3e3)):console.log(a)},error:a=>{console.error("Error al registrar la compra:",a)}})},reject:()=>{console.log("Action rejected!")}})}getColorBackground(r){switch(r){case"Natural":return"#cccccc";case"Champan":return"#FBE7C6";case"Negro":return"#000000";case"Madera":return"#8B4513";default:return"#FFFFFF"}}getColor(r){switch(r){case"Natural":return"#000000";case"Champan":return"#000000";case"Negro":return"#FFFFFF";case"Madera":return"#FFFFFF";default:return"#FFFFFF"}}deleteDetail(r){this.detailView=this.detailView.filter(a=>a!==r),this.funcTotal(),this.cleanForms()}updateData(){console.log("updateData() { } ")}cleanAll(){}static \u0275fac=function(a){return new(a||c)(h(Q),h(Ve),h(Ee),h(z),h(Fe),h(Te),h(K),h(oe),h(Y),h(D),h(Pe))};static \u0275cmp=U({type:c,selectors:[["app-purchase-create"]],features:[$([D])],decls:77,vars:76,consts:[["header",""],["body",""],["footer",""],[3,"formGroup"],[3,"header","subheader"],[1,"flex","md:flex-row","sm:flex-row"],[1,"col-12","md:col-7","w-full"],[1,"flex","md:flex-row","flex-row","w-full"],[1,"flex","flex-wrap","justify-content-left","align-items-center","gap-2","p-2","lg:w-full","md:w-full","w-full"],[1,"w-25rem"],["dateFormat","dd/mm/yy","type","text","styleClass","w-full","placeholder","Seleccionar fecha",1,"w-full",3,"formControlName"],[2,"color","red"],["optionLabel","empresa","styleClass","w-full","placeholder","Select un proveedor",1,"w-full","lg:w-full",3,"onChange","formControlName","options","checkmark","editable","showClear"],["optionLabel","display","placeholder","Seleccionar Producto","styleClass","w-full","placeholder","Seleccionar un Producto",1,"w-full","lg:w-full",3,"formControlName","options","checkmark","editable","showClear"],["optionLabel","nombre","placeholder","Seleccionar Almacen","styleClass","w-full",1,"w-full","lg:w-full",3,"formControlName","options"],[1,"flex","flex-wrap","justify-content-left","align-items-center","pb-4","lg:w-full","md:w-full","w-full","p-2"],["pInputText","","type","number",1,"w-full",3,"change","formControlName"],[1,"flex","flex-wrap","justify-content-left","align-items-center","gap-2","pb-4","w-full","p-2"],["pInputText","","type","number",1,"w-full",3,"formControlName"],["pInputText","","type","number","disabled","",1,"w-full",3,"value"],[1,"justify-content-center","align-items-center","p-2"],[1,"flex","justify-content-between","pt-2"],["icon","pi pi-plus","severity","primary",3,"click","title"],["icon","pi pi-trash","severity","danger",3,"click","title"],[3,"value","tableStyle","styleClass"],[2,"width","6%","text-align","right"],[2,"width","48%"],[2,"width","12%","text-align","right"],[2,"width","6%"],[2,"text-align","right"],["pInputText","","type","text",1,"w-full",3,"value","disabled"],[1,"flex","gap-3","mt-1"],["label","Cancel","severity","danger","styleClass","w-full",1,"w-full",3,"routerLink"],["label","Limpiar","severity","secondary","styleClass","w-full",1,"w-full",3,"click"],["label","Save","styleClass","w-full",1,"w-full",3,"click","disabled"]],template:function(a,o){if(a&1){let n=V();v(0,"p-toast")(1,"p-confirmDialog"),i(2,"form",3)(3,"p-card",4),p(4,"translate"),p(5,"uppercase"),p(6,"translate"),p(7,"capitalize"),i(8,"div",5)(9,"div",6)(10,"div",7)(11,"div",8)(12,"label",9),l(13),p(14,"translate"),e(),v(15,"p-datepicker",10),f(16,Ae,2,0,"small",11),e(),i(17,"div",8)(18,"label",9),l(19),p(20,"translate"),e(),i(21,"p-select",12),S("onChange",function(){return g(n),b(o.changeProvider())}),e(),f(22,Le,2,0,"small",11),e(),i(23,"div",8)(24,"label",9),l(25),p(26,"translate"),e(),v(27,"p-select",13),f(28,Ge,2,0,"small",11),e(),i(29,"div",8)(30,"label",9),l(31),p(32,"translate"),e(),v(33,"p-select",14),f(34,$e,2,0,"small",11),e()(),i(35,"div",7)(36,"div",15)(37,"label",9),l(38),p(39,"translate"),e(),i(40,"input",16),S("change",function(){return g(n),b(o.changeTotalCompra())}),e(),f(41,Oe,2,0,"small",11),e(),i(42,"div",17)(43,"label",9),l(44),p(45,"translate"),e(),i(46,"input",16),S("change",function(){return g(n),b(o.changeTotalCompra())}),e(),f(47,We,2,0,"small",11),e(),i(48,"div",17)(49,"label",9),l(50),p(51,"translate"),e(),v(52,"input",18),f(53,Ye,2,0,"small",11),e(),i(54,"div",17)(55,"label",9),l(56),p(57,"translate"),e(),v(58,"input",19),f(59,qe,2,0,"small",11),e(),i(60,"div",20)(61,"label"),l(62),p(63,"translate"),e(),i(64,"div",21)(65,"p-buttonGroup")(66,"p-button",22),p(67,"translate"),S("click",function(){return g(n),b(o.addDetail())}),e(),i(68,"p-button",23),p(69,"translate"),S("click",function(){return g(n),b(o.updateData())}),e()()()()()()(),i(70,"p-table",24),f(71,ze,14,0,"ng-template",null,0,N)(73,He,18,14,"ng-template",null,1,N),e(),f(75,Ke,4,3,"ng-template",null,2,N),e()()}if(a&2){let n,u,F,x,y,P,E,T;t(2),m("formGroup",o.purchaseForm),t(),m("header",s(5,46,s(4,44,"pages.register_purchases")))("subheader",s(7,50,s(6,48,"labels.form_purchases"))),t(10),d(s(14,52,"labels.fechaCompra")),t(2),m("formControlName","fechaCompra"),t(),_((n=o.purchaseForm.get("fechaCompra"))!=null&&n.invalid&&((n=o.purchaseForm.get("fechaCompra"))!=null&&n.touched)?16:-1),t(3),d(s(20,54,"labels.proveedor")),t(2),L(I(74,Re)),m("formControlName","id_proveedor")("options",o.proveedores)("checkmark",!0)("editable",!0)("showClear",!0),t(),_((u=o.purchaseForm.get("id_proveedor"))!=null&&u.invalid&&((u=o.purchaseForm.get("id_proveedor"))!=null&&u.touched)?22:-1),t(3),d(s(26,56,"labels.producto")),t(2),m("formControlName","id_producto")("options",o.productos)("checkmark",!0)("editable",!0)("showClear",!0),t(),_((F=o.purchaseForm.get("id_producto"))!=null&&F.invalid&&((F=o.purchaseForm.get("id_producto"))!=null&&F.touched)?28:-1),t(3),d(s(32,58,"labels.almacen")),t(2),m("formControlName","id_almacen")("options",o.almacenes),t(),_((x=o.purchaseForm.get("id_almacen"))!=null&&x.invalid&&((x=o.purchaseForm.get("id_almacen"))!=null&&x.touched)?34:-1),t(4),d(s(39,60,"labels.cantidad")),t(2),m("formControlName","cantidad"),t(),_((y=o.purchaseForm.get("cantidad"))!=null&&y.invalid&&((y=o.purchaseForm.get("cantidad"))!=null&&y.touched)?41:-1),t(3),d(s(45,62,"labels.precioCompra")),t(2),m("formControlName","precioUnitario"),t(),_((P=o.purchaseForm.get("precioUnitario"))!=null&&P.invalid&&((P=o.purchaseForm.get("precioUnitario"))!=null&&P.touched)?47:-1),t(3),d(s(51,64,"labels.precioVenta")),t(2),m("formControlName","precioVenta"),t(),_((E=o.purchaseForm.get("precioVenta"))!=null&&E.invalid&&((E=o.purchaseForm.get("precioVenta"))!=null&&E.touched)?53:-1),t(3),d(s(57,66,"labels.totalCompra")),t(2),G("value",o.totalCompra),t(),_((T=o.purchaseForm.get("totaCompra"))!=null&&T.invalid&&((T=o.purchaseForm.get("totaCompra"))!=null&&T.touched)?59:-1),t(3),d(s(63,68,"labels.options")),t(4),m("title",s(67,70,"label.add_detall")),t(2),m("title",s(69,72,"label.delet_detall")),t(2),m("value",o.detailView)("tableStyle",I(75,je))("styleClass","p-datatable-sm w-full")}},dependencies:[Se,we,he,me,ne,te,X,ie,Z,ee,re,ae,ue,de,H,J,ce,le,Ce,_e,se,pe,W,ve,fe,Ne,Ie,be,ge,ye,xe,Be,ke,q,De,Me],encapsulation:2})};export{M as default};
