import{a as Be,b as ke,c as Me}from"./chunk-JGI7BUMW.js";import{a as Ne,b as De,c as je}from"./chunk-JORENFPD.js";import{a as Ve}from"./chunk-2GJCXAXH.js";import{a as Ee}from"./chunk-A4GWC2U6.js";import{a as Pe,b as ye}from"./chunk-LSVQDGMS.js";import{a as Te}from"./chunk-H44DAFP6.js";import{a as Ie}from"./chunk-A7MSWSMG.js";import{b as Ce,i as ge}from"./chunk-WB22MYLO.js";import"./chunk-5PQNPMCX.js";import"./chunk-X25LBHHL.js";import{a as xe}from"./chunk-I5ZMKN3T.js";import{a as Fe}from"./chunk-BJ6VW7JG.js";import{b as we}from"./chunk-IL66U5PP.js";import{j as ue,k as he,l as fe,q as ve,r as _e,s as Se,t as be}from"./chunk-72EFRCC2.js";import{b as de}from"./chunk-TEPZEHNQ.js";import{Aa as ne,Ca as le,Da as ce,Ea as pe,Na as se,Oa as me,W as Q,b as q,c as J,ca as X,d as H,e as K,pa as Z,qa as k,sa as ee,ta as te,va as ie,wa as re,xa as ae,ya as oe}from"./chunk-EBX3HSBQ.js";import{A as Y,k as W,l as N,z}from"./chunk-NZR6XVXW.js";import"./chunk-F2X3VGZZ.js";import{$ as S,Aa as t,Bb as G,Fa as u,Lb as n,Ma as U,Mb as p,Sa as h,Sb as $,Tb as I,_ as g,ac as s,bc as m,cb as d,db as A,dc as V,fb as L,ib as v,ma as D,nb as i,ob as e,pb as _,qc as O,tb as B,xb as b,yb as T}from"./chunk-5DVEH5ZE.js";import{a as j,b as R}from"./chunk-C6Q5SG76.js";var Re=()=>({width:"100%"}),Ue=()=>({width:"100%"}),Ae=()=>["/transactions/compras"];function Le(l,r){l&1&&(i(0,"small",11),n(1,"Error en el Fecha de Compra."),e())}function Ge(l,r){l&1&&(i(0,"small",11),n(1,"Error en el Proveedor Seleccionado."),e())}function $e(l,r){l&1&&(i(0,"small",11),n(1,"Error en el Producto seleccionado."),e())}function Oe(l,r){l&1&&(i(0,"small",11),n(1,"Error en el Almacen seleccionado."),e())}function We(l,r){l&1&&(i(0,"small",11),n(1,"Error en el Fecha de Compra."),e())}function ze(l,r){l&1&&(i(0,"small",11),n(1,"Error en el Precio de Compra."),e())}function Ye(l,r){l&1&&(i(0,"small",11),n(1,"Error en el Precio de Venta."),e())}function qe(l,r){l&1&&(i(0,"small",11),n(1,"Error en el Precio de Venta."),e())}function Je(l,r){l&1&&(i(0,"div",27),n(1),s(2,"translate"),s(3,"capitalize"),e()),l&2&&(t(),p(m(3,3,m(2,1,"labels.details"))))}function He(l,r){l&1&&(i(0,"tr")(1,"th",28),n(2,"No"),e(),i(3,"th",29),n(4,"Producto"),e(),i(5,"th",30),n(6,"Cantidad"),e(),i(7,"th",30),n(8,"Precio Unitario"),e(),i(9,"th",30),n(10,"Precio Total"),e(),i(11,"th",31),n(12,"Option"),e()())}function Ke(l,r){l&1&&(i(0,"tr"),_(1,"td")(2,"td")(3,"td"),i(4,"th",32)(5,"label",9),n(6),s(7,"translate"),e()()()),l&2&&(t(6),p(m(7,1,"labels.precio_total")))}function Qe(l,r){if(l&1&&(i(0,"tr")(1,"td",32),n(2),e(),i(3,"td"),n(4),e(),i(5,"td",32),n(6),e(),i(7,"td",32),n(8),e(),i(9,"td",32),n(10),e(),i(11,"td",32),n(12),e(),i(13,"td",32),n(14),e()(),h(15,Ke,8,3,"tr")),l&2){let o=r.$implicit,a=r.rowIndex,c=T();t(2),p(a+1),t(),A("background-color",c.getColorBackground(o.color))("color",c.getColor(o.color)),t(),p(o.name_product),t(2),p(o.cantidad),t(2),p(o.precioUnitario),t(2),p(o.precioVenta),t(2),p(o.precioTotal),t(2),p(o.option),t(),v(a+1===c.detailView.length?15:-1)}}function Xe(l,r){if(l&1){let o=B();i(0,"div",33),_(1,"p-button",34),i(2,"p-button",35),b("click",function(){g(o);let c=T();return S(c.cleanAll())}),e(),i(3,"p-button",36),b("click",function(){g(o);let c=T();return S(c.submitPurchase())}),e()()}if(l&2){let o=T();t(),d("routerLink",I(2,Ae)),t(2),d("disabled",!o.purchaseForm.valid)}}var M=class l{constructor(r,o,a,c,f,w,x,F,P,y,E){this.confirmationServ=r;this.comprasServ=o;this.productosServ=a;this.translate=c;this.proveedoresServ=f;this.almacenesServ=w;this.translateLanService=x;this.fb=F;this.router=P;this.datePipe=y;this.toastServ=E;this.translateLanService.changeLanguage$.subscribe(C=>this.translate.use(C)),this.purchaseForm=this.fb.group({fechaCompra:[k.required],id_proveedor:["",[k.required]],cantidad:[""],precioUnitario:[""],precioVenta:[""],id_producto:[""],id_almacen:[""]}),this.proveedoresServ.postProveedoresSearch(null).subscribe({next:C=>this.proveedores=C,error:C=>console.error("Error al obtener proveedores:",C)}),O(()=>{this.almacenesServ.getAll().subscribe({next:C=>{this.almacenes=C},error:C=>console.log(C.message)})})}purchaseForm;comprasRegister;proveedores;productos;almacenes;detailView=[];stateInputs=D(!0);currentDate;total=0;totalCompra=0;stateDialog=D(!1);addDetail(){if(!this.purchaseForm.value.id_producto){alert("Debe de seleccionar producto para agregarlo. Por favor seleccione uno.");return}let r=Number(this.purchaseForm.value.id_producto.id);if(this.detailView.some(a=>a.id_producto===r||this.purchaseForm.value.id_producto=="")){alert("Este producto ya ha sido agregado. Por favor selecciona otro.");return}this.detailView.push({cantidad:Number(this.purchaseForm.value.cantidad),precioUnitario:Number(this.purchaseForm.value.precioUnitario),precioVenta:Number(this.purchaseForm.value.precioVenta),id_producto:Number(this.purchaseForm.value.id_producto.id),id_almacen:Number(this.purchaseForm.value.id_almacen.id),name_product:this.purchaseForm.value.id_producto.nombre,color:this.purchaseForm.value.id_producto.color}),this.funcTotal(),this.cleanForms()}funcTotal(){this.total=this.detailView.reduce((r,o)=>{let a=Number(o.cantidad)||0,c=Number(o.precioUnitario)||0;return r+a*c},0)}cleanForms(){this.purchaseForm.patchValue({total:this.total,id_producto:"",cantidad:"",precioUnitario:"",precioVenta:""},{emitEvent:!1}),this.totalCompra=0}updateDetail(r){this.purchaseForm.patchValue({id_producto:"",cantidad:"",precioUnitario:""},{emitEvent:!0})}changeProvider(){this.productosServ.postProductscProveedor(this.purchaseForm.value.id_proveedor.id).subscribe(r=>{this.productos=r.map(o=>R(j({},o),{display:`${o.nombre} (${o.color})  , ${o.color} - ${o.unidadMedida}`})),this.stateInputs.set(!1)})}changeTotalCompra(){console.log("this.totalCompra: "),this.totalCompra=this.purchaseForm.value.cantidad*this.purchaseForm.value.precioUnitario}submitPurchase(){if(this.purchaseForm.valid){let r=this.asignarValores();console.log(r),r.detalle=JSON.stringify(r.detalle),this.confirm(r)}else console.error("Formulario inv\xE1lido")}asignarValores(){let r=this.purchaseForm.value;console.log(r.fechaCompra);let a=new Date(r.fechaCompra).toISOString().split("T")[0];return console.log(a),this.comprasRegister={fechaCompra:a,total:this.total,id_proveedor:r.id_proveedor.id,detalle:this.detailView.map(c=>(console.log(c),{cantidad:c.cantidad,precioUnitario:c.precioUnitario,precioVenta:c.precioVenta,id_producto:c.id_producto,id_almacen:c.id_almacen})),fechaVencimiento:String(this.datePipe.transform(this.getLastDateOfYear(new Date().getFullYear()),"yyyy-MM-dd"))},console.log(`console.log(this.comprasRegister);
 `,this.comprasRegister),this.comprasRegister}getLastDateOfYear(r){return new Date(r,11,31)}notifySuccess(){this.toastServ.showSuccess("Operation Successful","The action was completed successfully.")}notifyError(){this.toastServ.showError("Operation Failed","An error occurred while processing the action.")}confirm(r){this.confirmationServ.confirm({message:"Are you sure you want to perform this action?",header:"Confirmation",icon:"pi pi-exclamation-triangle",accept:()=>{this.comprasServ.postSaveCompras(r).subscribe({next:o=>{console.log("Action confirmed!"),o.CodigoEstado==="201"?(this.notifySuccess(),setTimeout(()=>{console.log("Compra registrada correctamente"),console.log(`/transactions/compras/detail/${o.id}`),this.router.navigate([`/transactions/compras/detail/${o.id}`])},3e3)):console.log(o)},error:o=>{console.error("Error al registrar la compra:",o)}})},reject:()=>{console.log("Action rejected!")}})}getColorBackground(r){switch(r){case"Natural":return"#cccccc";case"Champan":return"#FBE7C6";case"Negro":return"#000000";case"Madera":return"#8B4513";default:return"#FFFFFF"}}getColor(r){switch(r){case"Natural":return"#000000";case"Champan":return"#000000";case"Negro":return"#FFFFFF";case"Madera":return"#FFFFFF";default:return"#FFFFFF"}}deleteDetail(r){this.detailView=this.detailView.filter(o=>o!==r),this.funcTotal(),this.cleanForms()}updateData(){console.log("updateData() { } ")}cleanAll(){}static \u0275fac=function(o){return new(o||l)(u(Q),u(Ve),u(Te),u(q),u(Fe),u(Ie),u(K),u(ne),u(z),u(N),u(Ee))};static \u0275cmp=U({type:l,selectors:[["app-purchase-create"]],features:[$([N])],decls:83,vars:81,consts:[["header",""],["body",""],["footer",""],[3,"formGroup"],[3,"header","subheader"],[1,"flex","md:flex-row","sm:flex-row"],[1,"col-12","md:col-7","w-full"],[1,"flex","md:flex-row","flex-row","w-full"],[1,"flex","flex-wrap","justify-content-left","align-items-center","gap-2","p-2","lg:w-full","md:w-full","w-full"],[1,"w-25rem"],["dateFormat","dd/mm/yy","type","text","styleClass","w-full","placeholder","Seleccionar fecha",1,"w-full",3,"formControlName"],[2,"color","red"],["pInputText","","type","text",1,"w-full",3,"value","disabled"],["optionLabel","empresa","styleClass","w-full","placeholder","Select un proveedor",1,"w-full","lg:w-full",3,"onChange","formControlName","options","checkmark","editable","showClear"],["optionLabel","display","placeholder","Seleccionar Producto","styleClass","w-full","placeholder","Seleccionar un Producto",1,"w-full","lg:w-full",3,"formControlName","options","checkmark","editable","showClear"],["optionLabel","nombre","placeholder","Seleccionar Almacen","styleClass","w-full",1,"w-full","lg:w-full",3,"formControlName","options"],[1,"flex","flex-wrap","justify-content-left","align-items-center","pb-4","lg:w-full","md:w-full","w-full","p-2"],["pInputText","","type","number",1,"w-full",3,"change","formControlName"],[1,"flex","flex-wrap","justify-content-left","align-items-center","gap-2","pb-4","w-full","p-2"],["pInputText","","type","number",1,"w-full",3,"formControlName"],["pInputText","","type","number","disabled","",1,"w-full",3,"value"],[1,"justify-content-center","align-items-center","p-2"],[1,"flex","justify-content-between","pt-2"],["icon","pi pi-plus","severity","primary",3,"click","title"],["icon","pi pi-trash","severity","danger",3,"click","title"],[3,"value","tableStyle","styleClass"],["pTemplate","caption"],[1,"from-stone-400"],[2,"width","6%","text-align","right"],[2,"width","40%"],[2,"width","12%","text-align","right"],[2,"width","6%"],[2,"text-align","right"],[1,"flex","gap-3","mt-1"],["label","Cancel","severity","danger","styleClass","w-full",1,"w-full",3,"routerLink"],["label","Limpiar","severity","secondary","styleClass","w-full",1,"w-full",3,"click"],["label","Save","styleClass","w-full",1,"w-full",3,"click","disabled"]],template:function(o,a){if(o&1){let c=B();_(0,"p-toast")(1,"p-confirmDialog"),i(2,"form",3)(3,"p-card",4),s(4,"translate"),s(5,"uppercase"),s(6,"translate"),s(7,"capitalize"),i(8,"div",5)(9,"div",6)(10,"div",7)(11,"div",8)(12,"label",9),n(13),s(14,"translate"),e(),_(15,"p-datepicker",10),h(16,Le,2,0,"small",11),e(),i(17,"div",8)(18,"label",9),n(19),s(20,"translate"),e(),_(21,"input",12),e(),i(22,"div",8)(23,"label",9),n(24),s(25,"translate"),e(),i(26,"p-select",13),b("onChange",function(){return g(c),S(a.changeProvider())}),e(),h(27,Ge,2,0,"small",11),e(),i(28,"div",8)(29,"label",9),n(30),s(31,"translate"),e(),_(32,"p-select",14),h(33,$e,2,0,"small",11),e(),i(34,"div",8)(35,"label",9),n(36),s(37,"translate"),e(),_(38,"p-select",15),h(39,Oe,2,0,"small",11),e()(),i(40,"div",7)(41,"div",16)(42,"label",9),n(43),s(44,"translate"),e(),i(45,"input",17),b("change",function(){return g(c),S(a.changeTotalCompra())}),e(),h(46,We,2,0,"small",11),e(),i(47,"div",18)(48,"label",9),n(49),s(50,"translate"),e(),i(51,"input",17),b("change",function(){return g(c),S(a.changeTotalCompra())}),e(),h(52,ze,2,0,"small",11),e(),i(53,"div",18)(54,"label",9),n(55),s(56,"translate"),e(),_(57,"input",19),h(58,Ye,2,0,"small",11),e(),i(59,"div",18)(60,"label",9),n(61),s(62,"translate"),e(),_(63,"input",20),h(64,qe,2,0,"small",11),e(),i(65,"div",21)(66,"label"),n(67),s(68,"translate"),e(),i(69,"div",22)(70,"p-buttonGroup")(71,"p-button",23),s(72,"translate"),b("click",function(){return g(c),S(a.addDetail())}),e(),i(73,"p-button",24),s(74,"translate"),b("click",function(){return g(c),S(a.updateData())}),e()()()()()()(),i(75,"p-table",25),h(76,Je,4,5,"ng-template",26)(77,He,13,0,"ng-template",null,0,V)(79,Qe,16,12,"ng-template",null,1,V),e(),h(81,Xe,4,3,"ng-template",null,2,V),e()()}if(o&2){let c,f,w,x,F,P,y,E;t(2),d("formGroup",a.purchaseForm),t(),d("header",m(5,49,m(4,47,"pages.register_purchases")))("subheader",m(7,53,m(6,51,"labels.form_purchases"))),t(10),p(m(14,55,"labels.fechaCompra")),t(2),d("formControlName","fechaCompra"),t(),v((c=a.purchaseForm.get("fechaCompra"))!=null&&c.invalid&&((c=a.purchaseForm.get("fechaCompra"))!=null&&c.touched)?16:-1),t(3),p(m(20,57,"labels.precio_total")),t(2),d("value",a.total)("disabled",!0),t(3),p(m(25,59,"labels.proveedor")),t(2),L(I(79,Re)),d("formControlName","id_proveedor")("options",a.proveedores)("checkmark",!0)("editable",!0)("showClear",!0),t(),v((f=a.purchaseForm.get("id_proveedor"))!=null&&f.invalid&&((f=a.purchaseForm.get("id_proveedor"))!=null&&f.touched)?27:-1),t(3),p(m(31,61,"labels.producto")),t(2),d("formControlName","id_producto")("options",a.productos)("checkmark",!0)("editable",!0)("showClear",!0),t(),v((w=a.purchaseForm.get("id_producto"))!=null&&w.invalid&&((w=a.purchaseForm.get("id_producto"))!=null&&w.touched)?33:-1),t(3),p(m(37,63,"labels.almacen")),t(2),d("formControlName","id_almacen")("options",a.almacenes),t(),v((x=a.purchaseForm.get("id_almacen"))!=null&&x.invalid&&((x=a.purchaseForm.get("id_almacen"))!=null&&x.touched)?39:-1),t(4),p(m(44,65,"labels.cantidad")),t(2),d("formControlName","cantidad"),t(),v((F=a.purchaseForm.get("cantidad"))!=null&&F.invalid&&((F=a.purchaseForm.get("cantidad"))!=null&&F.touched)?46:-1),t(3),p(m(50,67,"labels.precioCompra")),t(2),d("formControlName","precioUnitario"),t(),v((P=a.purchaseForm.get("precioUnitario"))!=null&&P.invalid&&((P=a.purchaseForm.get("precioUnitario"))!=null&&P.touched)?52:-1),t(3),p(m(56,69,"labels.precioVenta")),t(2),d("formControlName","precioVenta"),t(),v((y=a.purchaseForm.get("precioVenta"))!=null&&y.invalid&&((y=a.purchaseForm.get("precioVenta"))!=null&&y.touched)?58:-1),t(3),p(m(62,71,"labels.totalCompra")),t(2),G("value",a.totalCompra),t(),v((E=a.purchaseForm.get("totaCompra"))!=null&&E.invalid&&((E=a.purchaseForm.get("totaCompra"))!=null&&E.touched)?64:-1),t(3),p(m(68,73,"labels.options")),t(4),d("title",m(72,75,"label.add_detall")),t(2),d("title",m(74,77,"label.delet_detall")),t(2),d("value",a.detailView)("tableStyle",I(80,Ue))("styleClass","p-datatable-sm w-full")}},dependencies:[we,X,xe,ue,de,le,ie,Z,re,ee,te,ae,oe,be,Se,H,J,pe,ce,_e,ve,me,se,W,fe,he,De,Ne,ge,Ce,ye,Pe,Me,ke,Y,Be,je],encapsulation:2})};export{M as default};
