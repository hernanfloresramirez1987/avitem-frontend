import{a as Te}from"./chunk-BDOSKQZG.js";import{b as Ie,c as De,d as Ne,e as Ve,f as Me}from"./chunk-4LOX7WP3.js";import{a as xe,b as Ee}from"./chunk-2QHHTSCW.js";import{a as we}from"./chunk-MR6HFMJU.js";import{k as ge}from"./chunk-PGY6YP4V.js";import"./chunk-C7HYCF2I.js";import{a as Pe}from"./chunk-HZXJW4LT.js";import{a as ye}from"./chunk-DLZT7WZQ.js";import{b as Se}from"./chunk-E75TOESU.js";import{j as de,k as ue,l as fe,q as he,r as ve,s as Ce,t as be}from"./chunk-Z55D476B.js";import{a as _e,b as Fe}from"./chunk-B2DF4FH5.js";import{b as me}from"./chunk-MHDBCHB7.js";import{B as ne,C as le,d as J,e as z,g as K,h as Q,j as X,k as Z,l as ee,m as te,o as re,q as ie,r as oe,s as ae}from"./chunk-NE5GSNAT.js";import{X as H,da as q,oa as se,pa as ce,qa as pe}from"./chunk-6X2GXSHH.js";import{c as $,h as Y,i as W}from"./chunk-54PYN3B4.js";import{r as O,s as x}from"./chunk-JTR3XAHS.js";import"./chunk-F2X3VGZZ.js";import{$a as d,Ca as o,Gb as l,Ha as m,Hb as u,Na as L,Nb as G,Ob as N,P as j,Ta as h,V as A,Xb as c,Yb as p,a as M,aa as T,b as B,ba as I,cb as R,fb as v,kb as a,lb as r,mb as g,oa as D,qb as k,ub as C,vb as w,yb as U}from"./chunk-4PTIY3UM.js";var E=class n{#e=be.URL_API;http=A($);getAllAlmacenes=()=>this.http.get(`${this.#e}almacenes`);static \u0275fac=function(e){return new(e||n)};static \u0275prov=j({token:n,factory:n.\u0275fac,providedIn:"root"})};var Ae=()=>({width:"100%"}),Le=()=>["/inventory/products"];function Re(n,t){n&1&&(a(0,"small",8),l(1,"Error en el Fecha de Compra."),r())}function ke(n,t){n&1&&(a(0,"small",8),l(1,"Error en el Proveedor Seleccionado."),r())}function Ue(n,t){n&1&&(a(0,"small",8),l(1,"Error en el Producto seleccionado."),r())}function Ge(n,t){n&1&&(a(0,"small",8),l(1,"Error en el Fecha de Compra."),r())}function Oe(n,t){n&1&&(a(0,"small",8),l(1,"Error en el Precio de Compra."),r())}function $e(n,t){n&1&&(a(0,"small",8),l(1,"Error en el Precio de Venta."),r())}function Ye(n,t){n&1&&(a(0,"small",8),l(1,"Error en el Precio de Venta."),r())}function We(n,t){if(n&1){let e=k();a(0,"div",19),g(1,"p-button",20),a(2,"p-button",21),C("click",function(){T(e);let s=w();return I(s.cleanAll())}),r(),a(3,"p-button",22),C("click",function(){T(e);let s=w();return I(s.submitPurchase())}),r()()}if(n&2){let e=w();o(),d("routerLink",N(2,Le)),o(2),d("disabled",!e.purchaseForm.valid)}}var V=class n{constructor(t,e,i,s,_,F,S,b,P,y,He){this.confirmationServ=t;this.comprasServ=e;this.productosServ=i;this.translate=s;this.proveedoresServ=_;this.almacenesServ=F;this.translateLanService=S;this.fb=b;this.router=P;this.datePipe=y;this.toastServ=He;this.translateLanService.changeLanguage$.subscribe(f=>this.translate.use(f)),this.currentDate=this.datePipe.transform(new Date,"dd/MM/yyyy")||"",this.purchaseForm=this.fb.group({fechaCompra:[this.currentDate],id_proveedor:["",[z.required]],cantidad:[""],precioUnitario:[""],precioVenta:[""],id_producto:[""],id_almacen:[""]}),this.proveedoresServ.postProveedoresSearch(null).subscribe({next:f=>this.proveedores=f,error:f=>console.error("Error al obtener proveedores:",f)}),this.almacenesServ.getAllAlmacenes().subscribe({next:f=>this.almacenes=f,error:f=>console.log(f.message)})}purchaseForm;comprasRegister;proveedores;productos;almacenes;detailView=[];stateInputs=D(!0);currentDate;total=0;totalCompra=0;stateDialog=D(!1);addDetail(){if(!this.purchaseForm.value.id_producto){alert("Debe de seleccionar producto para agregarlo. Por favor seleccione uno.");return}let t=Number(this.purchaseForm.value.id_producto.id);if(this.detailView.some(i=>i.id_producto===t||this.purchaseForm.value.id_producto=="")){alert("Este producto ya ha sido agregado. Por favor selecciona otro.");return}this.detailView.push({cantidad:Number(this.purchaseForm.value.cantidad),precioUnitario:Number(this.purchaseForm.value.precioUnitario),precioVenta:Number(this.purchaseForm.value.precioVenta),id_producto:Number(this.purchaseForm.value.id_producto.id),id_almacen:Number(this.purchaseForm.value.id_almacen.id),name_product:this.purchaseForm.value.id_producto.nombre,color:this.purchaseForm.value.id_producto.color}),this.funcTotal(),this.cleanForms()}funcTotal(){this.total=this.detailView.reduce((t,e)=>{let i=Number(e.cantidad)||0,s=Number(e.precioUnitario)||0;return t+i*s},0)}cleanForms(){this.purchaseForm.patchValue({total:this.total,id_producto:"",cantidad:"",precioUnitario:"",precioVenta:""},{emitEvent:!1}),this.totalCompra=0}updateDetail(t){this.purchaseForm.patchValue({id_producto:"",cantidad:"",precioUnitario:""},{emitEvent:!0})}changeProvider(){this.productosServ.postProductscProveedor(this.purchaseForm.value.id_proveedor.id).subscribe(t=>{this.productos=t.map(e=>B(M({},e),{display:`${e.nombre} (${e.color})  , ${e.color} - ${e.unidadMedida}`})),this.stateInputs.set(!1)})}changeTotalCompra(){console.log("this.totalCompra: "),this.totalCompra=this.purchaseForm.value.cantidad*this.purchaseForm.value.precioUnitario}submitPurchase(){if(this.purchaseForm.valid){let t=this.asignarValores();console.log(t),t.detalle=JSON.stringify(t.detalle),this.confirm(t)}else console.error("Formulario inv\xE1lido")}asignarValores(){let t=this.purchaseForm.value;return console.log(String(this.datePipe.transform(this.getLastDateOfYear(new Date().getFullYear()),"yyyy-MM-dd"))),this.comprasRegister={fechaCompra:String(this.datePipe.transform(new Date,"yyyy-MM-dd")),total:this.total,id_proveedor:t.id_proveedor.id,detalle:this.detailView.map(e=>(console.log(e),{cantidad:e.cantidad,precioUnitario:e.precioUnitario,precioVenta:e.precioVenta,id_producto:e.id_producto,id_almacen:e.id_almacen})),fechaVencimiento:String(this.datePipe.transform(this.getLastDateOfYear(new Date().getFullYear()),"yyyy-MM-dd"))},console.log(`console.log(this.comprasRegister);
 `,this.comprasRegister),this.comprasRegister}getLastDateOfYear(t){return new Date(t,11,31)}notifySuccess(){this.toastServ.showSuccess("Operation Successful","The action was completed successfully.")}notifyError(){this.toastServ.showError("Operation Failed","An error occurred while processing the action.")}confirm(t){this.confirmationServ.confirm({message:"Are you sure you want to perform this action?",header:"Confirmation",icon:"pi pi-exclamation-triangle",accept:()=>{this.comprasServ.postSaveCompras(t).subscribe({next:e=>{console.log("Action confirmed!"),e.CodigoEstado==="201"?(this.notifySuccess(),setTimeout(()=>{console.log("Compra registrada correctamente"),this.router.navigate(["/transactions/compras"])},3e3)):console.log(e)},error:e=>{console.error("Error al registrar la compra:",e)}})},reject:()=>{console.log("Action rejected!")}})}getColorBackground(t){switch(t){case"Natural":return"#cccccc";case"Champan":return"#FBE7C6";case"Negro":return"#000000";case"Madera":return"#8B4513";default:return"#FFFFFF"}}getColor(t){switch(t){case"Natural":return"#000000";case"Champan":return"#000000";case"Negro":return"#FFFFFF";case"Madera":return"#FFFFFF";default:return"#FFFFFF"}}deleteDetail(t){this.detailView=this.detailView.filter(e=>e!==t),this.funcTotal(),this.cleanForms()}updateData(){console.log("updateData() { } ")}cleanAll(){}static \u0275fac=function(e){return new(e||n)(m(H),m(Te),m(we),m(se),m(ye),m(E),m(Ce),m(re),m(Y),m(x),m(Me))};static \u0275cmp=L({type:n,selectors:[["app-purchase-create"]],features:[G([x])],decls:62,vars:56,consts:[[3,"formGroup"],[3,"header"],[1,"flex","md:flex-row","sm:flex-row"],[1,"col-12","md:col-7","p-2","w-full"],[1,"flex","md:flex-row","flex-row","w-full","p-2"],[1,"flex","flex-wrap","justify-content-left","align-items-center","gap-2","p-2","lg:w-full","md:w-full","w-full"],[1,"w-25rem"],["dateFormat","dd/mm/yy","type","text","styleClass","w-full",1,"w-full",3,"formControlName"],[2,"color","red"],["pInputText","","type","text",1,"w-full",3,"value","disabled"],["optionLabel","empresa","styleClass","w-full","placeholder","Select un proveedor",1,"w-full","lg:w-full",3,"onChange","formControlName","options"],["optionLabel","display","placeholder","Seleccionar Producto","styleClass","w-full",1,"w-full","lg:w-full",3,"formControlName","options"],[1,"flex","md:flex-row","flex-row","w-full"],[1,"flex","flex-wrap","justify-content-left","align-items-center","pb-4","lg:w-full","md:w-full","w-full","p-2"],["pInputText","","type","number",1,"w-full",3,"change","formControlName"],[1,"flex","flex-wrap","justify-content-left","align-items-center","gap-2","pb-4","w-full","p-2"],["pInputText","","type","number",1,"w-full",3,"formControlName"],["pInputText","","type","number","disabled","",1,"w-full",3,"value"],["pTemplate","footer"],[1,"flex","gap-3","mt-1"],["label","Cancel","severity","danger","styleClass","w-full",1,"w-full",3,"routerLink"],["label","Limpiar","severity","secondary","styleClass","w-full",1,"w-full",3,"click"],["label","Save","styleClass","w-full",1,"w-full",3,"click","disabled"]],template:function(e,i){if(e&1&&(g(0,"p-toast")(1,"p-confirmDialog"),a(2,"form",0)(3,"p-card",1),c(4,"translate"),c(5,"uppercase"),a(6,"div",2)(7,"div",3)(8,"h6"),l(9),c(10,"translate"),c(11,"uppercase"),r(),a(12,"div",4)(13,"div",5)(14,"label",6),l(15),c(16,"translate"),r(),g(17,"p-datepicker",7),h(18,Re,2,0,"small",8),r(),a(19,"div",5)(20,"label",6),l(21),c(22,"translate"),r(),g(23,"input",9),r(),a(24,"div",5)(25,"label",6),l(26),c(27,"translate"),r(),a(28,"p-select",10),C("onChange",function(){return i.changeProvider()}),r(),h(29,ke,2,0,"small",8),r(),a(30,"div",5)(31,"label",6),l(32),c(33,"translate"),r(),g(34,"p-select",11),h(35,Ue,2,0,"small",8),r()(),a(36,"div",12)(37,"div",13)(38,"label",6),l(39),c(40,"translate"),r(),a(41,"input",14),C("change",function(){return i.changeTotalCompra()}),r(),h(42,Ge,2,0,"small",8),r(),a(43,"div",15)(44,"label",6),l(45),c(46,"translate"),r(),a(47,"input",14),C("change",function(){return i.changeTotalCompra()}),r(),h(48,Oe,2,0,"small",8),r(),a(49,"div",15)(50,"label",6),l(51),c(52,"translate"),r(),g(53,"input",16),h(54,$e,2,0,"small",8),r(),a(55,"div",15)(56,"label",6),l(57),c(58,"translate"),r(),g(59,"input",17),h(60,Ye,2,0,"small",8),r()()()(),h(61,We,4,3,"ng-template",18),r()()),e&2){let s,_,F,S,b,P,y;o(2),d("formGroup",i.purchaseForm),o(),d("header",p(5,33,p(4,31,"labels.register_purchases"))),o(6),u(p(11,37,p(10,35,"labels.detail_people"))),o(6),u(p(16,39,"purcharses.fechaCompra")),o(2),d("formControlName","fechaCompra"),o(),v((s=i.purchaseForm.get("fechaCompra"))!=null&&s.invalid&&((s=i.purchaseForm.get("fechaCompra"))!=null&&s.touched)?18:-1),o(3),u(p(22,41,"purcharses.precio_total")),o(2),d("value",i.total)("disabled",!0),o(3),u(p(27,43,"purcharses.proveedor")),o(2),R(N(55,Ae)),d("formControlName","id_proveedor")("options",i.proveedores),o(),v((_=i.purchaseForm.get("id_proveedor"))!=null&&_.invalid&&((_=i.purchaseForm.get("id_proveedor"))!=null&&_.touched)?29:-1),o(3),u(p(33,45,"purcharses.producto")),o(2),d("formControlName","id_producto")("options",i.productos),o(),v((F=i.purchaseForm.get("id_producto"))!=null&&F.invalid&&((F=i.purchaseForm.get("id_producto"))!=null&&F.touched)?35:-1),o(4),u(p(40,47,"purcharses.cantidad")),o(2),d("formControlName","cantidad"),o(),v((S=i.purchaseForm.get("cantidad"))!=null&&S.invalid&&((S=i.purchaseForm.get("cantidad"))!=null&&S.touched)?42:-1),o(3),u(p(46,49,"purcharses.precioCompra")),o(2),d("formControlName","precioUnitario"),o(),v((b=i.purchaseForm.get("precioUnitario"))!=null&&b.invalid&&((b=i.purchaseForm.get("precioUnitario"))!=null&&b.touched)?48:-1),o(3),u(p(52,51,"purcharses.precioVenta")),o(2),d("formControlName","precioVenta"),o(),v((P=i.purchaseForm.get("precioVenta"))!=null&&P.invalid&&((P=i.purchaseForm.get("precioVenta"))!=null&&P.touched)?54:-1),o(3),u(p(58,53,"purcharses.totalCompra")),o(2),U("value",i.totalCompra),o(),v((y=i.purchaseForm.get("totaCompra"))!=null&&y.invalid&&((y=i.purchaseForm.get("totaCompra"))!=null&&y.touched)?60:-1)}},dependencies:[Se,q,Pe,de,me,ie,X,J,Z,K,Q,ee,te,Fe,_e,pe,ce,ae,oe,ve,he,le,ne,O,fe,ue,Ie,ge,Ee,xe,Ve,Ne,W,De],encapsulation:2})};export{V as default};
