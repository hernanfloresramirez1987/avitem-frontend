import{b as Re,c as ke}from"./chunk-XOI3GRRB.js";import{b as Te,c as Pe,d as Ne}from"./chunk-QFHAOGBO.js";import{a as Ve,b as Ie}from"./chunk-KSC4ABF4.js";import"./chunk-FK6H3RFT.js";import{a as Fe}from"./chunk-V4EMO6LB.js";import{a as we,b as xe}from"./chunk-EOEYE5G3.js";import{a as ye}from"./chunk-6GNA35ER.js";import{a as Ee}from"./chunk-EXT6ODLE.js";import{a as be}from"./chunk-HBIR4P4V.js";import"./chunk-JTXMDS4E.js";import{b as he,i as Se}from"./chunk-NHAPQC3W.js";import"./chunk-KFFE56HM.js";import{b as Ce}from"./chunk-QLWCHRGM.js";import"./chunk-G255QGHI.js";import{b as J,c as Y,d as H,e as K}from"./chunk-6HYSLB2P.js";import{i as me,j as ue,m as fe,n as ve,s as _e,t as ge}from"./chunk-LC6JGRRQ.js";import"./chunk-2WKEWB2B.js";import{E as ce,F as de,g as Z,h as M,j as ee,k as te,m as ie,n as ae,o as ne,p as le,r as oe,t as re,u as se,v as pe}from"./chunk-3T4WVZA5.js";import"./chunk-F2X3VGZZ.js";import{j as W,k as z}from"./chunk-THLIJB7Y.js";import{Y as Q,ea as X}from"./chunk-AAQOC4TC.js";import{r as q,s as D}from"./chunk-F7YKD2CL.js";import{$ as C,Aa as a,Cb as T,Fa as _,Ma as G,Mb as r,Nb as m,Sa as h,Ub as O,Vb as P,_ as S,cb as d,cc as p,db as A,dc as c,fb as j,fc as U,ib as w,ma as k,n as $,nb as n,ob as t,pb as g,tb as B,yb as b,zb as x}from"./chunk-J6TCZN46.js";import{a as N,b as R}from"./chunk-C6Q5SG76.js";var Be=()=>({width:"100%"}),De=()=>({width:"100%"}),Me=()=>["/transactions/ventas"];function je(s,i){s&1&&(n(0,"small",10),r(1,"Error en el Fecha de Compra."),t())}function Ue(s,i){s&1&&(n(0,"small",10),r(1,"Error en el Cliente Seleccionado."),t())}function Le(s,i){s&1&&(n(0,"small",10),r(1,"Error en el Empleado seleccionado."),t())}function $e(s,i){s&1&&(n(0,"small",10),r(1,"Error en el Producto Seleccionado."),t())}function Ge(s,i){s&1&&(n(0,"small",10),r(1,"Error en el Fecha de Compra."),t())}function Ae(s,i){s&1&&(n(0,"small",10),r(1,"Error en el Precio de Compra."),t())}function Oe(s,i){s&1&&(n(0,"small",10),r(1,"Error en el Precio de Venta."),t())}function qe(s,i){s&1&&(n(0,"tr")(1,"th",25),r(2,"No"),t(),n(3,"th",26),r(4,"Producto"),t(),n(5,"th",27),r(6,"Cantidad"),t(),n(7,"th",27),r(8,"Precio Unitario"),t(),n(9,"th",27),r(10,"Precio Total"),t(),n(11,"th",28),r(12,"Option"),t()())}function We(s,i){if(s&1&&(n(0,"tr"),g(1,"td")(2,"td")(3,"td"),n(4,"th",29)(5,"label"),r(6),p(7,"translate"),t()(),n(8,"th",31),g(9,"input",12),t()()),s&2){let l=x(2);a(6),m(c(7,3,"labels.precio_total")),a(3),d("value",l.total)("disabled",!0)}}function ze(s,i){if(s&1){let l=B();n(0,"tr")(1,"td",29),r(2),t(),n(3,"td"),r(4),t(),n(5,"td",29),r(6),t(),n(7,"td",29),r(8),t(),n(9,"td",29),r(10),t(),n(11,"td",30)(12,"p-buttonGroup")(13,"p-button",22),p(14,"translate"),b("click",function(){let o=S(l).$implicit,v=x();return C(v.deleteDetail(o))}),t()()()(),h(15,We,10,5,"tr")}if(s&2){let l=i.$implicit,e=i.rowIndex,o=x();a(2),m(e+1),a(),A("background-color",o.getColorBackground(l.color))("color",o.getColor(l.color)),a(),m(l.name_product),a(2),m(l.cantidad),a(2),m(l.precioUnitario),a(2),m(l.cantidad*l.precioUnitario),a(3),d("title",c(14,11,"label.delet_detall")),a(2),w(e+1===o.detailView.length?15:-1)}}function Je(s,i){if(s&1){let l=B();n(0,"div",32),g(1,"p-button",33),n(2,"p-button",34),b("click",function(){S(l);let o=x();return C(o.cleanAll())}),t(),n(3,"p-button",35),b("click",function(){S(l);let o=x();return C(o.submitSales())}),t()()}if(s&2){let l=x();a(),d("routerLink",P(2,Me)),a(2),d("disabled",!l.salesForm.valid||l.detailView.length===0)}}var L=class s{constructor(i,l,e,o,v,y,F,E,V,I,Ye,He){this.translateLanService=i;this.translate=l;this.toastServ=e;this.confirmationServ=o;this.clientServ=v;this.employeesServ=y;this.ventasServ=F;this.productosServ=E;this.fb=V;this.router=I;this.datePipe=Ye;this.pdfreport=He;this.translateLanService.changeLanguage$.subscribe(u=>this.translate.use(u)),this.salesForm=this.fb.group({fechaVenta:[M.required],tokenSIN:[""],id_cliente:["",[M.required]],id_empleado:["",[M.required]],cantidad:[""],precioUnitario:[""],precioUnitarioVenta:[""],id_producto:[""]}),this.productosServ.postProductsGet().subscribe(u=>{console.log(u),this.productos=u.map(f=>R(N({},f),{displayProduct:`${f.nombre} (${f.color}) - ${f.unidadMedida}`})),this.stateInputs.set(!1)}),this.clientServ.getAllClients().subscribe({next:u=>{console.log(u),this.clientes=u.map(f=>R(N({},f),{displayCliente:`${f.nombre} ${f.app} ${f.apm}`}))},error:u=>console.log(u)}),this.employeesServ.postEmployees(null).pipe($(u=>({data:Array.isArray(u)?[...u]:[],page:0,rows:0,total_records:0,loaded:!0,loading:!1,error:null}))).subscribe(u=>{console.log(u),this.empleados=u.data.map(f=>R(N({},f),{displayEmpleado:`${f.nombre} ${f.app} ${f.apm}, ${f.idcargo}`})),this.stateInputs.set(!1)})}salesForm;items;ventasRegister;clientes;empleados;productos;producto=k({});cliente=k({});detailView=[];stateInputs=k(!0);total=0;totalVenta=0;asignarValores(){let i=this.salesForm.value,e=new Date(i.fechaVenta).toISOString().split("T")[0];return this.ventasRegister={fechaVenta:e,total:this.total,id_cliente:i.id_cliente.id,id_empleado:i.id_empleado.id,confactura:0,token_SIN:"tokenSIN",detalle:this.detailView.map(o=>(console.log(o),{cantidad:o.cantidad,precioUnitario:o.precioUnitario,id_producto:o.id_producto}))},console.log(`console.log(this.comprasRegister);
 `,this.ventasRegister),this.ventasRegister}getLastDateOfYear(i){return new Date(i,11,31)}notifySuccess(){this.toastServ.showSuccess("Operation Successful","The action was completed successfully.")}notifyError(){this.toastServ.showError("Operation Failed","An error occurred while processing the action.")}getColorBackground(i){switch(i){case"Natural":return"#cccccc";case"Champan":return"#FBE7C6";case"Negro":return"#000000";case"Madera":return"#8B4513";default:return"#FFFFFF"}}getColor(i){switch(i){case"Natural":return"#000000";case"Champan":return"#000000";case"Negro":return"#FFFFFF";case"Madera":return"#FFFFFF";default:return"#FFFFFF"}}deleteDetail(i){this.detailView=this.detailView.filter(l=>l!==i),this.funcTotal(),this.cleanForms()}changeTotalVenta(){let i=this.salesForm.value.cantidad*this.salesForm.value.precioUnitario;console.log("totalVenta ",i),this.totalVenta=i}addDetail(){if(!this.salesForm.value.id_producto){alert("Debe de seleccionar producto para agregarlo. Por favor seleccione uno.");return}let i=Number(this.salesForm.value.id_producto.id);if(this.detailView.some(e=>e.id_producto===i||this.salesForm.value.id_producto=="")){alert("Este producto ya ha sido agregado. Por favor selecciona otro.");return}if(this.salesForm.value.cantidad>this.producto().cantidadStock){alert("Error, la cantidad solicitada de "+this.salesForm.value.cantidad+" items excede al stock de "+this.producto().cantidadStock+" en Almacenes");return}this.detailView.push({name_product:this.salesForm.value.id_producto.nombre,color:this.salesForm.value.id_producto.color,cantidad:Number(this.salesForm.value.cantidad),precioUnitario:Number(this.salesForm.value.precioUnitario),id_producto:Number(this.salesForm.value.id_producto.id)}),console.log(this.detailView),this.funcTotal(),this.cleanForms()}updateData(){console.log("updateData() { } ")}funcTotal(){this.total=this.detailView.reduce((i,l)=>{let e=Number(l.cantidad)||0,o=Number(l.precioUnitario)||0;return i+e*o},0)}cleanForms(){this.salesForm.patchValue({total:this.total,id_producto:"",cantidad:"",precioUnitario:"",precioVenta:""},{emitEvent:!1}),this.totalVenta=0}cleanAll(){console.log("cleanAll() { ... }")}async submitSales(){if(this.salesForm.valid){let i=await this.asignarValores();console.log(i),i.detalle=JSON.stringify(i.detalle),await this.confirmSave(i)}else console.error("Formulario inv\xE1lido")}confirmDialogSave(i,l){return new Promise(e=>{this.confirmationServ.confirm({message:i,header:l,icon:"pi pi-exclamation-triangle",accept:()=>e(!0),reject:()=>e(!1)})})}async confirmDialogFactura(i,l){return await new Promise(e=>{this.confirmationServ.confirm({message:i,header:l,icon:"pi pi-exclamation-triangle",accept:()=>e(!0),reject:()=>e(!1)})})}saveRegisterSale=async(i,l)=>{this.ventasRegister.confactura=l?1:0,console.log(this.ventasRegister,i),this.ventasRegister.token_SIN=l?"con token":"",this.ventasRegister.total=this.ventasRegister.total*.13,console.log("Total: ",this.ventasRegister.total),await this.ventasServ.postSaveVenta(i).subscribe({next:e=>{console.log(e),e.CodigoEstado=="200"},error:e=>console.log(e)})};async confirmSave(i){this.ventasRegister=i;let l=await this.confirmDialogSave("\xBFEst\xE1s seguro de registrar esta venta?","Confirmaci\xF3n");console.log(l);let e=null;if(l){let o=this.ventasRegister.total*.13;console.log(o),e=await this.confirmDialogFactura("\xBFSe est\xE1 procesando la venta, el precio sin factura es: "+this.ventasRegister.total+"Bs con factura es "+(this.ventasRegister.total+o)+"Bs,  desea factura?","Confirmaci\xF3n Factura"),console.log(e),await this.saveRegisterSale(this.ventasRegister,e)}else console.log("Primera confirmaci\xF3n cancelada.")}changeClient({value:i}){console.log(i);let l=i;this.cliente.set(l)}changeProduct({value:i}){console.log(i),this.producto.set(i)}static \u0275fac=function(l){return new(l||s)(_(K),_(J),_(Fe),_(Q),_(ye),_(be),_(Re),_(Ee),_(oe),_(W),_(D),_(ke))};static \u0275cmp=G({type:s,selectors:[["app-sale-create"]],features:[O([D])],decls:91,vars:89,consts:[["header",""],["body",""],[3,"formGroup"],[3,"header","subheader"],[1,"flex","md:flex-row","sm:flex-row"],[1,"col-12","md:col-7","w-full"],[1,"flex","md:flex-row","flex-row","w-full"],[1,"flex","flex-wrap","justify-content-left","align-items-center","gap-2","p-2","lg:w-full","md:w-full","w-full"],[1,"w-25rem"],["dateFormat","dd/mm/yy","type","text","styleClass","w-full",1,"w-full",3,"formControlName","placeholder"],[2,"color","red"],["optionLabel","displayCliente","styleClass","w-full","placeholder","Seleccionar Cliente",1,"w-full","lg:w-full",3,"onChange","formControlName","options"],["pInputText","","type","text",1,"w-full",3,"value","disabled"],["optionLabel","displayEmpleado","placeholder","Seleccionar Empleado","styleClass","w-full",1,"w-full","lg:w-full",3,"formControlName","options"],[1,"flex","flex-column","md:flex-row","flex-row"],["optionLabel","displayProduct","styleClass","w-full","placeholder","Seleccionar producto",1,"w-full","lg:w-full",3,"onChange","formControlName","options"],["pInputText","","type","number",1,"w-full",3,"change","formControlName"],["pInputText","","type","number","disabled","",1,"w-full",3,"value"],[1,"justify-content-center","align-items-center","p-2"],[1,""],[1,"flex","justify-content-between","pt-2"],["icon","pi pi-plus","severity","primary",3,"click","title"],["icon","pi pi-trash","severity","danger",3,"click","title"],[3,"value","tableStyle","styleClass"],["pTemplate","footer"],[2,"width","6%","text-align","right"],[2,"width","40%"],[2,"width","12%","text-align","right"],[2,"width","6%"],[2,"text-align","right"],[1,"flex","flex-wrap","justify-content-left"],[1,"text-right",2,"text-align","right"],[1,"flex","gap-3","mt-1"],["label","Cancel","severity","danger","styleClass","w-full",1,"w-full",3,"routerLink"],["label","Limpiar","severity","secondary","styleClass","w-full",1,"w-full",3,"click"],["label","Save","styleClass","w-full",1,"w-full",3,"click","disabled"]],template:function(l,e){if(l&1){let o=B();g(0,"p-toast")(1,"p-confirmDialog"),n(2,"form",2)(3,"p-card",3),p(4,"translate"),p(5,"uppercase"),p(6,"translate"),p(7,"capitalize"),n(8,"div",4)(9,"div",5)(10,"div",6)(11,"div",7)(12,"label",8),r(13),p(14,"translate"),t(),g(15,"p-datepicker",9),h(16,je,2,0,"small",10),t(),n(17,"div",7)(18,"label",8),r(19),p(20,"translate"),t(),n(21,"p-select",11),b("onChange",function(y){return S(o),C(e.changeClient(y))}),t(),h(22,Ue,2,0,"small",10),t(),n(23,"div",7)(24,"label",8),r(25),p(26,"translate"),t(),g(27,"input",12),t(),n(28,"div",7)(29,"label",8),r(30),p(31,"translate"),t(),g(32,"p-select",13),h(33,Le,2,0,"small",10),t()(),n(34,"div",14)(35,"div",7)(36,"label",8),r(37),p(38,"translate"),t(),n(39,"p-select",15),b("onChange",function(y){return S(o),C(e.changeProduct(y))}),t(),h(40,$e,2,0,"small",10),t(),n(41,"div",7)(42,"label",8),r(43),p(44,"translate"),t(),g(45,"input",12),t(),n(46,"div",7)(47,"label",8),r(48),p(49,"translate"),t(),g(50,"input",12),t(),n(51,"div",7)(52,"label",8),r(53),p(54,"translate"),t(),g(55,"input",12),t()(),n(56,"div",14)(57,"div",7)(58,"label",8),r(59),p(60,"translate"),t(),n(61,"input",16),b("change",function(){return S(o),C(e.changeTotalVenta())}),t(),h(62,Ge,2,0,"small",10),t(),n(63,"div",7)(64,"label",8),r(65),p(66,"translate"),t(),n(67,"input",16),b("change",function(){return S(o),C(e.changeTotalVenta())}),t(),h(68,Ae,2,0,"small",10),t(),n(69,"div",7)(70,"label",8),r(71),p(72,"translate"),t(),g(73,"input",17),h(74,Oe,2,0,"small",10),t(),n(75,"div",18)(76,"label",19),r(77),p(78,"translate"),t(),n(79,"div",20)(80,"p-buttonGroup")(81,"p-button",21),p(82,"translate"),b("click",function(){return S(o),C(e.addDetail())}),t(),n(83,"p-button",22),p(84,"translate"),b("click",function(){return S(o),C(e.updateData())}),t()()()()(),n(85,"p-table",23),h(86,qe,13,0,"ng-template",null,0,U)(88,ze,16,13,"ng-template",null,1,U),t()()(),h(90,Je,4,3,"ng-template",24),t()()}if(l&2){let o,v,y,F,E,V,I;a(2),d("formGroup",e.salesForm),a(),d("header",c(5,52,c(4,50,"pages.register_sales")))("subheader",c(7,56,c(6,54,"labels.form_sales"))),a(10),m(c(14,58,"labels.fechaVenta")),a(2),d("formControlName","fechaVenta")("placeholder","Seleecionar fecha"),a(),w((o=e.salesForm.get("fechaVenta"))!=null&&o.invalid&&((o=e.salesForm.get("fechaVenta"))!=null&&o.touched)?16:-1),a(3),m(c(20,60,"labels.id_cliente")),a(2),j(P(86,Be)),d("formControlName","id_cliente")("options",e.clientes),a(),w((v=e.salesForm.get("id_cliente"))!=null&&v.invalid&&((v=e.salesForm.get("id_cliente"))!=null&&v.touched)?22:-1),a(3),m(c(26,62,"labels.ci")),a(2),d("value",e.cliente().ci!==void 0?e.cliente().ci:"")("disabled",!0),a(3),m(c(31,64,"labels.id_empleado")),a(2),d("formControlName","id_empleado")("options",e.empleados),a(),w((y=e.salesForm.get("id_empleado"))!=null&&y.invalid&&((y=e.salesForm.get("id_empleado"))!=null&&y.touched)?33:-1),a(4),m(c(38,66,"labels.id_producto")),a(2),j(P(87,Be)),d("formControlName","id_producto")("options",e.productos),a(),w((F=e.salesForm.get("id_producto"))!=null&&F.invalid&&((F=e.salesForm.get("id_producto"))!=null&&F.touched)?40:-1),a(3),m(c(44,68,"labels.description")),a(2),T("value",e.producto().descripcion),d("disabled",!0),a(3),m(c(49,70,"labels.proveedor")),a(2),T("value",e.producto().empresa),d("disabled",!0),a(3),m(c(54,72,"labels.cantidadStock")),a(2),T("value",e.producto().cantidadStock),d("disabled",!0),a(4),m(c(60,74,"labels.cantidad")),a(2),d("formControlName","cantidad"),a(),w((E=e.salesForm.get("cantidad"))!=null&&E.invalid&&((E=e.salesForm.get("cantidad"))!=null&&E.touched)?62:-1),a(3),m(c(66,76,"labels.precioVenta")),a(2),d("formControlName","precioUnitario"),a(),w((V=e.salesForm.get("precioUnitario"))!=null&&V.invalid&&((V=e.salesForm.get("precioUnitario"))!=null&&V.touched)?68:-1),a(3),m(c(72,78,"labels.totalVenta")),a(2),T("value",e.totalVenta),a(),w((I=e.salesForm.get("totaCompra"))!=null&&I.invalid&&((I=e.salesForm.get("totaCompra"))!=null&&I.touched)?74:-1),a(3),m(c(78,80,"labels.options")),a(4),d("title",c(82,82,"label.add_detall")),a(2),d("title",c(84,84,"label.delet_detall")),a(2),d("value",e.detailView)("tableStyle",P(88,De))("styleClass","p-datatable-sm")}},dependencies:[re,ie,Z,ae,ee,te,ne,le,ue,me,X,H,Y,pe,se,ge,_e,Ce,de,ce,q,ve,fe,Ie,Ve,Se,he,xe,we,Pe,Te,z,Ne],encapsulation:2})};export{L as default};
