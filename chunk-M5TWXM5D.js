import{a as he}from"./chunk-QBJIG32J.js";import{b as ue}from"./chunk-EX3DZH3G.js";import{a as ce,b as me}from"./chunk-VMCLT6QI.js";import{a as fe}from"./chunk-C47IWZ44.js";import{a as ne,b as le,c as se}from"./chunk-HBPRF3ON.js";import{I as ie,J as re,W as oe,X as ae,b as A,c as $,d as q,da as pe,e as J,ea as de,g as O,h as g,j as H,k as z,m as K,n as Q,o as W,p as X,q as Y,r as Z,s as ee,u as te}from"./chunk-UF65HLQ7.js";import"./chunk-NMGI7OHJ.js";import{a as L,i as R}from"./chunk-NM3HJ4DI.js";import{s as G,t as w}from"./chunk-JAFPLUWG.js";import{Cb as y,Db as F,Mb as p,Nb as h,Sa as i,Ta as u,Tb as k,Ub as U,V as S,Wb as V,_ as E,dc as d,ea as P,ec as s,hb as _,jb as m,mb as N,oa as I,ob as C,pa as T,pb as j,rb as B,sb as D,tb as n,ub as r,vb as f,zb as M}from"./chunk-PQPLRZS3.js";var ve=(()=>{class a{#e;constructor(e){this.http=e,this.#e=se.URL_API,this.postProduct=t=>this.http.post(`${this.#e}compras/register`,t)}static{this.\u0275fac=function(t){return new(t||a)(E(L))}}static{this.\u0275prov=S({token:a,factory:a.\u0275fac,providedIn:"root"})}}return a})();var ye=()=>({width:"100%"});function we(a,v){a&1&&(n(0,"small",8),p(1,"Error en el Fecha de Compra."),r())}function Fe(a,v){a&1&&(n(0,"small",8),p(1,"Error en el Precio Total."),r())}function Se(a,v){a&1&&(n(0,"small",8),p(1,"Error en el Proveedor Seleccionado."),r())}function Ee(a,v){a&1&&(n(0,"small",8),p(1,"Error en el Fecha de Compra."),r())}function Pe(a,v){a&1&&(n(0,"small",8),p(1,"Error en el Precio Total."),r())}function Ie(a,v){a&1&&(n(0,"small",8),p(1,"Error en el Producto seleccionado."),r())}function Te(a,v){if(a&1){let e=M();n(0,"div",4)(1,"div",21)(2,"div",4)(3,"div",22)(4,"label",23),p(5),d(6,"translate"),r(),f(7,"input",24),_(8,Ee,2,0,"small",8),r(),n(9,"div",22)(10,"label",25),p(11),d(12,"translate"),r(),f(13,"input",24),_(14,Pe,2,0,"small",8),r(),n(15,"div",26)(16,"label",27),p(17),d(18,"translate"),r(),f(19,"p-dropdown",28),_(20,Ie,2,0,"small",8),r(),n(21,"div",29)(22,"label",15),p(23),d(24,"translate"),r(),f(25,"br"),n(26,"p-button",30),d(27,"translate"),y("click",function(){let o=I(e).$index,l=F();return T(l.removeDetail(o))}),r()()()()()}if(a&2){let e,t,o,l=v.$index,c=F();i(),m("formGroupName",l),i(4),h(s(6,16,"purcharses.cantidad")),i(2),m("id","cantidad-"+l)("formControlName","cantidad"),i(),C(8,(e=c.purchaseForm.get("cantidad"))!=null&&e.invalid&&((e=c.purchaseForm.get("cantidad"))!=null&&e.touched)?8:-1),i(3),h(s(12,18,"purcharses.precioUnitario")),i(2),m("id","precioUnitario-"+l)("formControlName","precioUnitario"),i(),C(14,(t=c.purchaseForm.get("precioUnitario"))!=null&&t.invalid&&((t=c.purchaseForm.get("precioUnitario"))!=null&&t.touched)?14:-1),i(3),h(s(18,20,"purcharses.id_producto")),i(2),m("id","id_producto-"+l)("options",c.productos)("formControlName","id_producto"),i(),C(20,(o=c.purchaseForm.get("id_producto"))!=null&&o.invalid&&((o=c.purchaseForm.get("id_producto"))!=null&&o.touched)?20:-1),i(3),h(s(24,22,"purcharses.add")),i(3),m("title",s(27,24,"label.add_detall"))}}var et=(()=>{class a{constructor(e,t,o,l,c,b,_e,Ce){this.comprasServ=e,this.productosServ=t,this.translate=o,this.proveedoresServ=l,this.translateLanService=c,this.fb=b,this.router=_e,this.datePipe=Ce,this.translateLanService.changeLanguage$.subscribe(x=>this.translate.use(x));let ge=this.datePipe.transform(new Date,"dd/MM/yyyy");this.purchaseForm=this.fb.group({fechaCompra:[ge,{disabled:!0}],total:[0,{disabled:!0}],id_proveedor:["",[g.required]],detalle:this.fb.array([])}),this.proveedoresServ.postProveedoresSearch(null).subscribe({next:x=>{console.log(x),this.proveedores=x,console.log(this.proveedores)},error:x=>console.error("Error al obtener proveedores:",x)})}ngOnInit(){console.log(9999),this.purchaseForm.valueChanges.subscribe(e=>this.calculateTotal(e))}calculateTotal(e){let t=0;for(let o=0;o<e.detalle.length;o++)t+=e.detalle[o].cantidad*e.detalle[o].precioUnitario;console.log(t),this.purchaseForm.patchValue({total:t},{emitEvent:!1})}get detalle(){return this.purchaseForm.get("detalle")}addDetail(){let e=this.fb.group({cantidad:["",[g.required,g.min(1)]],precioUnitario:["",[g.required,g.min(.01)]],id_producto:[null,g.required]});this.detalle.push(e)}removeDetail(e){this.detalle.removeAt(e)}changeProvider(){this.productosServ.postProductscProveedor(this.purchaseForm.value.id_proveedor.id).subscribe(e=>{this.productos=e})}submitPurchase(){if(this.purchaseForm.valid){let e=this.asignarValores();e.detalle=JSON.stringify(e.detalle),this.comprasServ.postProduct(e).subscribe({next:t=>{t.CodigoEstado==="201"&&this.router.navigate(["/transactions/compras"])},error:t=>{console.error("Error al registrar la compra:",t)}})}else console.error("Formulario inv\xE1lido")}asignarValores(){let e=this.purchaseForm.value;return this.comprasRegister={fechaCompra:e.fechaCompra,total:e.total,id_proveedor:e.id_proveedor.id,detalle:e.detalle.map(t=>({cantidad:t.cantidad,precioUnitario:t.precioUnitario,id_producto:t.id_producto.id}))},console.log(`console.log(this.comprasRegister);
 `,this.comprasRegister),this.comprasRegister}static{this.\u0275fac=function(t){return new(t||a)(u(ve),u(he),u(A),u(fe),u(J),u(ee),u(R),u(w))}}static{this.\u0275cmp=P({type:a,selectors:[["app-purchase-create"]],standalone:!0,features:[k([w]),U],decls:42,vars:39,consts:[[3,"formGroup"],[3,"header"],[1,"flex","flex-column","md:flex-row","sm:flex-row"],[1,"align-items-left","justify-content-top","pr-2"],[1,"flex","flex-column","md:flex-row","flex-row"],[1,"flex","flex-wrap","justify-content-left","align-items-center","gap-2","pb-4","px-2","lg:w-full"],["for","fechaCompra",1,"w-25rem"],["type","text","styleClass","w-full",1,"w-full",3,"formControlName"],[2,"color","red"],["for","total",1,"w-25rem"],["pInputText","","type","text",1,"w-full",3,"formControlName","disabled"],[1,"flex","flex-wrap","justify-content-left","align-items-center","gap-2","pb-4","lg:w-full","px-2"],["for","id_proveedor",1,"w-25rem"],["optionLabel","empresa","styleClass","w-full","placeholder","Select un proveedor",1,"w-full","lg:w-full",3,"onChange","formControlName","options"],[1,"justify-content-center","py-2","align-items-center","pb-4"],[1,"py-4"],["icon","pi pi-plus",1,"p-button-secondary",3,"click","title"],["formArrayName","detalle"],[1,"button-group"],[1,"btn","btn-secondary",3,"click","label"],[1,"btn","btn-primary",3,"label","disabled"],[1,"detalle-item",3,"formGroupName"],[1,"flex","flex-wrap","justify-content-left","align-items-center","gap-2","px-2","lg:w-full"],["for","cantidad",1,"w-25rem"],["pInputText","","type","number",1,"w-full",3,"id","formControlName"],["for","precio unitario",1,"w-25rem"],[1,"flex","flex-wrap","justify-content-left","align-items-center","gap-2","lg:w-full","px-2"],["for","id_producto",1,"w-25rem"],["optionLabel","nombre","styleClass","w-full",1,"w-full","lg:w-full",3,"id","options","formControlName"],[1,"justify-content-center","py-2","align-items-center"],["icon","pi pi-trash","severity","danger",3,"click","title"]],template:function(t,o){if(t&1&&(n(0,"form",0)(1,"p-card",1),d(2,"translate"),d(3,"uppercase"),n(4,"div",2)(5,"div",3)(6,"div",4)(7,"div",5)(8,"label",6),p(9),d(10,"translate"),r(),f(11,"p-calendar",7),_(12,we,2,0,"small",8),r(),n(13,"div",5)(14,"label",9),p(15),d(16,"translate"),r(),f(17,"input",10),_(18,Fe,2,0,"small",8),r(),n(19,"div",11)(20,"label",12),p(21),d(22,"translate"),r(),n(23,"p-dropdown",13),y("onChange",function(){return o.changeProvider()}),r(),_(24,Se,2,0,"small",8),r(),n(25,"div",14)(26,"label",15),p(27),d(28,"translate"),r(),n(29,"p-button",16),d(30,"translate"),y("click",function(){return o.addDetail()}),r()()(),f(31,"hr"),n(32,"div",17)(33,"h4"),p(34,"Detalles"),r(),B(35,Te,28,26,"div",4,j),r(),n(37,"div",18)(38,"p-button",19),d(39,"translate"),y("click",function(){return o.submitPurchase()}),r(),f(40,"p-button",20),d(41,"translate"),r()()()()()),t&2){let l,c,b;m("formGroup",o.purchaseForm),i(),m("header",s(3,22,s(2,20,"labels.register_purchases"))),i(8),h(s(10,24,"purcharses.fechaCompra")),i(2),m("formControlName","fechaCompra"),i(),C(12,(l=o.purchaseForm.get("fechaCompra"))!=null&&l.invalid&&((l=o.purchaseForm.get("fechaCompra"))!=null&&l.touched)?12:-1),i(3),h(s(16,26,"purcharses.total")),i(2),m("formControlName","total")("disabled",!0),i(),C(18,(c=o.purchaseForm.get("total"))!=null&&c.invalid&&((c=o.purchaseForm.get("total"))!=null&&c.touched)?18:-1),i(3),h(s(22,28,"purcharses.id_proveedor")),i(2),N(V(38,ye)),m("formControlName","id_proveedor")("options",o.proveedores),i(),C(24,(b=o.purchaseForm.get("id_proveedor"))!=null&&b.invalid&&((b=o.purchaseForm.get("id_proveedor"))!=null&&b.touched)?24:-1),i(3),h(s(28,30,"purcharses.add")),i(2),m("title",s(30,32,"label.add_detall")),i(6),D(o.detalle.controls),i(3),m("label",s(39,34,"label.cancel")),i(2),m("label",s(41,36,"label.register"))("disabled",o.purchaseForm.invalid)}},dependencies:[te,K,O,Q,H,z,W,Z,X,Y,me,ce,q,$,re,ie,de,pe,ue,ae,oe,G,le,ne]})}}return a})();export{et as default};
