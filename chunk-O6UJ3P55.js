import{a as xe,b as we,c as be,d as Ee,e as Pe}from"./chunk-EDGN7K4P.js";import{a as ge}from"./chunk-RCBMPQRO.js";import{a as ye}from"./chunk-BSXPUJ5R.js";import{a as Se,b as Fe}from"./chunk-CLMRD5X6.js";import{b as ue,j as he}from"./chunk-JWFEPUA7.js";import{b as _e}from"./chunk-6SGHIW2A.js";import{a as fe,b as ve}from"./chunk-T74IQNWH.js";import{a as Ce}from"./chunk-MQIWMJU3.js";import{a as se,b as ce}from"./chunk-XCL4HO4J.js";import{G as ae,J as oe,K as ne,X as le,Y as pe,b as R,c as Y,d as J,e as q,ea as de,fa as me,g as z,h as H,j as K,k as Q,m as W,n as X,o as Z,p as ee,q as te,s as ie,x as re}from"./chunk-ZQA32VOG.js";import"./chunk-4YRY4IP2.js";import{i as A}from"./chunk-NM3HJ4DI.js";import{s as O,t as P}from"./chunk-JAFPLUWG.js";import{Cb as C,Db as E,Gb as G,Mb as n,Nb as c,Sa as r,Ta as h,Tb as L,Ub as $,Wb as I,a as D,b as N,bb as B,dc as d,ea as M,ec as m,hb as v,jb as s,kb as j,mb as k,oa as T,ob as _,pa as V,tb as t,ub as e,vb as g,zb as U}from"./chunk-PQPLRZS3.js";var Te=()=>({width:"100%"}),Ve=()=>({width:"100%"});function Ie(l,u){l&1&&(t(0,"small",8),n(1,"Error en el Fecha de Compra."),e())}function De(l,u){l&1&&(t(0,"small",8),n(1,"Error en el Precio Total."),e())}function Ne(l,u){l&1&&(t(0,"small",8),n(1,"Error en el Proveedor Seleccionado."),e())}function Me(l,u){l&1&&(t(0,"small",8),n(1,"Error en el Producto seleccionado."),e())}function Be(l,u){l&1&&(t(0,"small",8),n(1,"Error en el Fecha de Compra."),e())}function je(l,u){l&1&&(t(0,"small",8),n(1,"Error en el Precio de Compra."),e())}function ke(l,u){l&1&&(t(0,"small",8),n(1,"Error en el Precio de Venta."),e())}function Ue(l,u){l&1&&(t(0,"small",8),n(1,"Error en el Precio de Venta."),e())}function Ge(l,u){l&1&&(t(0,"tr")(1,"th",29),n(2,"No"),e(),t(3,"th",30),n(4,"Producto"),e(),t(5,"th",31),n(6,"Cantidad"),e(),t(7,"th",31),n(8,"Precio Unitario"),e(),t(9,"th",31),n(10,"Precio Venta"),e(),t(11,"th",31),n(12,"Precio Total"),e(),t(13,"th",32),n(14,"Option"),e()())}function Le(l,u){if(l&1){let a=U();t(0,"tr")(1,"td",33),n(2),e(),t(3,"td"),n(4),e(),t(5,"td",33),n(6),e(),t(7,"td",33),n(8),e(),t(9,"td",33),n(10),e(),t(11,"td",33),n(12),e(),t(13,"td",34)(14,"p-buttonGroup")(15,"p-button",35),d(16,"translate"),C("click",function(){let i=T(a).$implicit,p=E();return V(p.updateDetail(i))}),e(),t(17,"p-button",22),d(18,"translate"),C("click",function(){let i=T(a).$implicit,p=E();return V(p.deleteDetail(i))}),e()()()()}if(l&2){let a=u.$implicit,o=u.rowIndex,i=E();r(2),c(o+1),r(),j("background-color",i.getColorBackground(a.color))("color",i.getColor(a.color)),r(),c(a.name_product),r(2),c(a.cantidad),r(2),c(a.precioUnitario),r(2),c(a.precioVenta),r(2),c(a.cantidad*a.precioUnitario),r(3),s("title",m(16,12,"label.edit_detall")),r(2),s("title",m(18,14,"label.delet_detall"))}}var yt=(()=>{class l{constructor(a,o,i,p,S,F,y,x,w,b){this.confirmationServ=a,this.comprasServ=o,this.productosServ=i,this.translate=p,this.proveedoresServ=S,this.translateLanService=F,this.fb=y,this.router=x,this.datePipe=w,this.toastServ=b,this.detailView=[],this.stateInputs=B(!0),this.currentDate=this.datePipe.transform(new Date,"dd/MM/yyyy"),this.total=0,this.totalCompra=0,this.translateLanService.changeLanguage$.subscribe(f=>this.translate.use(f)),this.purchaseForm=this.fb.group({fechaCompra:[this.currentDate],total:[this.total],id_proveedor:["",[H.required]],cantidad:[""],precioUnitario:[""],precioVenta:[""],id_producto:[""]}),this.proveedoresServ.postProveedoresSearch(null).subscribe({next:f=>this.proveedores=f,error:f=>console.error("Error al obtener proveedores:",f)})}addDetail(){if(!this.purchaseForm.value.id_producto){alert("Debe de seleccionar producto para agregarlo. Por favor seleccione uno.");return}let a=Number(this.purchaseForm.value.id_producto.id);if(this.detailView.some(i=>i.id_producto===a||this.purchaseForm.value.id_producto=="")){alert("Este producto ya ha sido agregado. Por favor selecciona otro.");return}this.detailView.push({cantidad:Number(this.purchaseForm.value.cantidad),precioUnitario:Number(this.purchaseForm.value.precioUnitario),precioVenta:Number(this.purchaseForm.value.precioVenta),id_producto:Number(this.purchaseForm.value.id_producto.id),name_product:this.purchaseForm.value.id_producto.nombre,color:this.purchaseForm.value.id_producto.color}),this.funcTotal(),this.cleanForms()}funcTotal(){this.total=this.detailView.reduce((a,o)=>{let i=Number(o.cantidad)||0,p=Number(o.precioUnitario)||0;return a+i*p},0)}cleanForms(){this.purchaseForm.patchValue({total:this.total,id_producto:"",cantidad:"",precioUnitario:"",precioVenta:""},{emitEvent:!1}),this.totalCompra=0}updateDetail(a){this.purchaseForm.patchValue({id_producto:"",cantidad:"",precioUnitario:""},{emitEvent:!0})}changeProvider(){this.productosServ.postProductscProveedor(this.purchaseForm.value.id_proveedor.id).subscribe(a=>{this.productos=a.map(o=>N(D({},o),{display:`${o.nombre} (${o.color})  , ${o.color} - ${o.unidadMedida}`})),this.stateInputs.set(!1)})}changeTotalCompra(){console.log("this.totalCompra: "),this.totalCompra=this.purchaseForm.value.cantidad*this.purchaseForm.value.precioUnitario}submitPurchase(){if(this.purchaseForm.valid){let a=this.asignarValores();console.log(a),a.detalle=JSON.stringify(a.detalle),this.confirm(a)}else console.error("Formulario inv\xE1lido")}asignarValores(){let a=this.purchaseForm.value;return console.log(String(this.datePipe.transform(this.getLastDateOfYear(new Date().getFullYear()),"yyyy-MM-dd"))),this.comprasRegister={fechaCompra:String(this.datePipe.transform(new Date,"yyyy-MM-dd")),total:this.total,id_proveedor:a.id_proveedor.id,detalle:this.detailView.map(o=>(console.log(o),{cantidad:o.cantidad,precioUnitario:o.precioUnitario,precioVenta:o.precioVenta,id_producto:o.id_producto})),fechaVencimiento:String(this.datePipe.transform(this.getLastDateOfYear(new Date().getFullYear()),"yyyy-MM-dd"))},console.log(`console.log(this.comprasRegister);
 `,this.comprasRegister),this.comprasRegister}getLastDateOfYear(a){return new Date(a,11,31)}notifySuccess(){this.toastServ.showSuccess("Operation Successful","The action was completed successfully.")}notifyError(){this.toastServ.showError("Operation Failed","An error occurred while processing the action.")}confirm(a){this.confirmationServ.confirm({message:"Are you sure you want to perform this action?",header:"Confirmation",icon:"pi pi-exclamation-triangle",accept:()=>{this.comprasServ.postCompras(a).subscribe({next:o=>{console.log("Action confirmed!"),o.CodigoEstado==="201"?(this.notifySuccess(),setTimeout(()=>{console.log("Compra registrada correctamente"),this.router.navigate(["/transactions/compras"])},3e3)):console.log(o)},error:o=>{console.error("Error al registrar la compra:",o)}})},reject:()=>{console.log("Action rejected!")}})}getColorBackground(a){switch(a){case"Natural":return"#cccccc";case"Champan":return"#FBE7C6";case"Negro":return"#000000";case"Madera":return"#8B4513";default:return"#FFFFFF"}}getColor(a){switch(a){case"Natural":return"#000000";case"Champan":return"#000000";case"Negro":return"#FFFFFF";case"Madera":return"#FFFFFF";default:return"#FFFFFF"}}deleteDetail(a){this.detailView=this.detailView.filter(o=>o!==a),this.funcTotal(),this.cleanForms()}updateData(){console.log("updateData() { } ")}static{this.\u0275fac=function(o){return new(o||l)(h(re),h(ye),h(ge),h(R),h(Ce),h(q),h(te),h(A),h(P),h(Pe))}}static{this.\u0275cmp=M({type:l,selectors:[["app-purchase-create"]],standalone:!0,features:[L([P]),$],decls:76,vars:65,consts:[[3,"formGroup"],[3,"header"],[1,"flex","flex-column","md:flex-row","sm:flex-row","w-full"],[1,"align-items-left","justify-content-top","w-full"],[1,"flex","flex-column","md:flex-row","gap-2","w-full"],[1,"flex","flex-wrap","justify-content-left","align-items-center","gap-2","pb-4","lg:w-full"],[1,"w-25rem"],["dateFormat","dd/mm/yy","type","text","styleClass","w-full",1,"w-full",3,"formControlName"],[2,"color","red"],[1,"flex","flex-wrap","justify-content-left","align-items-center","gap-2","pb-4","lg:w-full","px-2"],["pInputText","","type","text",1,"w-full",3,"formControlName"],["optionLabel","empresa","styleClass","w-full","placeholder","Select un proveedor",1,"w-full","lg:w-full",3,"onChange","formControlName","options"],["optionLabel","display","placeholder","Seleccionar Producto","styleClass","w-full",1,"w-full","lg:w-full",3,"formControlName","options"],[1,"flex","flex-column","md:flex-row","flex-row"],[1,"flex","flex-wrap","justify-content-left","align-items-center","gap-2","px-2","lg:w-full"],["pInputText","","type","number",1,"w-full",3,"change","formControlName"],["pInputText","","type","number",1,"w-full",3,"formControlName"],["pInputText","","type","number","disabled","",1,"w-full",3,"value"],[1,"justify-content-center","align-items-center"],[1,""],[1,"flex","justify-content-between"],["icon","pi pi-plus","severity","primary",3,"click","title"],["icon","pi pi-trash","severity","danger",3,"click","title"],[3,"value","tableStyle","styleClass"],["pTemplate","header"],["pTemplate","body"],[1,"flex","gap-3","mt-1"],["label","Cancel","severity","secondary","styleClass","w-full",1,"w-full"],["label","Save","styleClass","w-full",1,"w-full",3,"click","disabled"],[2,"width","6%","text-align","right"],[2,"width","40%"],[2,"width","12%","text-align","right"],[2,"width","6%"],[2,"text-align","right"],[1,"flex","flex-wrap","justify-content-left"],["icon","pi pi-pencil","severity","warning",3,"click","title"]],template:function(o,i){if(o&1&&(g(0,"p-toast")(1,"p-confirmDialog"),t(2,"form",0)(3,"p-card",1),d(4,"translate"),d(5,"uppercase"),t(6,"div",2)(7,"div",3)(8,"div",4)(9,"div",5)(10,"label",6),n(11),d(12,"translate"),e(),g(13,"p-calendar",7),v(14,Ie,2,0,"small",8),e(),t(15,"div",9)(16,"label",6),n(17),d(18,"translate"),e(),g(19,"input",10),v(20,De,2,0,"small",8),e(),t(21,"div",9)(22,"label",6),n(23),d(24,"translate"),e(),t(25,"p-dropdown",11),C("onChange",function(){return i.changeProvider()}),e(),v(26,Ne,2,0,"small",8),e(),t(27,"div",5)(28,"label",6),n(29),d(30,"translate"),e(),g(31,"p-dropdown",12),v(32,Me,2,0,"small",8),e()(),t(33,"div",13)(34,"div",14)(35,"label",6),n(36),d(37,"translate"),e(),t(38,"input",15),C("change",function(){return i.changeTotalCompra()}),e(),v(39,Be,2,0,"small",8),e(),t(40,"div",14)(41,"label",6),n(42),d(43,"translate"),e(),t(44,"input",15),C("change",function(){return i.changeTotalCompra()}),e(),v(45,je,2,0,"small",8),e(),t(46,"div",14)(47,"label",6),n(48),d(49,"translate"),e(),g(50,"input",16),v(51,ke,2,0,"small",8),e(),t(52,"div",14)(53,"label",6),n(54),d(55,"translate"),e(),g(56,"input",17),v(57,Ue,2,0,"small",8),e(),t(58,"div",18)(59,"label",19),n(60),d(61,"translate"),e(),t(62,"div",20)(63,"p-buttonGroup")(64,"p-button",21),d(65,"translate"),C("click",function(){return i.addDetail()}),e(),t(66,"p-button",22),d(67,"translate"),C("click",function(){return i.updateData()}),e()()()()(),t(68,"h4"),n(69,"Detalles"),e(),t(70,"p-table",23),v(71,Ge,15,0,"ng-template",24)(72,Le,19,16,"ng-template",25),e(),t(73,"div",26),g(74,"p-button",27),t(75,"p-button",28),C("click",function(){return i.submitPurchase()}),e()()()()()()),o&2){let p,S,F,y,x,w,b,f;r(2),s("formGroup",i.purchaseForm),r(),s("header",m(5,39,m(4,37,"labels.register_purchases"))),r(8),c(m(12,41,"purcharses.fechaCompra")),r(2),s("formControlName","fechaCompra"),r(),_(14,(p=i.purchaseForm.get("fechaCompra"))!=null&&p.invalid&&((p=i.purchaseForm.get("fechaCompra"))!=null&&p.touched)?14:-1),r(3),c(m(18,43,"purcharses.precio_total")),r(2),s("formControlName","total"),r(),_(20,(S=i.purchaseForm.get("total"))!=null&&S.invalid&&((S=i.purchaseForm.get("total"))!=null&&S.touched)?20:-1),r(3),c(m(24,45,"purcharses.proveedor")),r(2),k(I(63,Te)),s("formControlName","id_proveedor")("options",i.proveedores),r(),_(26,(F=i.purchaseForm.get("id_proveedor"))!=null&&F.invalid&&((F=i.purchaseForm.get("id_proveedor"))!=null&&F.touched)?26:-1),r(3),c(m(30,47,"purcharses.producto")),r(2),s("formControlName","id_producto")("options",i.productos),r(),_(32,(y=i.purchaseForm.get("id_producto"))!=null&&y.invalid&&((y=i.purchaseForm.get("id_producto"))!=null&&y.touched)?32:-1),r(4),c(m(37,49,"purcharses.cantidad")),r(2),s("formControlName","cantidad"),r(),_(39,(x=i.purchaseForm.get("cantidad"))!=null&&x.invalid&&((x=i.purchaseForm.get("cantidad"))!=null&&x.touched)?39:-1),r(3),c(m(43,51,"purcharses.precioCompra")),r(2),s("formControlName","precioUnitario"),r(),_(45,(w=i.purchaseForm.get("precioUnitario"))!=null&&w.invalid&&((w=i.purchaseForm.get("precioUnitario"))!=null&&w.touched)?45:-1),r(3),c(m(49,53,"purcharses.precioVenta")),r(2),s("formControlName","precioVenta"),r(),_(51,(b=i.purchaseForm.get("precioVenta"))!=null&&b.invalid&&((b=i.purchaseForm.get("precioVenta"))!=null&&b.touched)?51:-1),r(3),c(m(55,55,"purcharses.totalCompra")),r(2),G("value",i.totalCompra),r(),_(57,(f=i.purchaseForm.get("totaCompra"))!=null&&f.invalid&&((f=i.purchaseForm.get("totaCompra"))!=null&&f.touched)?57:-1),r(3),c(m(61,57,"purcharses.options")),r(4),s("title",m(65,59,"label.add_detall")),r(2),s("title",m(67,61,"label.delet_detall")),r(4),s("value",i.detailView)("tableStyle",I(64,Ve))("styleClass","p-datatable-sm"),r(5),s("disabled",i.purchaseForm.invalid&&i.detailView.length>0)}},dependencies:[ie,W,z,X,K,Q,Z,ee,ve,fe,ae,J,Y,ne,oe,me,de,_e,pe,le,O,ce,se,we,xe,he,ue,Fe,Se,Ee,be]})}}return l})();export{yt as default};
