import{a as Be,b as De,c as ke}from"./chunk-SZAIYMOY.js";import{b as Pe,c as Te,d as Ne}from"./chunk-QFHAOGBO.js";import{a as Ve,b as Ie}from"./chunk-KSC4ABF4.js";import"./chunk-FK6H3RFT.js";import{a as Fe}from"./chunk-V4EMO6LB.js";import{a as we,b as xe}from"./chunk-EOEYE5G3.js";import{a as ye}from"./chunk-6GNA35ER.js";import{a as Ee}from"./chunk-EXT6ODLE.js";import{a as be}from"./chunk-HBIR4P4V.js";import"./chunk-JTXMDS4E.js";import{b as he,i as Se}from"./chunk-NHAPQC3W.js";import"./chunk-KFFE56HM.js";import{b as Ce}from"./chunk-QLWCHRGM.js";import"./chunk-G255QGHI.js";import{b as J,c as Y,d as H,e as K}from"./chunk-6HYSLB2P.js";import{i as me,j as ue,m as fe,n as ve,s as ge,t as _e}from"./chunk-LC6JGRRQ.js";import"./chunk-2WKEWB2B.js";import{E as pe,F as de,g as Z,h as M,j as ee,k as te,m as ie,n as ae,o as ne,p as le,r as oe,t as re,u as se,v as ce}from"./chunk-3T4WVZA5.js";import"./chunk-F2X3VGZZ.js";import{j as W,k as z}from"./chunk-THLIJB7Y.js";import{Y as Q,ea as X}from"./chunk-AAQOC4TC.js";import{r as O,s as R}from"./chunk-F7YKD2CL.js";import{$ as C,Aa as a,Cb as P,Fa as g,Ma as A,Mb as r,Nb as m,Sa as h,Ub as q,Vb as T,_ as S,cb as d,cc as c,db as G,dc as p,fb as j,fc as U,ib as w,ma as D,n as $,nb as n,ob as i,pb as _,tb as k,yb as b,zb as x}from"./chunk-J6TCZN46.js";import{a as N,b as B}from"./chunk-C6Q5SG76.js";var Re=()=>({width:"100%"}),Me=()=>({width:"100%"}),je=()=>["/transactions/ventas"];function Ue(s,t){s&1&&(n(0,"small",10),r(1,"Error en el Fecha de Compra."),i())}function Le(s,t){s&1&&(n(0,"small",10),r(1,"Error en el Cliente Seleccionado."),i())}function $e(s,t){s&1&&(n(0,"small",10),r(1,"Error en el Empleado seleccionado."),i())}function Ae(s,t){s&1&&(n(0,"small",10),r(1,"Error en el Producto Seleccionado."),i())}function Ge(s,t){s&1&&(n(0,"small",10),r(1,"Error en el Fecha de Compra."),i())}function qe(s,t){s&1&&(n(0,"small",10),r(1,"Error en el Precio de Compra."),i())}function Oe(s,t){s&1&&(n(0,"small",10),r(1,"Error en el Precio de Venta."),i())}function We(s,t){s&1&&(n(0,"tr")(1,"th",25),r(2,"No"),i(),n(3,"th",26),r(4,"Producto"),i(),n(5,"th",27),r(6,"Cantidad"),i(),n(7,"th",27),r(8,"Precio Unitario"),i(),n(9,"th",27),r(10,"Precio Total"),i(),n(11,"th",28),r(12,"Option"),i()())}function ze(s,t){if(s&1&&(n(0,"tr"),_(1,"td")(2,"td")(3,"td"),n(4,"th",29)(5,"label"),r(6),c(7,"translate"),i()(),n(8,"th",31),_(9,"input",12),i()()),s&2){let l=x(2);a(6),m(p(7,3,"labels.precio_total")),a(3),d("value",l.total)("disabled",!0)}}function Je(s,t){if(s&1){let l=k();n(0,"tr")(1,"td",29),r(2),i(),n(3,"td"),r(4),i(),n(5,"td",29),r(6),i(),n(7,"td",29),r(8),i(),n(9,"td",29),r(10),i(),n(11,"td",30)(12,"p-buttonGroup")(13,"p-button",22),c(14,"translate"),b("click",function(){let o=S(l).$implicit,v=x();return C(v.deleteDetail(o))}),i()()()(),h(15,ze,10,5,"tr")}if(s&2){let l=t.$implicit,e=t.rowIndex,o=x();a(2),m(e+1),a(),G("background-color",o.getColorBackground(l.color))("color",o.getColor(l.color)),a(),m(l.name_product),a(2),m(l.cantidad),a(2),m(l.precioUnitario),a(2),m(l.cantidad*l.precioUnitario),a(3),d("title",p(14,11,"label.delet_detall")),a(2),w(e+1===o.detailView.length?15:-1)}}function Ye(s,t){if(s&1){let l=k();n(0,"div",32),_(1,"p-button",33),n(2,"p-button",34),b("click",function(){S(l);let o=x();return C(o.cleanAll())}),i(),n(3,"p-button",35),b("click",function(){S(l);let o=x();return C(o.submitSales())}),i()()}if(s&2){let l=x();a(),d("routerLink",T(2,je)),a(2),d("disabled",!l.salesForm.valid||l.detailView.length===0)}}var L=class s{constructor(t,l,e,o,v,y,F,E,V,I,He,Ke){this.translateLanService=t;this.translate=l;this.toastServ=e;this.confirmationServ=o;this.clientServ=v;this.employeesServ=y;this.ventasServ=F;this.productosServ=E;this.fb=V;this.router=I;this.datePipe=He;this.pdfreport=Ke;this.translateLanService.changeLanguage$.subscribe(u=>this.translate.use(u)),this.salesForm=this.fb.group({fechaVenta:[M.required],tokenSIN:[""],id_cliente:["",[M.required]],id_empleado:["",[M.required]],cantidad:[""],precioUnitario:[""],precioUnitarioVenta:[""],id_producto:[""]}),this.productosServ.postProductsGet().subscribe(u=>{console.log(u),this.productos=u.map(f=>B(N({},f),{displayProduct:`${f.nombre} (${f.color}) - ${f.unidadMedida}`})),this.stateInputs.set(!1)}),this.clientServ.getAllClients().subscribe({next:u=>{console.log(u),this.clientes=u.map(f=>B(N({},f),{displayCliente:`${f.nombre} ${f.app} ${f.apm}`}))},error:u=>console.log(u)}),this.employeesServ.postEmployees(null).pipe($(u=>({data:Array.isArray(u)?[...u]:[],page:0,rows:0,total_records:0,loaded:!0,loading:!1,error:null}))).subscribe(u=>{console.log(u),this.empleados=u.data.map(f=>B(N({},f),{displayEmpleado:`${f.nombre} ${f.app} ${f.apm}, ${f.idcargo}`})),this.stateInputs.set(!1)})}salesForm;items;ventasRegister;clientes;empleados;productos;producto=D({});cliente=D({});detailView=[];stateInputs=D(!0);total=0;totalVenta=0;asignarValores(){let t=this.salesForm.value,e=new Date(t.fechaVenta).toISOString().split("T")[0];return this.ventasRegister={fechaVenta:e,total:this.total,id_cliente:t.id_cliente.id,id_empleado:t.id_empleado.id,confactura:0,token_SIN:"tokenSIN",detalle:this.detailView.map(o=>(console.log(o),{cantidad:o.cantidad,precioUnitario:o.precioUnitario,id_producto:o.id_producto}))},console.log(`console.log(this.comprasRegister);
 `,this.ventasRegister),this.ventasRegister}getLastDateOfYear(t){return new Date(t,11,31)}notifySuccess(){this.toastServ.showSuccess("Operation Successful","The action was completed successfully.")}notifyError(){this.toastServ.showError("Operation Failed","An error occurred while processing the action.")}getColorBackground(t){switch(t){case"Natural":return"#cccccc";case"Champan":return"#FBE7C6";case"Negro":return"#000000";case"Madera":return"#8B4513";default:return"#FFFFFF"}}getColor(t){switch(t){case"Natural":return"#000000";case"Champan":return"#000000";case"Negro":return"#FFFFFF";case"Madera":return"#FFFFFF";default:return"#FFFFFF"}}deleteDetail(t){this.detailView=this.detailView.filter(l=>l!==t),this.funcTotal(),this.cleanForms()}changeTotalVenta(){let t=this.salesForm.value.cantidad*this.salesForm.value.precioUnitario;console.log("totalVenta ",t),this.totalVenta=t}addDetail(){if(!this.salesForm.value.id_producto){alert("Debe de seleccionar producto para agregarlo. Por favor seleccione uno.");return}let t=Number(this.salesForm.value.id_producto.id);if(this.detailView.some(e=>e.id_producto===t||this.salesForm.value.id_producto=="")){alert("Este producto ya ha sido agregado. Por favor selecciona otro.");return}if(this.salesForm.value.cantidad>this.producto().cantidadStock){alert("Error, la cantidad solicitada de "+this.salesForm.value.cantidad+" items excede al stock de "+this.producto().cantidadStock+" en Almacenes");return}this.detailView.push({name_product:this.salesForm.value.id_producto.nombre,color:this.salesForm.value.id_producto.color,cantidad:Number(this.salesForm.value.cantidad),precioUnitario:Number(this.salesForm.value.precioUnitario),id_producto:Number(this.salesForm.value.id_producto.id)}),console.log(this.detailView),this.funcTotal(),this.cleanForms()}updateData(){console.log("updateData() { } ")}funcTotal(){this.total=this.detailView.reduce((t,l)=>{let e=Number(l.cantidad)||0,o=Number(l.precioUnitario)||0;return t+e*o},0)}cleanForms(){this.salesForm.patchValue({total:this.total,id_producto:"",cantidad:"",precioUnitario:"",precioVenta:""},{emitEvent:!1}),this.totalVenta=0}cleanAll(){console.log("cleanAll() { ... }")}async submitSales(){if(this.salesForm.valid){let t=await this.asignarValores();console.log(t),t.detalle=JSON.stringify(t.detalle),await this.confirmSave(t)}else console.error("Formulario inv\xE1lido")}confirmDialogSave(t,l){return new Promise(e=>{this.confirmationServ.confirm({message:t,header:l,icon:"pi pi-exclamation-triangle",accept:()=>e(!0),reject:()=>e(!1)})})}async confirmDialogFactura(t,l){return await new Promise(e=>{this.confirmationServ.confirm({message:t,header:l,icon:"pi pi-exclamation-triangle",accept:()=>e(!0),reject:()=>e(!1)})})}saveRegisterSale=(t,l)=>{this.ventasRegister.confactura=l?1:0,console.log(this.ventasRegister,t),this.ventasRegister.token_SIN=l?"con token":"",this.ventasRegister.total=this.ventasRegister.total*.13,console.log("Total: ",this.ventasRegister.total),this.ventasServ.postSaveVenta(t).subscribe({next:e=>console.log(e),error:e=>console.log(e)})};async confirmSave(t){this.ventasRegister=t;let l=await this.confirmDialogSave("\xBFEst\xE1s seguro de registrar esta venta?","Confirmaci\xF3n");console.log(l);let e=null;if(l){let o=this.ventasRegister.total*.13;console.log(o),e=await this.confirmDialogFactura("\xBFSe est\xE1 procesando la venta, el precio sin factura es: "+this.ventasRegister.total+"Bs con factura es "+(this.ventasRegister.total+o)+"Bs,  desea factura?","Confirmaci\xF3n Factura"),console.log(e),await this.saveRegisterSale(this.ventasRegister,e)}else console.log("Primera confirmaci\xF3n cancelada.");l&&e&&this.generatePdf()}generatePdf=()=>{let t=new Be,l=[{product:"Producto A",quantity:2,price:10,total:20},{product:"Producto B",quantity:1,price:15,total:15},{product:"Producto C",quantity:3,price:7,total:21}];this.pdfreport.generatePdf()};changeClient({value:t}){console.log(t);let l=t;this.cliente.set(l)}changeProduct({value:t}){console.log(t),this.producto.set(t)}static \u0275fac=function(l){return new(l||s)(g(K),g(J),g(Fe),g(Q),g(ye),g(be),g(De),g(Ee),g(oe),g(W),g(R),g(ke))};static \u0275cmp=A({type:s,selectors:[["app-sale-create"]],features:[q([R])],decls:91,vars:89,consts:[["header",""],["body",""],[3,"formGroup"],[3,"header","subheader"],[1,"flex","md:flex-row","sm:flex-row"],[1,"col-12","md:col-7","w-full"],[1,"flex","md:flex-row","flex-row","w-full"],[1,"flex","flex-wrap","justify-content-left","align-items-center","gap-2","p-2","lg:w-full","md:w-full","w-full"],[1,"w-25rem"],["dateFormat","dd/mm/yy","type","text","styleClass","w-full",1,"w-full",3,"formControlName","placeholder"],[2,"color","red"],["optionLabel","displayCliente","styleClass","w-full","placeholder","Seleccionar Cliente",1,"w-full","lg:w-full",3,"onChange","formControlName","options"],["pInputText","","type","text",1,"w-full",3,"value","disabled"],["optionLabel","displayEmpleado","placeholder","Seleccionar Empleado","styleClass","w-full",1,"w-full","lg:w-full",3,"formControlName","options"],[1,"flex","flex-column","md:flex-row","flex-row"],["optionLabel","displayProduct","styleClass","w-full","placeholder","Seleccionar producto",1,"w-full","lg:w-full",3,"onChange","formControlName","options"],["pInputText","","type","number",1,"w-full",3,"change","formControlName"],["pInputText","","type","number","disabled","",1,"w-full",3,"value"],[1,"justify-content-center","align-items-center","p-2"],[1,""],[1,"flex","justify-content-between","pt-2"],["icon","pi pi-plus","severity","primary",3,"click","title"],["icon","pi pi-trash","severity","danger",3,"click","title"],[3,"value","tableStyle","styleClass"],["pTemplate","footer"],[2,"width","6%","text-align","right"],[2,"width","40%"],[2,"width","12%","text-align","right"],[2,"width","6%"],[2,"text-align","right"],[1,"flex","flex-wrap","justify-content-left"],[1,"text-right",2,"text-align","right"],[1,"flex","gap-3","mt-1"],["label","Cancel","severity","danger","styleClass","w-full",1,"w-full",3,"routerLink"],["label","Limpiar","severity","secondary","styleClass","w-full",1,"w-full",3,"click"],["label","Save","styleClass","w-full",1,"w-full",3,"click","disabled"]],template:function(l,e){if(l&1){let o=k();_(0,"p-toast")(1,"p-confirmDialog"),n(2,"form",2)(3,"p-card",3),c(4,"translate"),c(5,"uppercase"),c(6,"translate"),c(7,"capitalize"),n(8,"div",4)(9,"div",5)(10,"div",6)(11,"div",7)(12,"label",8),r(13),c(14,"translate"),i(),_(15,"p-datepicker",9),h(16,Ue,2,0,"small",10),i(),n(17,"div",7)(18,"label",8),r(19),c(20,"translate"),i(),n(21,"p-select",11),b("onChange",function(y){return S(o),C(e.changeClient(y))}),i(),h(22,Le,2,0,"small",10),i(),n(23,"div",7)(24,"label",8),r(25),c(26,"translate"),i(),_(27,"input",12),i(),n(28,"div",7)(29,"label",8),r(30),c(31,"translate"),i(),_(32,"p-select",13),h(33,$e,2,0,"small",10),i()(),n(34,"div",14)(35,"div",7)(36,"label",8),r(37),c(38,"translate"),i(),n(39,"p-select",15),b("onChange",function(y){return S(o),C(e.changeProduct(y))}),i(),h(40,Ae,2,0,"small",10),i(),n(41,"div",7)(42,"label",8),r(43),c(44,"translate"),i(),_(45,"input",12),i(),n(46,"div",7)(47,"label",8),r(48),c(49,"translate"),i(),_(50,"input",12),i(),n(51,"div",7)(52,"label",8),r(53),c(54,"translate"),i(),_(55,"input",12),i()(),n(56,"div",14)(57,"div",7)(58,"label",8),r(59),c(60,"translate"),i(),n(61,"input",16),b("change",function(){return S(o),C(e.changeTotalVenta())}),i(),h(62,Ge,2,0,"small",10),i(),n(63,"div",7)(64,"label",8),r(65),c(66,"translate"),i(),n(67,"input",16),b("change",function(){return S(o),C(e.changeTotalVenta())}),i(),h(68,qe,2,0,"small",10),i(),n(69,"div",7)(70,"label",8),r(71),c(72,"translate"),i(),_(73,"input",17),h(74,Oe,2,0,"small",10),i(),n(75,"div",18)(76,"label",19),r(77),c(78,"translate"),i(),n(79,"div",20)(80,"p-buttonGroup")(81,"p-button",21),c(82,"translate"),b("click",function(){return S(o),C(e.addDetail())}),i(),n(83,"p-button",22),c(84,"translate"),b("click",function(){return S(o),C(e.updateData())}),i()()()()(),n(85,"p-table",23),h(86,We,13,0,"ng-template",null,0,U)(88,Je,16,13,"ng-template",null,1,U),i()()(),h(90,Ye,4,3,"ng-template",24),i()()}if(l&2){let o,v,y,F,E,V,I;a(2),d("formGroup",e.salesForm),a(),d("header",p(5,52,p(4,50,"pages.register_sales")))("subheader",p(7,56,p(6,54,"labels.form_sales"))),a(10),m(p(14,58,"labels.fechaVenta")),a(2),d("formControlName","fechaVenta")("placeholder","Seleecionar fecha"),a(),w((o=e.salesForm.get("fechaVenta"))!=null&&o.invalid&&((o=e.salesForm.get("fechaVenta"))!=null&&o.touched)?16:-1),a(3),m(p(20,60,"labels.id_cliente")),a(2),j(T(86,Re)),d("formControlName","id_cliente")("options",e.clientes),a(),w((v=e.salesForm.get("id_cliente"))!=null&&v.invalid&&((v=e.salesForm.get("id_cliente"))!=null&&v.touched)?22:-1),a(3),m(p(26,62,"labels.ci")),a(2),d("value",e.cliente().ci!==void 0?e.cliente().ci:"")("disabled",!0),a(3),m(p(31,64,"labels.id_empleado")),a(2),d("formControlName","id_empleado")("options",e.empleados),a(),w((y=e.salesForm.get("id_empleado"))!=null&&y.invalid&&((y=e.salesForm.get("id_empleado"))!=null&&y.touched)?33:-1),a(4),m(p(38,66,"labels.id_producto")),a(2),j(T(87,Re)),d("formControlName","id_producto")("options",e.productos),a(),w((F=e.salesForm.get("id_producto"))!=null&&F.invalid&&((F=e.salesForm.get("id_producto"))!=null&&F.touched)?40:-1),a(3),m(p(44,68,"labels.description")),a(2),P("value",e.producto().descripcion),d("disabled",!0),a(3),m(p(49,70,"labels.proveedor")),a(2),P("value",e.producto().empresa),d("disabled",!0),a(3),m(p(54,72,"labels.cantidadStock")),a(2),P("value",e.producto().cantidadStock),d("disabled",!0),a(4),m(p(60,74,"labels.cantidad")),a(2),d("formControlName","cantidad"),a(),w((E=e.salesForm.get("cantidad"))!=null&&E.invalid&&((E=e.salesForm.get("cantidad"))!=null&&E.touched)?62:-1),a(3),m(p(66,76,"labels.precioVenta")),a(2),d("formControlName","precioUnitario"),a(),w((V=e.salesForm.get("precioUnitario"))!=null&&V.invalid&&((V=e.salesForm.get("precioUnitario"))!=null&&V.touched)?68:-1),a(3),m(p(72,78,"labels.totalVenta")),a(2),P("value",e.totalVenta),a(),w((I=e.salesForm.get("totaCompra"))!=null&&I.invalid&&((I=e.salesForm.get("totaCompra"))!=null&&I.touched)?74:-1),a(3),m(p(78,80,"labels.options")),a(4),d("title",p(82,82,"label.add_detall")),a(2),d("title",p(84,84,"label.delet_detall")),a(2),d("value",e.detailView)("tableStyle",T(88,Me))("styleClass","p-datatable-sm")}},dependencies:[re,ie,Z,ae,ee,te,ne,le,ue,me,X,H,Y,ce,se,_e,ge,Ce,de,pe,O,ve,fe,Ie,Ve,Se,he,xe,we,Te,Pe,z,Ne],encapsulation:2})};export{L as default};
