import{a as Me,b as ke,c as je,d as Ae,e as Ue}from"./chunk-DLZ6EEDV.js";import{a as Te,b as Ie}from"./chunk-GV5YMGWN.js";import{a as De}from"./chunk-UBRMCGMO.js";import{a as Be}from"./chunk-W7DPQRV7.js";import{a as Ve,b as Ne}from"./chunk-PZ53LSKC.js";import{c as ve,k as _e}from"./chunk-7R2EEWRO.js";import"./chunk-CYMO7Y7U.js";import{a as Pe}from"./chunk-MNYFTS7H.js";import{a as Ee}from"./chunk-JNB2I2HX.js";import{a as ge,b as Ce}from"./chunk-IZGIIBK5.js";import{a as ye,b as Fe}from"./chunk-3A2ES3G4.js";import"./chunk-6JGNIX7Q.js";import{j as he,q as Se,r as be,s as xe,t as we}from"./chunk-57TFHGI3.js";import{b as fe}from"./chunk-WFOMRWAE.js";import{Ha as pe,Ia as ce,Ja as se,Oa as me,Pa as de,Qa as ue,R as J,Z as z,ka as K,la as Q,na as X,oa as Z,qa as ee,ra as te,sa as ie,ta as re,va as ae,xa as oe,ya as ne,za as le}from"./chunk-TBXDAASS.js";import{k as Y,l as D,s as W,x as H,y as q}from"./chunk-SWNQVGCQ.js";import"./chunk-F2X3VGZZ.js";import{$a as c,Ca as r,Gb as n,Ha as u,Hb as s,Na as R,Nb as $,Ob as I,P as A,Ta as f,V as U,Xb as m,Yb as d,a as k,aa as E,ab as G,b as j,ba as T,cb as N,fb as g,kb as i,lb as e,mb as C,oa as L,qb as B,ub as h,vb as S,yb as O}from"./chunk-4PTIY3UM.js";var V=class l{#e=we.URL_API;http=U(W);getAllAlmacenes=()=>this.http.get(`${this.#e}almacenes`);static \u0275fac=function(t){return new(t||l)};static \u0275prov=A({token:l,factory:l.\u0275fac,providedIn:"root"})};var Le=()=>({width:"100%"}),Oe=()=>({width:"100%"}),$e=()=>["/inventory/products"];function Ye(l,a){l&1&&(i(0,"small",8),n(1,"Error en el Fecha de Compra."),e())}function We(l,a){l&1&&(i(0,"small",8),n(1,"Error en el Proveedor Seleccionado."),e())}function He(l,a){l&1&&(i(0,"small",8),n(1,"Error en el Producto seleccionado."),e())}function qe(l,a){l&1&&(i(0,"small",8),n(1,"Error en el Almacen Seleccionado."),e())}function Je(l,a){l&1&&(i(0,"small",8),n(1,"Error en el Fecha de Compra."),e())}function ze(l,a){l&1&&(i(0,"small",8),n(1,"Error en el Precio de Compra."),e())}function Ke(l,a){l&1&&(i(0,"small",8),n(1,"Error en el Precio de Venta."),e())}function Qe(l,a){l&1&&(i(0,"small",8),n(1,"Error en el Precio de Venta."),e())}function Xe(l,a){l&1&&(i(0,"tr")(1,"th",29),n(2,"No"),e(),i(3,"th",30),n(4,"Producto"),e(),i(5,"th",31),n(6,"Cantidad"),e(),i(7,"th",31),n(8,"Precio Unitario"),e(),i(9,"th",31),n(10,"Precio Venta"),e(),i(11,"th",31),n(12,"Precio Total"),e(),i(13,"th",32),n(14,"Option"),e()())}function Ze(l,a){if(l&1){let t=B();i(0,"tr")(1,"td",33),n(2),e(),i(3,"td"),n(4),e(),i(5,"td",33),n(6),e(),i(7,"td",33),n(8),e(),i(9,"td",33),n(10),e(),i(11,"td",33),n(12),e(),i(13,"td",34)(14,"p-buttonGroup")(15,"p-button",35),m(16,"translate"),h("click",function(){let p=E(t).$implicit,v=S();return T(v.updateDetail(p))}),e(),i(17,"p-button",24),m(18,"translate"),h("click",function(){let p=E(t).$implicit,v=S();return T(v.deleteDetail(p))}),e()()()()}if(l&2){let t=a.$implicit,o=a.rowIndex,p=S();r(2),s(o+1),r(),G("background-color",p.getColorBackground(t.color))("color",p.getColor(t.color)),r(),s(t.name_product),r(2),s(t.cantidad),r(2),s(t.precioUnitario),r(2),s(t.precioVenta),r(2),s(t.cantidad*t.precioUnitario),r(3),c("title",d(16,12,"label.edit_detall")),r(2),c("title",d(18,14,"label.delet_detall"))}}function et(l,a){if(l&1){let t=B();i(0,"div",36),C(1,"p-button",37),i(2,"p-button",38),h("click",function(){E(t);let p=S();return T(p.cleanAll())}),e(),i(3,"p-button",39),h("click",function(){E(t);let p=S();return T(p.submitPurchase())}),e()()}if(l&2){let t=S();r(),c("routerLink",I(2,$e)),r(2),c("disabled",!t.purchaseForm.valid)}}var M=class l{constructor(a,t,o,p,v,b,x,y,F,w,P){this.confirmationServ=a;this.comprasServ=t;this.productosServ=o;this.translate=p;this.proveedoresServ=v;this.almacenesServ=b;this.translateLanService=x;this.fb=y;this.router=F;this.datePipe=w;this.toastServ=P;this.translateLanService.changeLanguage$.subscribe(_=>this.translate.use(_)),this.currentDate=this.datePipe.transform(new Date,"dd/MM/yyyy")||"",this.purchaseForm=this.fb.group({fechaCompra:[this.currentDate],id_proveedor:["",[Q.required]],cantidad:[""],precioUnitario:[""],precioVenta:[""],id_producto:[""],id_almacen:[""]}),this.proveedoresServ.postProveedoresSearch(null).subscribe({next:_=>this.proveedores=_,error:_=>console.error("Error al obtener proveedores:",_)}),this.almacenesServ.getAllAlmacenes().subscribe({next:_=>this.almacenes=_,error:_=>console.log(_.message)})}purchaseForm;comprasRegister;proveedores;productos;almacenes;detailView=[];stateInputs=L(!0);currentDate;total=0;totalCompra=0;addDetail(){if(!this.purchaseForm.value.id_producto){alert("Debe de seleccionar producto para agregarlo. Por favor seleccione uno.");return}let a=Number(this.purchaseForm.value.id_producto.id);if(this.detailView.some(o=>o.id_producto===a||this.purchaseForm.value.id_producto=="")){alert("Este producto ya ha sido agregado. Por favor selecciona otro.");return}this.detailView.push({cantidad:Number(this.purchaseForm.value.cantidad),precioUnitario:Number(this.purchaseForm.value.precioUnitario),precioVenta:Number(this.purchaseForm.value.precioVenta),id_producto:Number(this.purchaseForm.value.id_producto.id),id_almacen:Number(this.purchaseForm.value.id_almacen.id),name_product:this.purchaseForm.value.id_producto.nombre,color:this.purchaseForm.value.id_producto.color}),this.funcTotal(),this.cleanForms()}funcTotal(){this.total=this.detailView.reduce((a,t)=>{let o=Number(t.cantidad)||0,p=Number(t.precioUnitario)||0;return a+o*p},0)}cleanForms(){this.purchaseForm.patchValue({total:this.total,id_producto:"",cantidad:"",precioUnitario:"",precioVenta:""},{emitEvent:!1}),this.totalCompra=0}updateDetail(a){this.purchaseForm.patchValue({id_producto:"",cantidad:"",precioUnitario:""},{emitEvent:!0})}changeProvider(){this.productosServ.postProductscProveedor(this.purchaseForm.value.id_proveedor.id).subscribe(a=>{this.productos=a.map(t=>j(k({},t),{display:`${t.nombre} (${t.color})  , ${t.color} - ${t.unidadMedida}`})),this.stateInputs.set(!1)})}changeTotalCompra(){console.log("this.totalCompra: "),this.totalCompra=this.purchaseForm.value.cantidad*this.purchaseForm.value.precioUnitario}submitPurchase(){if(this.purchaseForm.valid){let a=this.asignarValores();console.log(a),a.detalle=JSON.stringify(a.detalle),this.confirm(a)}else console.error("Formulario inv\xE1lido")}asignarValores(){let a=this.purchaseForm.value;return console.log(String(this.datePipe.transform(this.getLastDateOfYear(new Date().getFullYear()),"yyyy-MM-dd"))),this.comprasRegister={fechaCompra:String(this.datePipe.transform(new Date,"yyyy-MM-dd")),total:this.total,id_proveedor:a.id_proveedor.id,detalle:this.detailView.map(t=>(console.log(t),{cantidad:t.cantidad,precioUnitario:t.precioUnitario,precioVenta:t.precioVenta,id_producto:t.id_producto,id_almacen:t.id_almacen})),fechaVencimiento:String(this.datePipe.transform(this.getLastDateOfYear(new Date().getFullYear()),"yyyy-MM-dd"))},console.log(`console.log(this.comprasRegister);
 `,this.comprasRegister),this.comprasRegister}getLastDateOfYear(a){return new Date(a,11,31)}notifySuccess(){this.toastServ.showSuccess("Operation Successful","The action was completed successfully.")}notifyError(){this.toastServ.showError("Operation Failed","An error occurred while processing the action.")}confirm(a){this.confirmationServ.confirm({message:"Are you sure you want to perform this action?",header:"Confirmation",icon:"pi pi-exclamation-triangle",accept:()=>{this.comprasServ.postSaveCompras(a).subscribe({next:t=>{console.log("Action confirmed!"),t.CodigoEstado==="201"?(this.notifySuccess(),setTimeout(()=>{console.log("Compra registrada correctamente"),this.router.navigate(["/transactions/compras"])},3e3)):console.log(t)},error:t=>{console.error("Error al registrar la compra:",t)}})},reject:()=>{console.log("Action rejected!")}})}getColorBackground(a){switch(a){case"Natural":return"#cccccc";case"Champan":return"#FBE7C6";case"Negro":return"#000000";case"Madera":return"#8B4513";default:return"#FFFFFF"}}getColor(a){switch(a){case"Natural":return"#000000";case"Champan":return"#000000";case"Negro":return"#FFFFFF";case"Madera":return"#FFFFFF";default:return"#FFFFFF"}}deleteDetail(a){this.detailView=this.detailView.filter(t=>t!==a),this.funcTotal(),this.cleanForms()}updateData(){console.log("updateData() { } ")}cleanAll(){}static \u0275fac=function(t){return new(t||l)(u(J),u(Be),u(De),u(me),u(Ee),u(V),u(Se),u(ae),u(H),u(D),u(Ue))};static \u0275cmp=R({type:l,selectors:[["app-purchase-create"]],features:[$([D])],decls:81,vars:73,consts:[[3,"formGroup"],[3,"header"],[1,"flex","flex-column","md:flex-row","sm:flex-row","w-full"],[1,"align-items-left","justify-content-top","w-full"],[1,"flex","flex-column","md:flex-row","gap-2","w-full"],[1,"flex","flex-wrap","justify-content-left","align-items-center","gap-2","pb-4","lg:w-full"],[1,"w-25rem"],["dateFormat","dd/mm/yy","type","text","styleClass","w-full",1,"w-full",3,"formControlName"],[2,"color","red"],[1,"flex","flex-wrap","justify-content-left","align-items-center","gap-2","pb-4","lg:w-full","px-2"],["pInputText","","type","text",1,"w-full",3,"value","disabled"],["optionLabel","empresa","styleClass","w-full","placeholder","Select un proveedor",1,"w-full","lg:w-full",3,"onChange","formControlName","options"],["optionLabel","display","placeholder","Seleccionar Producto","styleClass","w-full",1,"w-full","lg:w-full",3,"formControlName","options"],["optionLabel","nombre","styleClass","w-full","placeholder","Seleccionar un almacen",1,"p-inputtext-sm","w-full","lg:w-full",3,"formControlName","options"],["type","button","pButton","","icon","pi pi-plus","title","Agregar almacen",1,"p-button-primary"],[1,"flex","flex-column","md:flex-row","flex-row"],[1,"flex","flex-wrap","justify-content-left","align-items-center","gap-2","px-2","lg:w-full"],["pInputText","","type","number",1,"w-full",3,"change","formControlName"],["pInputText","","type","number",1,"w-full",3,"formControlName"],["pInputText","","type","number","disabled","",1,"w-full",3,"value"],[1,"justify-content-center","align-items-center"],[1,""],[1,"flex","justify-content-between"],["icon","pi pi-plus","severity","primary",3,"click","title"],["icon","pi pi-trash","severity","danger",3,"click","title"],[3,"value","tableStyle","styleClass"],["pTemplate","header"],["pTemplate","body"],["pTemplate","footer"],[2,"width","6%","text-align","right"],[2,"width","40%"],[2,"width","12%","text-align","right"],[2,"width","6%"],[2,"text-align","right"],[1,"flex","flex-wrap","justify-content-left"],["icon","pi pi-pencil","severity","warn",3,"click","title"],[1,"flex","gap-3","mt-1"],["label","Cancel","severity","danger","styleClass","w-full",1,"w-full",3,"routerLink"],["label","Limpiar","severity","secondary","styleClass","w-full",1,"w-full",3,"click"],["label","Save","styleClass","w-full",1,"w-full",3,"click","disabled"]],template:function(t,o){if(t&1&&(C(0,"p-toast")(1,"p-confirmDialog"),i(2,"form",0)(3,"p-card",1),m(4,"translate"),m(5,"uppercase"),i(6,"div",2)(7,"div",3)(8,"div",4)(9,"div",5)(10,"label",6),n(11),m(12,"translate"),e(),C(13,"p-calendar",7),f(14,Ye,2,0,"small",8),e(),i(15,"div",9)(16,"label",6),n(17),m(18,"translate"),e(),C(19,"input",10),e(),i(20,"div",9)(21,"label",6),n(22),m(23,"translate"),e(),i(24,"p-dropdown",11),h("onChange",function(){return o.changeProvider()}),e(),f(25,We,2,0,"small",8),e(),i(26,"div",5)(27,"label",6),n(28),m(29,"translate"),e(),C(30,"p-dropdown",12),f(31,He,2,0,"small",8),e(),i(32,"div",9)(33,"label",6),n(34),m(35,"translate"),e(),i(36,"p-inputGroup"),C(37,"p-dropdown",13)(38,"button",14),e(),f(39,qe,2,0,"small",8),e()(),i(40,"div",15)(41,"div",16)(42,"label",6),n(43),m(44,"translate"),e(),i(45,"input",17),h("change",function(){return o.changeTotalCompra()}),e(),f(46,Je,2,0,"small",8),e(),i(47,"div",16)(48,"label",6),n(49),m(50,"translate"),e(),i(51,"input",17),h("change",function(){return o.changeTotalCompra()}),e(),f(52,ze,2,0,"small",8),e(),i(53,"div",16)(54,"label",6),n(55),m(56,"translate"),e(),C(57,"input",18),f(58,Ke,2,0,"small",8),e(),i(59,"div",16)(60,"label",6),n(61),m(62,"translate"),e(),C(63,"input",19),f(64,Qe,2,0,"small",8),e(),i(65,"div",20)(66,"label",21),n(67),m(68,"translate"),e(),i(69,"div",22)(70,"p-buttonGroup")(71,"p-button",23),m(72,"translate"),h("click",function(){return o.addDetail()}),e(),i(73,"p-button",24),m(74,"translate"),h("click",function(){return o.updateData()}),e()()()()(),i(75,"h4"),n(76,"Detalles"),e(),i(77,"p-table",25),f(78,Xe,15,0,"ng-template",26)(79,Ze,19,16,"ng-template",27),e()()(),f(80,et,4,3,"ng-template",28),e()()),t&2){let p,v,b,x,y,F,w,P;r(2),c("formGroup",o.purchaseForm),r(),c("header",d(5,44,d(4,42,"labels.register_purchases"))),r(8),s(d(12,46,"purcharses.fechaCompra")),r(2),c("formControlName","fechaCompra"),r(),g((p=o.purchaseForm.get("fechaCompra"))!=null&&p.invalid&&((p=o.purchaseForm.get("fechaCompra"))!=null&&p.touched)?14:-1),r(3),s(d(18,48,"purcharses.precio_total")),r(2),c("value",o.total)("disabled",!0),r(3),s(d(23,50,"purcharses.proveedor")),r(2),N(I(70,Le)),c("formControlName","id_proveedor")("options",o.proveedores),r(),g((v=o.purchaseForm.get("id_proveedor"))!=null&&v.invalid&&((v=o.purchaseForm.get("id_proveedor"))!=null&&v.touched)?25:-1),r(3),s(d(29,52,"purcharses.producto")),r(2),c("formControlName","id_producto")("options",o.productos),r(),g((b=o.purchaseForm.get("id_producto"))!=null&&b.invalid&&((b=o.purchaseForm.get("id_producto"))!=null&&b.touched)?31:-1),r(3),s(d(35,54,"purcharses.almacen")),r(3),N(I(71,Le)),c("formControlName","id_almacen")("options",o.almacenes),r(2),g((x=o.purchaseForm.get("id_almacen"))!=null&&x.invalid&&((x=o.purchaseForm.get("id_almacen"))!=null&&x.touched)?39:-1),r(4),s(d(44,56,"purcharses.cantidad")),r(2),c("formControlName","cantidad"),r(),g((y=o.purchaseForm.get("cantidad"))!=null&&y.invalid&&((y=o.purchaseForm.get("cantidad"))!=null&&y.touched)?46:-1),r(3),s(d(50,58,"purcharses.precioCompra")),r(2),c("formControlName","precioUnitario"),r(),g((F=o.purchaseForm.get("precioUnitario"))!=null&&F.invalid&&((F=o.purchaseForm.get("precioUnitario"))!=null&&F.touched)?52:-1),r(3),s(d(56,60,"purcharses.precioVenta")),r(2),c("formControlName","precioVenta"),r(),g((w=o.purchaseForm.get("precioVenta"))!=null&&w.invalid&&((w=o.purchaseForm.get("precioVenta"))!=null&&w.touched)?58:-1),r(3),s(d(62,62,"purcharses.totalCompra")),r(2),O("value",o.totalCompra),r(),g((P=o.purchaseForm.get("totaCompra"))!=null&&P.invalid&&((P=o.purchaseForm.get("totaCompra"))!=null&&P.touched)?64:-1),r(3),s(d(68,64,"purcharses.options")),r(4),c("title",d(72,66,"label.add_detall")),r(2),c("title",d(74,68,"label.delet_detall")),r(4),c("value",o.detailView)("tableStyle",I(72,Oe))("styleClass","p-datatable-sm")}},dependencies:[Fe,ye,z,Pe,he,fe,oe,ee,K,te,X,Z,ie,re,xe,be,ue,de,le,ne,Ie,Te,se,pe,ce,Y,Ce,ge,ke,Me,_e,ve,Ne,Ve,Ae,je,q],encapsulation:2})};export{M as default};
