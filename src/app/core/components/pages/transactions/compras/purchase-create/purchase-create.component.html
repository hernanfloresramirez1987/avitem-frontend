<p-toast/>
<p-confirmDialog />
<form [formGroup]="purchaseForm">
    <p-card [header]="'labels.register_purchases' | translate | uppercase">
        <div class="flex flex-column md:flex-row sm:flex-row w-full">
            <!-- Asegurarse de que el contenedor principal ocupe todo el ancho -->
            <div class="align-items-left justify-content-top w-full">
                <!-- Contenedor externo alinear al 100% -->
                <div class="flex flex-column md:flex-row gap-2 w-full">
                    <!-- Flexbox adaptado a todo el ancho -->

                    <!-- Fecha de compra -->
                    <div class="flex flex-wrap justify-content-left align-items-center gap-2 pb-4 px-2 lg:w-full">
                        <label class="w-25rem">{{'purcharses.fechaCompra' | translate }}</label>
                        <p-calendar [formControlName]="'fechaCompra'" dateFormat="dd/mm/yy" type="text" styleClass="w-full" class="w-full" /> @if (purchaseForm.get('fechaCompra')?.invalid && purchaseForm.get('fechaCompra')?.touched) {
                        <small style="color: red;">Error en el Fecha de Compra.</small> }
                    </div>
                    <!-- total -->
                    <div class="flex flex-wrap justify-content-left align-items-center gap-2 pb-4 px-2 lg:w-full">
                        <label class="w-25rem">{{'purcharses.total' | translate }}</label>
                        <input pInputText [formControlName]="'total'" type="text" class="w-full" /> @if (purchaseForm.get('total')?.invalid && purchaseForm.get('total')?.touched) {
                        <small style="color: red;">Error en el Precio Total.</small> }
                    </div>
                    <!-- proveedor -->
                    <div class="flex flex-wrap justify-content-left align-items-center gap-2 pb-4 lg:w-full px-2">
                        <label class="w-25rem">{{'purcharses.proveedor' | translate }}</label>
                        <p-dropdown [formControlName]="'id_proveedor'" [options]="proveedores" optionLabel="empresa" (onChange)="changeProvider()" class="w-full lg:w-full" styleClass="w-full" placeholder="Select un proveedor" [style]="{width: '100%'}" /> @if (purchaseForm.get('id_proveedor')?.invalid && purchaseForm.get('id_proveedor')?.touched) {
                        <small style="color: red;">Error en el Proveedor Seleccionado.</small> }
                    </div>
                </div>
                <hr>
                <div class="flex flex-column md:flex-row flex-row">
                    <!-- id_producto -->
                    <div class="flex flex-wrap justify-content-left align-items-center gap-2 lg:w-full px-2">
                        <label class="w-25rem">{{'purcharses.producto' | translate }}</label>
                        <!-- <p-dropdown [formControlName]="'id_producto'" [options]="productos" optionLabel="{{'nombre'}} - {{'unidadMedida'}}" placeholder="Seleccionar Producto" class="w-full lg:w-full" styleClass="w-full" /> @if (purchaseForm.get('id_producto')?.invalid && purchaseForm.get('id_producto')?.touched) { -->
                        <p-dropdown [formControlName]="'id_producto'" [options]="productos" [optionLabel]="'nombre'" placeholder="Seleccionar Producto" class="w-full lg:w-full" styleClass="w-full" /> @if (purchaseForm.get('id_producto')?.invalid && purchaseForm.get('id_producto')?.touched) {
                        <small style="color: red;">Error en el Producto seleccionado.</small> }
                    </div>
                    <!-- cantidad -->
                    <div class="flex flex-wrap justify-content-left align-items-center gap-2 px-2 lg:w-full">
                        <label class="w-25rem">{{'purcharses.cantidad' | translate }}</label>
                        <input pInputText [formControlName]="'cantidad'" type="number" class="w-full" /> @if (purchaseForm.get('cantidad')?.invalid && purchaseForm.get('cantidad')?.touched) {
                        <small style="color: red;">Error en el Fecha de Compra.</small> }
                    </div>
                    <!-- precio compra -->
                    <div class="flex flex-wrap justify-content-left align-items-center gap-2 px-2 lg:w-full">
                        <label class="w-25rem">{{'purcharses.precioCompra' | translate }}</label>
                        <input pInputText [formControlName]="'precioUnitario'" type="number" class="w-full" /> @if (purchaseForm.get('precioUnitario')?.invalid && purchaseForm.get('precioUnitario')?.touched) {
                        <small style="color: red;">Error en el Precio de Compra.</small> }
                    </div>
                    <!-- precio venta -->
                    <div class="flex flex-wrap justify-content-left align-items-center gap-2 px-2 lg:w-full">
                        <label class="w-25rem">{{'purcharses.precioVenta' | translate }}</label>
                        <input pInputText [formControlName]="'precioVenta'" type="number" class="w-full" /> @if (purchaseForm.get('precioVenta')?.invalid && purchaseForm.get('precioVenta')?.touched) {
                        <small style="color: red;">Error en el Precio de Venta.</small> }
                    </div>
                    <div class="justify-content-center align-items-center">
                        <label class="">{{'purcharses.options' | translate }}</label>
                        <div class="flex justify-content-between">
                            <p-buttonGroup>
                                <p-button [title]="'label.add_detall' | translate" icon="pi pi-plus" severity="primary" (click)="addDetail()" />
                                <!-- <p-button [title]="'label.edit_detall' | translate" icon="pi pi-pencil" severity="warning" /> -->
                                <p-button [title]="'label.delet_detall' | translate" icon="pi pi-trash" severity="danger" (click)="removeDetail($event)" />
                            </p-buttonGroup>
                        </div>
                    </div>

                </div>
                <!-- <div formArrayName="detalle"> -->
                <h4>Detalles</h4>
                <!-- @for (item of detail; track $index) { -->
                <p-table [value]="detailView" [tableStyle]="{ 'width': '100%' }" styleClass="p-datatable-sm">
                    <ng-template pTemplate="header">
                        <tr>
                            <th style="width: 5%;">No</th>
                            <th style="width: 15%;">Cantidad</th>
                            <th style="width: 15%;">Precio Unitario</th>
                            <th style="width: 40%;">Producto</th>
                            <th style="width: 15%;">Precio Venta</th>
                            <th style="width: 10%;">Option</th>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-customer let-i="rowIndex">
                        <tr>
                            <td>{{i + 1}}</td>
                            <td>{{ customer.cantidad }}</td>
                            <td>{{ customer.precioUnitario }}</td>
                            <td>{{ customer.name_product }}</td>
                            <td>{{ customer.precioVenta}}</td>
                            <td>
                                <p-buttonGroup>
                                    <p-button [title]="'label.edit_detall' | translate" icon="pi pi-pencil" severity="warning" />
                                    <p-button [title]="'label.delet_detall' | translate" icon="pi pi-trash" severity="danger" (click)="removeDetail($event)" />
                                </p-buttonGroup>
                            </td>
                        </tr>
                    </ng-template>
                </p-table>
                <!-- </div> -->

                <!-- <ng-template pTemplate="footer"> -->
                <div class="flex gap-3 mt-1">
                    <p-button label="Cancel" severity="secondary" class="w-full" styleClass="w-full" />
                    <p-button label="Save" class="w-full" styleClass="w-full" (click)="submitPurchase()" [disabled]="purchaseForm.invalid && detailView.length > 0" />
                </div>
                <!-- </ng-template> -->
            </div>
        </div>
    </p-card>
</form>