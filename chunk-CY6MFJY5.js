import{a as De,b as ke,d as Be,e as Me}from"./chunk-L4A23QUT.js";import{a as Pe}from"./chunk-FMJFN5RW.js";import{a as Ie,b as Te}from"./chunk-YQTJAH3R.js";import{a as Ve}from"./chunk-DSWQF5U4.js";import{a as Ne}from"./chunk-Q23YGPIA.js";import{a as Ee}from"./chunk-HRAB5QLI.js";import{b as Ce,j as ye}from"./chunk-IWHM6MOW.js";import"./chunk-Q5DNOYSX.js";import"./chunk-3B4LGE7N.js";import{b as Fe}from"./chunk-DJBQN63M.js";import{k as _e,l as ge,q as Se,r as he,s as be,t as xe,u as we}from"./chunk-TODYEVCJ.js";import"./chunk-YE3U7BHT.js";import{Aa as ce,Ca as me,Da as de,Ea as ue,Na as fe,Oa as ve,W as te,b as Q,c as X,ca as ie,d as Z,e as ee,pa as ae,qa as k,sa as le,ta as oe,va as re,wa as ne,xa as se,ya as pe}from"./chunk-AC5AOUNI.js";import{k as H,l as D,s as J,x as z,y as K}from"./chunk-TMRQNNBK.js";import"./chunk-F2X3VGZZ.js";import{Ab as h,Bb as y,Da as i,Eb as q,Ia as v,Ob as r,Pa as G,Pb as m,Q as L,Rb as W,Va as _,Vb as Y,W as $,Wb as V,a as I,b as T,ba as P,ca as N,dc as d,ec as u,fb as p,gb as O,ib as M,lb as S,pa as A,q as U,qb as a,rb as e,sb as g,wb as j}from"./chunk-RCKDCOFB.js";var B=class n{#e=we.URL_API;http=$(J);postSaveVenta=t=>this.http.post(`${this.#e}ventas/register`,t);static \u0275fac=function(l){return new(l||n)};static \u0275prov=L({token:n,factory:n.\u0275fac,providedIn:"root"})};var je=()=>({width:"100%"}),Le=()=>({width:"100%"}),$e=()=>["/inventory/products"];function Ae(n,t){n&1&&(a(0,"small",8),r(1,"Error en el Fecha de Compra."),e())}function Ge(n,t){n&1&&(a(0,"small",8),r(1,"Error en el Proveedor Seleccionado."),e())}function Oe(n,t){n&1&&(a(0,"small",8),r(1,"Error en el Producto seleccionado."),e())}function qe(n,t){n&1&&(a(0,"small",8),r(1,"Error en el Producto Seleccionado."),e())}function We(n,t){n&1&&(a(0,"small",8),r(1,"Error en el Fecha de Compra."),e())}function Ye(n,t){n&1&&(a(0,"small",8),r(1,"Error en el Precio de Compra."),e())}function He(n,t){n&1&&(a(0,"small",8),r(1,"Error en el Precio de Venta."),e())}function Je(n,t){n&1&&(a(0,"tr")(1,"th",26),r(2,"No"),e(),a(3,"th",27),r(4,"Producto"),e(),a(5,"th",28),r(6,"Cantidad"),e(),a(7,"th",28),r(8,"Precio Unitario"),e(),a(9,"th",28),r(10,"Precio Total"),e(),a(11,"th",29),r(12,"Option"),e()())}function ze(n,t){if(n&1){let l=j();a(0,"tr")(1,"td",30),r(2),e(),a(3,"td"),r(4),e(),a(5,"td",30),r(6),e(),a(7,"td",30),r(8),e(),a(9,"td",30),r(10),e(),a(11,"td",31)(12,"p-buttonGroup")(13,"p-button",21),d(14,"translate"),h("click",function(){let s=P(l).$implicit,C=y();return N(C.deleteDetail(s))}),e()()()()}if(n&2){let l=t.$implicit,o=t.rowIndex,s=y();i(2),m(o+1),i(),O("background-color",s.getColorBackground(l.color))("color",s.getColor(l.color)),i(),m(l.name_product),i(2),m(l.cantidad),i(2),m(l.precioUnitario),i(2),m(l.cantidad*l.precioUnitario),i(3),p("title",u(14,10,"label.delet_detall"))}}function Ke(n,t){if(n&1){let l=j();a(0,"div",32),g(1,"p-button",33),a(2,"p-button",34),h("click",function(){P(l);let s=y();return N(s.cleanAll())}),e(),r(3),a(4,"p-button",35),h("click",function(){P(l);let s=y();return N(s.submitSales())}),e()()}if(n&2){let l=y();i(),p("routerLink",V(4,$e)),i(2),W(" ",l.salesForm.valid,"-",l.detailView.length,""),i(),p("disabled",!l.salesForm.valid||l.detailView.length===0)}}var R=class n{constructor(t,l,o,s,C,b,x,F,w,E,Qe){this.confirmationServ=t;this.clientServ=l;this.employeesServ=o;this.ventasServ=s;this.productosServ=C;this.translate=b;this.translateLanService=x;this.fb=F;this.router=w;this.datePipe=E;this.toastServ=Qe;this.translateLanService.changeLanguage$.subscribe(f=>this.translate.use(f)),this.salesForm=this.fb.group({fechaVenta:[k.required],tokenSIN:[""],id_cliente:["",[k.required]],id_empleado:["",[k.required]],cantidad:[""],precioUnitario:[""],precioUnitarioVenta:[""],id_producto:[""]}),this.productosServ.postProductsGet().subscribe(f=>{this.productos=f.map(c=>T(I({},c),{displayProduct:`${c.nombre} (${c.color}) - ${c.unidadMedida}`})),this.stateInputs.set(!1)}),this.clientServ.getAllClients().subscribe({next:f=>{console.log(f),this.clientes=f.map(c=>T(I({},c),{displayCliente:`${c.nombre} (${c.app}) ${c.apm}`}))},error:f=>console.log(f)}),this.employeesServ.postEmployees(null).pipe(U(f=>({data:Array.isArray(f)?[...f]:[],page:0,rows:0,total_records:0,loaded:!0,loading:!1,error:null}))).subscribe(f=>{console.log(f),this.empleados=f.data.map(c=>T(I({},c),{displayEmpleado:`${c.nombre} ${c.app} ${c.apm}, ${c.idcargo}`})),this.stateInputs.set(!1)})}salesForm;ventasRegister;clientes;empleados;productos;detailView=[];stateInputs=A(!0);total=0;totalVenta=0;asignarValores(){let t=this.salesForm.value;console.log(t);let o=new Date(t.fechaVenta).toISOString().split("T")[0];return console.log(String(this.datePipe.transform(this.getLastDateOfYear(new Date().getFullYear()),"yyyy-MM-dd"))),this.ventasRegister={fechaVenta:o,total:this.total,id_cliente:t.id_cliente.id,id_empleado:t.id_empleado.id,confactura:1,token_SIM:"tokenSIM",detalle:this.detailView.map(s=>(console.log(s),{cantidad:s.cantidad,precioUnitario:s.precioUnitario,id_producto:s.id_producto}))},console.log(`console.log(this.comprasRegister);
 `,this.ventasRegister),this.ventasRegister}getLastDateOfYear(t){return new Date(t,11,31)}notifySuccess(){this.toastServ.showSuccess("Operation Successful","The action was completed successfully.")}notifyError(){this.toastServ.showError("Operation Failed","An error occurred while processing the action.")}getColorBackground(t){switch(t){case"Natural":return"#cccccc";case"Champan":return"#FBE7C6";case"Negro":return"#000000";case"Madera":return"#8B4513";default:return"#FFFFFF"}}getColor(t){switch(t){case"Natural":return"#000000";case"Champan":return"#000000";case"Negro":return"#FFFFFF";case"Madera":return"#FFFFFF";default:return"#FFFFFF"}}deleteDetail(t){this.detailView=this.detailView.filter(l=>l!==t),this.funcTotal(),this.cleanForms()}changeTotalVenta(){}addDetail(){if(!this.salesForm.value.id_producto){alert("Debe de seleccionar producto para agregarlo. Por favor seleccione uno.");return}let t=Number(this.salesForm.value.id_producto.id);if(this.detailView.some(o=>o.id_producto===t||this.salesForm.value.id_producto=="")){alert("Este producto ya ha sido agregado. Por favor selecciona otro.");return}this.detailView.push({name_product:this.salesForm.value.id_producto.nombre,color:this.salesForm.value.id_producto.color,cantidad:Number(this.salesForm.value.cantidad),precioUnitario:Number(this.salesForm.value.precioUnitario),id_producto:Number(this.salesForm.value.id_producto.id)}),console.log(this.detailView),this.funcTotal(),this.cleanForms()}updateData(){console.log("updateData() { } ")}funcTotal(){this.total=this.detailView.reduce((t,l)=>{let o=Number(l.cantidad)||0,s=Number(l.precioUnitario)||0;return t+o*s},0)}cleanForms(){this.salesForm.patchValue({total:this.total,id_producto:"",cantidad:"",precioUnitario:"",precioVenta:""},{emitEvent:!1}),this.totalVenta=0}cleanAll(){}submitSales(){if(this.salesForm.valid){let t=this.asignarValores();console.log(t),t.detalle=JSON.stringify(t.detalle),this.confirm(t)}else console.error("Formulario inv\xE1lido")}confirm(t){this.confirmationServ.confirm({message:"Are you sure you want to perform this action?",header:"Confirmation",icon:"pi pi-exclamation-triangle",accept:()=>{this.ventasServ.postSaveVenta(t).subscribe({next:l=>{console.log("Action confirmed!"),l.CodigoEstado==="201"?(this.notifySuccess(),setTimeout(()=>{console.log("Venta registrada correctamente"),this.router.navigate(["/transactions/ventas"])},3e3)):console.log(l)},error:l=>{console.error("Error al registrar la compra:",l)}})},reject:()=>{console.log("Action rejected!")}})}static \u0275fac=function(l){return new(l||n)(v(te),v(Ve),v(Ee),v(B),v(Ne),v(Q),v(ee),v(ce),v(z),v(D),v(Pe))};static \u0275cmp=G({type:n,selectors:[["app-sale-create"]],features:[Y([D])],decls:73,vars:69,consts:[[3,"formGroup"],[3,"header"],[1,"flex","flex-column","md:flex-row","sm:flex-row","w-full"],[1,"align-items-left","justify-content-top","w-full"],[1,"flex","flex-column","md:flex-row","gap-2","w-full"],[1,"flex","flex-wrap","justify-content-left","align-items-center","gap-2","pb-4","lg:w-full"],[1,"w-25rem"],["dateFormat","dd/mm/yy","type","text","styleClass","w-full",1,"w-full",3,"formControlName","placeholder"],[2,"color","red"],[1,"flex","flex-wrap","justify-content-left","align-items-center","gap-2","pb-4","lg:w-full","px-2"],["pInputText","","type","text",1,"w-full",3,"value","disabled"],["optionLabel","displayCliente","styleClass","w-full","placeholder","Seleccionar un Cliente",1,"w-full","lg:w-full",3,"formControlName","options"],["optionLabel","displayEmpleado","placeholder","Seleccionar Empleado","styleClass","w-full",1,"w-full","lg:w-full",3,"formControlName","options"],[1,"flex","flex-column","md:flex-row","flex-row"],["optionLabel","displayProduct","styleClass","w-full","placeholder","Seleccionar un producto",1,"w-full","lg:w-full",3,"formControlName","options"],["pInputText","","type","number",1,"w-full",3,"change","formControlName"],["pInputText","","type","number","disabled","",1,"w-full",3,"value"],[1,"justify-content-center","align-items-center"],[1,""],[1,"flex","justify-content-between"],["icon","pi pi-plus","severity","primary",3,"click","title"],["icon","pi pi-trash","severity","danger",3,"click","title"],[3,"value","tableStyle","styleClass"],["pTemplate","header"],["pTemplate","body"],["pTemplate","footer"],[2,"width","6%","text-align","right"],[2,"width","40%"],[2,"width","12%","text-align","right"],[2,"width","6%"],[2,"text-align","right"],[1,"flex","flex-wrap","justify-content-left"],[1,"flex","gap-3","mt-1"],["label","Cancel","severity","danger","styleClass","w-full",1,"w-full",3,"routerLink"],["label","Limpiar","severity","secondary","styleClass","w-full",1,"w-full",3,"click"],["label","Save","styleClass","w-full",1,"w-full",3,"click","disabled"]],template:function(l,o){if(l&1&&(g(0,"p-toast")(1,"p-confirmDialog"),a(2,"form",0)(3,"p-card",1),d(4,"translate"),d(5,"uppercase"),a(6,"div",2)(7,"div",3)(8,"div",4)(9,"div",5)(10,"label",6),r(11),d(12,"translate"),e(),g(13,"p-datepicker",7),_(14,Ae,2,0,"small",8),e(),a(15,"div",9)(16,"label",6),r(17),d(18,"translate"),e(),g(19,"input",10),e(),a(20,"div",9)(21,"label",6),r(22),d(23,"translate"),e(),g(24,"p-select",11),_(25,Ge,2,0,"small",8),e(),a(26,"div",5)(27,"label",6),r(28),d(29,"translate"),e(),g(30,"p-select",12),_(31,Oe,2,0,"small",8),e()(),a(32,"div",13)(33,"div",9)(34,"label",6),r(35),d(36,"translate"),e(),g(37,"p-select",14),_(38,qe,2,0,"small",8),e(),a(39,"div",9)(40,"label",6),r(41),d(42,"translate"),e(),a(43,"input",15),h("change",function(){return o.changeTotalVenta()}),e(),_(44,We,2,0,"small",8),e(),a(45,"div",9)(46,"label",6),r(47),d(48,"translate"),e(),a(49,"input",15),h("change",function(){return o.changeTotalVenta()}),e(),_(50,Ye,2,0,"small",8),e(),a(51,"div",9)(52,"label",6),r(53),d(54,"translate"),e(),g(55,"input",16),_(56,He,2,0,"small",8),e(),a(57,"div",17)(58,"label",18),r(59),d(60,"translate"),e(),a(61,"div",19)(62,"p-buttonGroup")(63,"p-button",20),d(64,"translate"),h("click",function(){return o.addDetail()}),e(),a(65,"p-button",21),d(66,"translate"),h("click",function(){return o.updateData()}),e()()()()(),a(67,"h4"),r(68,"Detalles"),e(),a(69,"p-table",22),_(70,Je,13,0,"ng-template",23)(71,ze,15,12,"ng-template",24),e()()(),_(72,Ke,5,5,"ng-template",25),e()()),l&2){let s,C,b,x,F,w,E;i(2),p("formGroup",o.salesForm),i(),p("header",u(5,42,u(4,40,"pages.register_sales"))),i(8),m(u(12,44,"labels.fechaVenta")),i(2),p("formControlName","fechaVenta")("placeholder","Seleecionar fecha"),i(),S((s=o.salesForm.get("fechaVenta"))!=null&&s.invalid&&((s=o.salesForm.get("fechaVenta"))!=null&&s.touched)?14:-1),i(3),m(u(18,46,"labels.precio_total")),i(2),p("value",o.total)("disabled",!0),i(3),m(u(23,48,"labels.id_cliente")),i(2),M(V(66,je)),p("formControlName","id_cliente")("options",o.clientes),i(),S((C=o.salesForm.get("id_cliente"))!=null&&C.invalid&&((C=o.salesForm.get("id_cliente"))!=null&&C.touched)?25:-1),i(3),m(u(29,50,"labels.id_empleado")),i(2),p("formControlName","id_empleado")("options",o.empleados),i(),S((b=o.salesForm.get("id_empleado"))!=null&&b.invalid&&((b=o.salesForm.get("id_empleado"))!=null&&b.touched)?31:-1),i(4),m(u(36,52,"labels.id_producto")),i(2),M(V(67,je)),p("formControlName","id_producto")("options",o.productos),i(),S((x=o.salesForm.get("id_producto"))!=null&&x.invalid&&((x=o.salesForm.get("id_producto"))!=null&&x.touched)?38:-1),i(3),m(u(42,54,"labels.cantidad")),i(2),p("formControlName","cantidad"),i(),S((F=o.salesForm.get("cantidad"))!=null&&F.invalid&&((F=o.salesForm.get("cantidad"))!=null&&F.touched)?44:-1),i(3),m(u(48,56,"labels.precioVenta")),i(2),p("formControlName","precioUnitario"),i(),S((w=o.salesForm.get("precioUnitario"))!=null&&w.invalid&&((w=o.salesForm.get("precioUnitario"))!=null&&w.touched)?50:-1),i(3),m(u(54,58,"labels.totalVenta")),i(2),q("value",o.totalVenta),i(),S((E=o.salesForm.get("totaCompra"))!=null&&E.invalid&&((E=o.salesForm.get("totaCompra"))!=null&&E.touched)?56:-1),i(3),m(u(60,60,"labels.options")),i(4),p("title",u(64,62,"label.add_detall")),i(2),p("title",u(66,64,"label.delet_detall")),i(4),p("value",o.detailView)("tableStyle",V(68,Le))("styleClass","p-datatable-sm")}},dependencies:[me,re,ae,ne,le,oe,se,pe,xe,be,ie,Z,X,ue,de,he,Se,Fe,ve,fe,H,ge,_e,ke,De,ye,Ce,Te,Ie,Me,Be,K],encapsulation:2})};export{R as default};
