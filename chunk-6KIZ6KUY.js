import{a as ke}from"./chunk-BDJK56C7.js";import{a as Me,b as Be,c as je,d as Ae,e as Ue,f as Le,g as Re}from"./chunk-TCLGF2N4.js";import{a as Ve,b as Ne}from"./chunk-JAGUNA5B.js";import{a as Te,b as Ie}from"./chunk-B23V7YBR.js";import{a as De}from"./chunk-YDOT7O4I.js";import{c as ge,k as Ce}from"./chunk-5VYOBJKQ.js";import"./chunk-OGQHURAE.js";import{a as Pe}from"./chunk-R3RUQSCU.js";import{a as Ee}from"./chunk-HES5XV4O.js";import{a as Fe,b as we}from"./chunk-6SW6JFWZ.js";import{j as he,k as ve,l as _e,s as be,t as Se,u as ye,v as xe}from"./chunk-O3DLFHTK.js";import{b as fe}from"./chunk-XMSLJEE3.js";import{Ha as pe,Ia as ce,Ja as se,Oa as me,Pa as de,Qa as ue,R as q,Z as J,ka as K,la as Q,na as X,oa as Z,qa as ee,ra as te,sa as ie,ta as re,va as ae,xa as oe,ya as ne,za as le}from"./chunk-L6F5SHP5.js";import{k as Y,l as V,r as W,w as z,x as H}from"./chunk-A5I2MG6G.js";import"./chunk-F2X3VGZZ.js";import{$a as c,Ca as r,Gb as n,Ha as f,Hb as d,Na as R,Nb as $,Ob as S,P as U,Ta as h,V as L,Xb as s,Yb as m,a as j,aa as T,ab as G,b as A,ba as I,cb as D,fb as g,kb as t,lb as e,mb as C,oa as k,qb as M,ub as u,vb as b,yb as O}from"./chunk-4PTIY3UM.js";var N=class l{#e=xe.URL_API;http=L(W);getAllAlmacenes=()=>this.http.get(`${this.#e}almacenes`);static \u0275fac=function(i){return new(i||l)};static \u0275prov=U({token:l,factory:l.\u0275fac,providedIn:"root"})};var Ge=()=>({width:"100%"}),Ye=()=>({width:"100%"}),We=()=>({width:"50vw"}),ze=()=>["/inventory/products"];function He(l,o){l&1&&(t(0,"small",8),n(1,"Error en el Fecha de Compra."),e())}function qe(l,o){l&1&&(t(0,"small",8),n(1,"Error en el Proveedor Seleccionado."),e())}function Je(l,o){l&1&&(t(0,"small",8),n(1,"Error en el Producto seleccionado."),e())}function Ke(l,o){l&1&&(t(0,"small",8),n(1,"Error en el Almacen Seleccionado."),e())}function Qe(l,o){l&1&&(t(0,"small",8),n(1,"Error en el Fecha de Compra."),e())}function Xe(l,o){l&1&&(t(0,"small",8),n(1,"Error en el Precio de Compra."),e())}function Ze(l,o){l&1&&(t(0,"small",8),n(1,"Error en el Precio de Venta."),e())}function et(l,o){l&1&&(t(0,"small",8),n(1,"Error en el Precio de Venta."),e())}function tt(l,o){l&1&&(t(0,"tr")(1,"th",32),n(2,"No"),e(),t(3,"th",33),n(4,"Producto"),e(),t(5,"th",34),n(6,"Cantidad"),e(),t(7,"th",34),n(8,"Precio Unitario"),e(),t(9,"th",34),n(10,"Precio Venta"),e(),t(11,"th",34),n(12,"Precio Total"),e(),t(13,"th",35),n(14,"Option"),e()())}function it(l,o){if(l&1){let i=M();t(0,"tr")(1,"td",36),n(2),e(),t(3,"td"),n(4),e(),t(5,"td",36),n(6),e(),t(7,"td",36),n(8),e(),t(9,"td",36),n(10),e(),t(11,"td",36),n(12),e(),t(13,"td",37)(14,"p-buttonGroup")(15,"p-button",38),s(16,"translate"),u("click",function(){let p=T(i).$implicit,v=b();return I(v.updateDetail(p))}),e(),t(17,"p-button",24),s(18,"translate"),u("click",function(){let p=T(i).$implicit,v=b();return I(v.deleteDetail(p))}),e()()()()}if(l&2){let i=o.$implicit,a=o.rowIndex,p=b();r(2),d(a+1),r(),G("background-color",p.getColorBackground(i.color))("color",p.getColor(i.color)),r(),d(i.name_product),r(2),d(i.cantidad),r(2),d(i.precioUnitario),r(2),d(i.precioVenta),r(2),d(i.cantidad*i.precioUnitario),r(3),c("title",m(16,12,"label.edit_detall")),r(2),c("title",m(18,14,"label.delet_detall"))}}function rt(l,o){if(l&1){let i=M();t(0,"div",39),C(1,"p-button",40),t(2,"p-button",41),u("click",function(){T(i);let p=b();return I(p.cleanAll())}),e(),t(3,"p-button",31),u("click",function(){T(i);let p=b();return I(p.submitPurchase())}),e()()}if(l&2){let i=b();r(),c("routerLink",S(2,ze)),r(2),c("disabled",!i.purchaseForm.valid)}}var B=class l{constructor(o,i,a,p,v,y,F,w,x,P,E){this.confirmationServ=o;this.comprasServ=i;this.productosServ=a;this.translate=p;this.proveedoresServ=v;this.almacenesServ=y;this.translateLanService=F;this.fb=w;this.router=x;this.datePipe=P;this.toastServ=E;this.translateLanService.changeLanguage$.subscribe(_=>this.translate.use(_)),this.currentDate=this.datePipe.transform(new Date,"dd/MM/yyyy")||"",this.purchaseForm=this.fb.group({fechaCompra:[this.currentDate],id_proveedor:["",[Q.required]],cantidad:[""],precioUnitario:[""],precioVenta:[""],id_producto:[""],id_almacen:[""]}),this.proveedoresServ.postProveedoresSearch(null).subscribe({next:_=>this.proveedores=_,error:_=>console.error("Error al obtener proveedores:",_)}),this.almacenesServ.getAllAlmacenes().subscribe({next:_=>this.almacenes=_,error:_=>console.log(_.message)})}purchaseForm;comprasRegister;proveedores;productos;almacenes;detailView=[];stateInputs=k(!0);currentDate;total=0;totalCompra=0;stateDialog=k(!1);addDetail(){if(!this.purchaseForm.value.id_producto){alert("Debe de seleccionar producto para agregarlo. Por favor seleccione uno.");return}let o=Number(this.purchaseForm.value.id_producto.id);if(this.detailView.some(a=>a.id_producto===o||this.purchaseForm.value.id_producto=="")){alert("Este producto ya ha sido agregado. Por favor selecciona otro.");return}this.detailView.push({cantidad:Number(this.purchaseForm.value.cantidad),precioUnitario:Number(this.purchaseForm.value.precioUnitario),precioVenta:Number(this.purchaseForm.value.precioVenta),id_producto:Number(this.purchaseForm.value.id_producto.id),id_almacen:Number(this.purchaseForm.value.id_almacen.id),name_product:this.purchaseForm.value.id_producto.nombre,color:this.purchaseForm.value.id_producto.color}),this.funcTotal(),this.cleanForms()}funcTotal(){this.total=this.detailView.reduce((o,i)=>{let a=Number(i.cantidad)||0,p=Number(i.precioUnitario)||0;return o+a*p},0)}cleanForms(){this.purchaseForm.patchValue({total:this.total,id_producto:"",cantidad:"",precioUnitario:"",precioVenta:""},{emitEvent:!1}),this.totalCompra=0}updateDetail(o){this.purchaseForm.patchValue({id_producto:"",cantidad:"",precioUnitario:""},{emitEvent:!0})}changeProvider(){this.productosServ.postProductscProveedor(this.purchaseForm.value.id_proveedor.id).subscribe(o=>{this.productos=o.map(i=>A(j({},i),{display:`${i.nombre} (${i.color})  , ${i.color} - ${i.unidadMedida}`})),this.stateInputs.set(!1)})}changeTotalCompra(){console.log("this.totalCompra: "),this.totalCompra=this.purchaseForm.value.cantidad*this.purchaseForm.value.precioUnitario}submitPurchase(){if(this.purchaseForm.valid){let o=this.asignarValores();console.log(o),o.detalle=JSON.stringify(o.detalle),this.confirm(o)}else console.error("Formulario inv\xE1lido")}asignarValores(){let o=this.purchaseForm.value;return console.log(String(this.datePipe.transform(this.getLastDateOfYear(new Date().getFullYear()),"yyyy-MM-dd"))),this.comprasRegister={fechaCompra:String(this.datePipe.transform(new Date,"yyyy-MM-dd")),total:this.total,id_proveedor:o.id_proveedor.id,detalle:this.detailView.map(i=>(console.log(i),{cantidad:i.cantidad,precioUnitario:i.precioUnitario,precioVenta:i.precioVenta,id_producto:i.id_producto,id_almacen:i.id_almacen})),fechaVencimiento:String(this.datePipe.transform(this.getLastDateOfYear(new Date().getFullYear()),"yyyy-MM-dd"))},console.log(`console.log(this.comprasRegister);
 `,this.comprasRegister),this.comprasRegister}getLastDateOfYear(o){return new Date(o,11,31)}notifySuccess(){this.toastServ.showSuccess("Operation Successful","The action was completed successfully.")}notifyError(){this.toastServ.showError("Operation Failed","An error occurred while processing the action.")}confirm(o){this.confirmationServ.confirm({message:"Are you sure you want to perform this action?",header:"Confirmation",icon:"pi pi-exclamation-triangle",accept:()=>{this.comprasServ.postSaveCompras(o).subscribe({next:i=>{console.log("Action confirmed!"),i.CodigoEstado==="201"?(this.notifySuccess(),setTimeout(()=>{console.log("Compra registrada correctamente"),this.router.navigate(["/transactions/compras"])},3e3)):console.log(i)},error:i=>{console.error("Error al registrar la compra:",i)}})},reject:()=>{console.log("Action rejected!")}})}getColorBackground(o){switch(o){case"Natural":return"#cccccc";case"Champan":return"#FBE7C6";case"Negro":return"#000000";case"Madera":return"#8B4513";default:return"#FFFFFF"}}getColor(o){switch(o){case"Natural":return"#000000";case"Champan":return"#000000";case"Negro":return"#FFFFFF";case"Madera":return"#FFFFFF";default:return"#FFFFFF"}}deleteDetail(o){this.detailView=this.detailView.filter(i=>i!==o),this.funcTotal(),this.cleanForms()}updateData(){console.log("updateData() { } ")}cleanAll(){}static \u0275fac=function(i){return new(i||l)(f(q),f(ke),f(De),f(me),f(Ee),f(N),f(be),f(ae),f(z),f(V),f(Re))};static \u0275cmp=R({type:l,selectors:[["app-purchase-create"]],features:[$([V])],decls:86,vars:89,consts:[[3,"formGroup"],[3,"header"],[1,"flex","flex-column","md:flex-row","sm:flex-row","w-full"],[1,"align-items-left","justify-content-top","w-full"],[1,"flex","flex-column","md:flex-row","gap-2","w-full"],[1,"flex","flex-wrap","justify-content-left","align-items-center","gap-2","pb-4","lg:w-full"],[1,"w-25rem"],["dateFormat","dd/mm/yy","type","text","styleClass","w-full",1,"w-full",3,"formControlName"],[2,"color","red"],[1,"flex","flex-wrap","justify-content-left","align-items-center","gap-2","pb-4","lg:w-full","px-2"],["pInputText","","type","text",1,"w-full",3,"value","disabled"],["optionLabel","empresa","styleClass","w-full","placeholder","Select un proveedor",1,"w-full","lg:w-full",3,"onChange","formControlName","options"],["optionLabel","display","placeholder","Seleccionar Producto","styleClass","w-full",1,"w-full","lg:w-full",3,"formControlName","options"],["optionLabel","nombre","styleClass","w-full","placeholder","Seleccionar un almacen",1,"p-inputtext-sm","w-full","lg:w-full",3,"formControlName","options"],["type","button","pButton","","icon","pi pi-plus","title","Agregar almacen",1,"p-button-primary",3,"click"],[1,"flex","flex-column","md:flex-row","flex-row"],[1,"flex","flex-wrap","justify-content-left","align-items-center","gap-2","px-2","lg:w-full"],["pInputText","","type","number",1,"w-full",3,"change","formControlName"],["pInputText","","type","number",1,"w-full",3,"formControlName"],["pInputText","","type","number","disabled","",1,"w-full",3,"value"],[1,"justify-content-center","align-items-center"],[1,""],[1,"flex","justify-content-between"],["icon","pi pi-plus","severity","primary",3,"click","title"],["icon","pi pi-trash","severity","danger",3,"click","title"],[3,"value","tableStyle","styleClass"],["pTemplate","header"],["pTemplate","body"],["pTemplate","footer"],[3,"visible","modal","draggable","resizable","closable","dismissableMask","closeOnEscape","header"],["label","Cancel","severity","danger","styleClass","w-full",1,"w-full",3,"click"],["label","Save","styleClass","w-full",1,"w-full",3,"click","disabled"],[2,"width","6%","text-align","right"],[2,"width","40%"],[2,"width","12%","text-align","right"],[2,"width","6%"],[2,"text-align","right"],[1,"flex","flex-wrap","justify-content-left"],["icon","pi pi-pencil","severity","warn",3,"click","title"],[1,"flex","gap-3","mt-1"],["label","Cancel","severity","danger","styleClass","w-full",1,"w-full",3,"routerLink"],["label","Limpiar","severity","secondary","styleClass","w-full",1,"w-full",3,"click"]],template:function(i,a){if(i&1&&(C(0,"p-toast")(1,"p-confirmDialog"),t(2,"form",0)(3,"p-card",1),s(4,"translate"),s(5,"uppercase"),t(6,"div",2)(7,"div",3)(8,"div",4)(9,"div",5)(10,"label",6),n(11),s(12,"translate"),e(),C(13,"p-date-picker",7),h(14,He,2,0,"small",8),e(),t(15,"div",9)(16,"label",6),n(17),s(18,"translate"),e(),C(19,"input",10),e(),t(20,"div",9)(21,"label",6),n(22),s(23,"translate"),e(),t(24,"p-dropdown",11),u("onChange",function(){return a.changeProvider()}),e(),h(25,qe,2,0,"small",8),e(),t(26,"div",5)(27,"label",6),n(28),s(29,"translate"),e(),C(30,"p-dropdown",12),h(31,Je,2,0,"small",8),e(),t(32,"div",9)(33,"label",6),n(34),s(35,"translate"),e(),t(36,"p-inputGroup"),C(37,"p-dropdown",13),t(38,"button",14),u("click",function(){return a.stateDialog.set(!0)}),e()(),h(39,Ke,2,0,"small",8),e()(),t(40,"div",15)(41,"div",16)(42,"label",6),n(43),s(44,"translate"),e(),t(45,"input",17),u("change",function(){return a.changeTotalCompra()}),e(),h(46,Qe,2,0,"small",8),e(),t(47,"div",16)(48,"label",6),n(49),s(50,"translate"),e(),t(51,"input",17),u("change",function(){return a.changeTotalCompra()}),e(),h(52,Xe,2,0,"small",8),e(),t(53,"div",16)(54,"label",6),n(55),s(56,"translate"),e(),C(57,"input",18),h(58,Ze,2,0,"small",8),e(),t(59,"div",16)(60,"label",6),n(61),s(62,"translate"),e(),C(63,"input",19),h(64,et,2,0,"small",8),e(),t(65,"div",20)(66,"label",21),n(67),s(68,"translate"),e(),t(69,"div",22)(70,"p-buttonGroup")(71,"p-button",23),s(72,"translate"),u("click",function(){return a.addDetail()}),e(),t(73,"p-button",24),s(74,"translate"),u("click",function(){return a.updateData()}),e()()()()(),t(75,"h4"),n(76,"Detalles"),e(),t(77,"p-table",25),h(78,tt,15,0,"ng-template",26)(79,it,19,16,"ng-template",27),e()()(),h(80,rt,4,3,"ng-template",28),e()(),t(81,"p-dialog",29),s(82,"translate"),s(83,"uppercase"),t(84,"p-button",30),u("click",function(){return a.stateDialog.set(!1)}),e(),t(85,"p-button",31),u("click",function(){return a.submitPurchase()}),e()()),i&2){let p,v,y,F,w,x,P,E;r(2),c("formGroup",a.purchaseForm),r(),c("header",m(5,55,m(4,53,"labels.register_purchases"))),r(8),d(m(12,57,"purcharses.fechaCompra")),r(2),c("formControlName","fechaCompra"),r(),g((p=a.purchaseForm.get("fechaCompra"))!=null&&p.invalid&&((p=a.purchaseForm.get("fechaCompra"))!=null&&p.touched)?14:-1),r(3),d(m(18,59,"purcharses.precio_total")),r(2),c("value",a.total)("disabled",!0),r(3),d(m(23,61,"purcharses.proveedor")),r(2),D(S(85,Ge)),c("formControlName","id_proveedor")("options",a.proveedores),r(),g((v=a.purchaseForm.get("id_proveedor"))!=null&&v.invalid&&((v=a.purchaseForm.get("id_proveedor"))!=null&&v.touched)?25:-1),r(3),d(m(29,63,"purcharses.producto")),r(2),c("formControlName","id_producto")("options",a.productos),r(),g((y=a.purchaseForm.get("id_producto"))!=null&&y.invalid&&((y=a.purchaseForm.get("id_producto"))!=null&&y.touched)?31:-1),r(3),d(m(35,65,"purcharses.almacen")),r(3),D(S(86,Ge)),c("formControlName","id_almacen")("options",a.almacenes),r(2),g((F=a.purchaseForm.get("id_almacen"))!=null&&F.invalid&&((F=a.purchaseForm.get("id_almacen"))!=null&&F.touched)?39:-1),r(4),d(m(44,67,"purcharses.cantidad")),r(2),c("formControlName","cantidad"),r(),g((w=a.purchaseForm.get("cantidad"))!=null&&w.invalid&&((w=a.purchaseForm.get("cantidad"))!=null&&w.touched)?46:-1),r(3),d(m(50,69,"purcharses.precioCompra")),r(2),c("formControlName","precioUnitario"),r(),g((x=a.purchaseForm.get("precioUnitario"))!=null&&x.invalid&&((x=a.purchaseForm.get("precioUnitario"))!=null&&x.touched)?52:-1),r(3),d(m(56,71,"purcharses.precioVenta")),r(2),c("formControlName","precioVenta"),r(),g((P=a.purchaseForm.get("precioVenta"))!=null&&P.invalid&&((P=a.purchaseForm.get("precioVenta"))!=null&&P.touched)?58:-1),r(3),d(m(62,73,"purcharses.totalCompra")),r(2),O("value",a.totalCompra),r(),g((E=a.purchaseForm.get("totaCompra"))!=null&&E.invalid&&((E=a.purchaseForm.get("totaCompra"))!=null&&E.touched)?64:-1),r(3),d(m(68,75,"purcharses.options")),r(4),c("title",m(72,77,"label.add_detall")),r(2),c("title",m(74,79,"label.delet_detall")),r(4),c("value",a.detailView)("tableStyle",S(87,Ye))("styleClass","p-datatable-sm"),r(4),D(S(88,We)),c("visible",a.stateDialog())("modal",!0)("draggable",!1)("resizable",!1)("closable",!1)("dismissableMask",!0)("closeOnEscape",!0)("header",m(83,83,m(82,81,"labels.register_purchases"))),r(4),c("disabled",!a.purchaseForm.valid)}},dependencies:[we,Fe,J,Pe,he,fe,oe,ee,K,te,X,Z,ie,re,ye,Se,ue,de,le,ne,Ie,Te,se,pe,ce,Y,_e,ve,Be,Me,Ce,ge,Ne,Ve,Le,Ue,H,Ae,je],encapsulation:2})};export{B as default};
